
var baseUrl = "http://www.example.com";

describe('Test Nexus Policy report Controller', function() {

	beforeEach(module('personalisedDashboardModule'));

	var $scope,
		rootScope,
		controller,
		Restangular,
		httpBackend,
		angularSpy,
		arrayTableModelService,
		listApplicationMock,
		dashboardProvider;

	var policyConfig = {"config": "{\"policies\":\"[{\\\"id\\\":\\\"cb24df6360cb4593a00cc7aa7aa12a25\\\",\\\"name\\\":\\\"Architecture-Cleanup\\\",\\\"highestThreatLevel\\\":1,\\\"selected\\\":false,\\\"stages\\\":[{\\\"name\\\":\\\"BUILD\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"STAGE_RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"OPERATE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]}]},{\\\"id\\\":\\\"35cd7d06745843d885be43fc8d9f916d\\\",\\\"name\\\":\\\"Architecture-Quality\\\",\\\"highestThreatLevel\\\":1,\\\"selected\\\":false,\\\"stages\\\":[{\\\"name\\\":\\\"BUILD\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"STAGE_RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"OPERATE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]}]},{\\\"id\\\":\\\"18bc9416ffd3487c85fd0d6719f13375\\\",\\\"name\\\":\\\"Component-Similar\\\",\\\"highestThreatLevel\\\":7,\\\"selected\\\":false,\\\"stages\\\":[{\\\"name\\\":\\\"BUILD\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"STAGE_RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"OPERATE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]}]},{\\\"id\\\":\\\"5af8a7ac026f4b418121b87ef69414c7\\\",\\\"name\\\":\\\"Component-Unknown\\\",\\\"highestThreatLevel\\\":2,\\\"selected\\\":false,\\\"stages\\\":[{\\\"name\\\":\\\"BUILD\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"STAGE_RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"OPERATE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]}]},{\\\"id\\\":\\\"90f71ba8b1a748babf2b74906e26b1ea\\\",\\\"name\\\":\\\"Component-Unknown-Proprietary\\\",\\\"highestThreatLevel\\\":1,\\\"selected\\\":false,\\\"stages\\\":[{\\\"name\\\":\\\"BUILD\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"STAGE_RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"OPERATE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]}]},{\\\"id\\\":\\\"71693d0ff55a47ccb32158fb86d392e7\\\",\\\"name\\\":\\\"License-Banned\\\",\\\"highestThreatLevel\\\":10,\\\"selected\\\":false,\\\"stages\\\":[{\\\"name\\\":\\\"BUILD\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"STAGE_RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"OPERATE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]}]},{\\\"id\\\":\\\"203c9dceaf514cfbbe65db6bd2683b8b\\\",\\\"name\\\":\\\"License-Copyleft\\\",\\\"highestThreatLevel\\\":8,\\\"selected\\\":false,\\\"stages\\\":[{\\\"name\\\":\\\"BUILD\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"STAGE_RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"OPERATE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]}]},{\\\"id\\\":\\\"c61947cb231d44c882ef0a2ebec54ca5\\\",\\\"name\\\":\\\"License-Modified Weak Copyleft\\\",\\\"highestThreatLevel\\\":5,\\\"selected\\\":false,\\\"stages\\\":[{\\\"name\\\":\\\"BUILD\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"STAGE_RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"OPERATE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]}]},{\\\"id\\\":\\\"7a22f1fa88cc41e88e9adf37a9f28673\\\",\\\"name\\\":\\\"License-None\\\",\\\"highestThreatLevel\\\":9,\\\"selected\\\":false,\\\"stages\\\":[{\\\"name\\\":\\\"BUILD\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"STAGE_RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"OPERATE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]}]},{\\\"id\\\":\\\"5ef2d28c94324f6fbe6fe45f5728c7a5\\\",\\\"name\\\":\\\"License-Non Standard\\\",\\\"highestThreatLevel\\\":5,\\\"selected\\\":false,\\\"stages\\\":[{\\\"name\\\":\\\"BUILD\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"STAGE_RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"OPERATE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]}]},{\\\"id\\\":\\\"07583685d45b4f1a88edaebb462a94ff\\\",\\\"name\\\":\\\"License-Threat Not Assigned\\\",\\\"highestThreatLevel\\\":7,\\\"selected\\\":false,\\\"stages\\\":[{\\\"name\\\":\\\"BUILD\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"STAGE_RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"OPERATE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]}]},{\\\"id\\\":\\\"c67e478cc27b46d98bab8273fe61226b\\\",\\\"name\\\":\\\"Security-Critical\\\",\\\"highestThreatLevel\\\":10,\\\"selected\\\":false,\\\"stages\\\":[{\\\"name\\\":\\\"BUILD\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"STAGE_RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"OPERATE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]}]},{\\\"id\\\":\\\"efb22afdf3bd470ba861bbcd1aaa8779\\\",\\\"name\\\":\\\"Security-High\\\",\\\"highestThreatLevel\\\":9,\\\"selected\\\":false,\\\"stages\\\":[{\\\"name\\\":\\\"BUILD\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"STAGE_RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"OPERATE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]}]},{\\\"id\\\":\\\"b66f07c718a8445aafed327e290ca521\\\",\\\"name\\\":\\\"Security-Low\\\",\\\"highestThreatLevel\\\":3,\\\"selected\\\":false,\\\"stages\\\":[{\\\"name\\\":\\\"BUILD\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"STAGE_RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"OPERATE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]}]},{\\\"id\\\":\\\"fbabf1aaff874cb18f508aaa2d7552f4\\\",\\\"name\\\":\\\"Security-Medium\\\",\\\"highestThreatLevel\\\":7,\\\"selected\\\":false,\\\"stages\\\":[{\\\"name\\\":\\\"BUILD\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"STAGE_RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"OPERATE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]}]},{\\\"id\\\":\\\"9a1a0361a05a42ba8237ef58fb1a6a07\\\",\\\"name\\\":\\\"Security-Unscored\\\",\\\"highestThreatLevel\\\":5,\\\"selected\\\":false,\\\"stages\\\":[{\\\"name\\\":\\\"BUILD\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"STAGE_RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"RELEASE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]},{\\\"name\\\":\\\"OPERATE\\\",\\\"selected\\\":false,\\\"highestThreatLevel\\\":0,\\\"violations\\\":[]}]}]\"}"};
	var saveConfig = [{"id":"cb24df6360cb4593a00cc7aa7aa12a25","name":"Architecture-Cleanup","highestThreatLevel":1,"selected":true,"stages":[{"name":"BUILD","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04H"},{"name":"STAGE_RELEASE","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04I"},{"name":"RELEASE","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04J"},{"name":"OPERATE","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04K"}],"selectedStages":[{"name":"BUILD","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04H"},{"name":"STAGE_RELEASE","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04I"},{"name":"RELEASE","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04J"},{"name":"OPERATE","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04K"}],"$$hashKey":"03L"},{"id":"35cd7d06745843d885be43fc8d9f916d","name":"Architecture-Quality","highestThreatLevel":1,"selected":true,"stages":[{"name":"BUILD","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"04N"},{"name":"STAGE_RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"04O"},{"name":"RELEASE","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04L"},{"name":"OPERATE","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04M"}],"selectedStages":[{"name":"RELEASE","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04L"},{"name":"OPERATE","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04M"}],"$$hashKey":"03M"},{"id":"18bc9416ffd3487c85fd0d6719f13375","name":"Component-Similar","highestThreatLevel":7,"selected":true,"stages":[{"name":"BUILD","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04P"},{"name":"STAGE_RELEASE","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04Q"},{"name":"RELEASE","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04R"},{"name":"OPERATE","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04S"}],"selectedStages":[{"name":"BUILD","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04P"},{"name":"STAGE_RELEASE","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04Q"},{"name":"RELEASE","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04R"},{"name":"OPERATE","selected":true,"highestThreatLevel":0,"violations":[],"$$hashKey":"04S"}],"$$hashKey":"03N"},{"id":"5af8a7ac026f4b418121b87ef69414c7","name":"Component-Unknown","highestThreatLevel":2,"selected":true,"stages":[{"name":"BUILD","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"04T"},{"name":"STAGE_RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"04U"},{"name":"RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"04V"},{"name":"OPERATE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"04W"}],"selectedStages":[],"$$hashKey":"03O"},{"id":"90f71ba8b1a748babf2b74906e26b1ea","name":"Component-Unknown-Proprietary","highestThreatLevel":1,"selected":false,"stages":[{"name":"BUILD","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"04X"},{"name":"STAGE_RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"04Y"},{"name":"RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"04Z"},{"name":"OPERATE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"050"}],"selectedStages":[],"$$hashKey":"03P"},{"id":"71693d0ff55a47ccb32158fb86d392e7","name":"License-Banned","highestThreatLevel":10,"selected":false,"stages":[{"name":"BUILD","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"051"},{"name":"STAGE_RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"052"},{"name":"RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"053"},{"name":"OPERATE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"054"}],"selectedStages":[],"$$hashKey":"03Q"},{"id":"203c9dceaf514cfbbe65db6bd2683b8b","name":"License-Copyleft","highestThreatLevel":8,"selected":false,"stages":[{"name":"BUILD","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"055"},{"name":"STAGE_RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"056"},{"name":"RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"057"},{"name":"OPERATE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"058"}],"selectedStages":[],"$$hashKey":"03R"},{"id":"c61947cb231d44c882ef0a2ebec54ca5","name":"License-Modified Weak Copyleft","highestThreatLevel":5,"selected":false,"stages":[{"name":"BUILD","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"059"},{"name":"STAGE_RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05A"},{"name":"RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05B"},{"name":"OPERATE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05C"}],"selectedStages":[],"$$hashKey":"03S"},{"id":"7a22f1fa88cc41e88e9adf37a9f28673","name":"License-None","highestThreatLevel":9,"selected":false,"stages":[{"name":"BUILD","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05D"},{"name":"STAGE_RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05E"},{"name":"RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05F"},{"name":"OPERATE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05G"}],"selectedStages":[],"$$hashKey":"03T"},{"id":"5ef2d28c94324f6fbe6fe45f5728c7a5","name":"License-Non Standard","highestThreatLevel":5,"selected":false,"stages":[{"name":"BUILD","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05H"},{"name":"STAGE_RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05I"},{"name":"RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05J"},{"name":"OPERATE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05K"}],"selectedStages":[],"$$hashKey":"03U"},{"id":"07583685d45b4f1a88edaebb462a94ff","name":"License-Threat Not Assigned","highestThreatLevel":7,"selected":false,"stages":[{"name":"BUILD","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05L"},{"name":"STAGE_RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05M"},{"name":"RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05N"},{"name":"OPERATE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05O"}],"selectedStages":[],"$$hashKey":"03V"},{"id":"c67e478cc27b46d98bab8273fe61226b","name":"Security-Critical","highestThreatLevel":10,"selected":false,"stages":[{"name":"BUILD","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05P"},{"name":"STAGE_RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05Q"},{"name":"RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05R"},{"name":"OPERATE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05S"}],"selectedStages":[],"$$hashKey":"03W"},{"id":"efb22afdf3bd470ba861bbcd1aaa8779","name":"Security-High","highestThreatLevel":9,"selected":false,"stages":[{"name":"BUILD","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05T"},{"name":"STAGE_RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05U"},{"name":"RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05V"},{"name":"OPERATE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05W"}],"selectedStages":[],"$$hashKey":"03X"},{"id":"b66f07c718a8445aafed327e290ca521","name":"Security-Low","highestThreatLevel":3,"selected":false,"stages":[{"name":"BUILD","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05X"},{"name":"STAGE_RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05Y"},{"name":"RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"05Z"},{"name":"OPERATE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"060"}],"selectedStages":[],"$$hashKey":"03Y"},{"id":"fbabf1aaff874cb18f508aaa2d7552f4","name":"Security-Medium","highestThreatLevel":7,"selected":false,"stages":[{"name":"BUILD","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"061"},{"name":"STAGE_RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"062"},{"name":"RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"063"},{"name":"OPERATE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"064"}],"selectedStages":[],"$$hashKey":"03Z"},{"id":"9a1a0361a05a42ba8237ef58fb1a6a07","name":"Security-Unscored","highestThreatLevel":5,"selected":false,"stages":[{"name":"BUILD","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"065"},{"name":"STAGE_RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"066"},{"name":"RELEASE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"067"},{"name":"OPERATE","selected":false,"highestThreatLevel":0,"violations":[],"$$hashKey":"068"}],"selectedStages":[],"$$hashKey":"040"}]
	var policyData = [{"id":"cb24df6360cb4593a00cc7aa7aa12a25","name":"Architecture-Cleanup","highestThreatLevel":1,"selected":true,"ownerName":null,"stages":[{"name":"BUILD","selected":true,"highestThreatLevel":1,"violations":[{"applicationName":"webgoat","components":[{"artifactId":"junit","groupId":"junit","version":"4.12","threatLevel":1},{"artifactId":"selenium-api","groupId":"org.seleniumhq.selenium","version":"2.48.2","threatLevel":1},{"artifactId":"selenium-chrome-driver","groupId":"org.seleniumhq.selenium","version":"2.48.2","threatLevel":1},{"artifactId":"selenium-edge-driver","groupId":"org.seleniumhq.selenium","version":"2.48.2","threatLevel":1},{"artifactId":"selenium-firefox-driver","groupId":"org.seleniumhq.selenium","version":"2.48.2","threatLevel":1},{"artifactId":"selenium-htmlunit-driver","groupId":"org.seleniumhq.selenium","version":"2.48.2","threatLevel":1},{"artifactId":"selenium-ie-driver","groupId":"org.seleniumhq.selenium","version":"2.48.2","threatLevel":1},{"artifactId":"selenium-java","groupId":"org.seleniumhq.selenium","version":"2.48.2","threatLevel":1},{"artifactId":"selenium-leg-rc","groupId":"org.seleniumhq.selenium","version":"2.48.2","threatLevel":1},{"artifactId":"selenium-remote-driver","groupId":"org.seleniumhq.selenium","version":"2.48.2","threatLevel":1},{"artifactId":"selenium-safari-driver","groupId":"org.seleniumhq.selenium","version":"2.48.2","threatLevel":1},{"artifactId":"selenium-support","groupId":"org.seleniumhq.selenium","version":"2.48.2","threatLevel":1}],"reportUrl":"http://localhost:8070/ui/links/application/webgoat/report/2fbf96abd7484dc6ad5d204d24aa4cd8","highestThreatLevel":1}]},{"name":"STAGE_RELEASE","selected":true,"highestThreatLevel":0,"violations":[]},{"name":"RELEASE","selected":true,"highestThreatLevel":0,"violations":[]},{"name":"OPERATE","selected":true,"highestThreatLevel":0,"violations":[]}],"route":"nexus/widget/8/policy","reqParams":null,"$fromServer":true,"parentResource":null,"restangularCollection":false},{"id":"35cd7d06745843d885be43fc8d9f916d","name":"Architecture-Quality","highestThreatLevel":0,"selected":true,"ownerName":null,"stages":[{"name":"RELEASE","selected":true,"highestThreatLevel":0,"violations":[]},{"name":"OPERATE","selected":true,"highestThreatLevel":0,"violations":[]}],"route":"nexus/widget/8/policy","reqParams":null,"$fromServer":true,"parentResource":null,"restangularCollection":false},{"id":"18bc9416ffd3487c85fd0d6719f13375","name":"Component-Similar","highestThreatLevel":7,"selected":true,"ownerName":null,"stages":[{"name":"BUILD","selected":true,"highestThreatLevel":7,"violations":[{"applicationName":"webgoat","components":[{"artifactId":"webgoat-container","groupId":"org.owasp.webgoat","version":"7.0.1","threatLevel":7},{"artifactId":"webgoat-container","groupId":"org.owasp.webgoat","version":"7.0","threatLevel":7}],"reportUrl":"http://localhost:8070/ui/links/application/webgoat/report/2fbf96abd7484dc6ad5d204d24aa4cd8","highestThreatLevel":7}]},{"name":"STAGE_RELEASE","selected":true,"highestThreatLevel":0,"violations":[]},{"name":"RELEASE","selected":true,"highestThreatLevel":0,"violations":[]},{"name":"OPERATE","selected":true,"highestThreatLevel":0,"violations":[]}],"route":"nexus/widget/8/policy","reqParams":null,"$fromServer":true,"parentResource":null,"restangularCollection":false}]

    afterEach(function() {
        angularSpy.and.callThrough();
    });

	beforeEach(inject(function ($rootScope, _Restangular_, _$httpBackend_, $controller, getAppsOfType, _dashboard_) {
		rootScope = $rootScope;
		$scope = $rootScope.$new();
		Restangular = _Restangular_;
		httpBackend = _$httpBackend_;
		dashboardProvider = _dashboard_;

		httpBackend.whenGET(baseUrl + '/rest-with-cookies/api/v1/application/supported-application').respond(testUtils.getSupportedApps());
		httpBackend.whenGET(baseUrl + '/rest-with-cookies/api/v1/application/installed-application').respond(testUtils.getAvailableApps());
		httpBackend.whenGET(baseUrl + '/rest-with-cookies/api/v1/users/user-auth-state').respond(testUtils.getUserAuthState());
		httpBackend.whenGET(baseUrl + "/rest-with-cookies/api/v1/nexus/widget/1/config").respond(policyConfig);
		httpBackend.whenGET(baseUrl + "/rest-with-cookies/api/v1/nexus/widget/1/policy").respond(policyData);
		$scope.$parent.$parent = { editMode: false };
        angularSpy = spyOn(angular, 'element').and.returnValue(testUtils.getPersonalisedDashboardModel([testUtils.getConfluenceWidget()]));


		this.init = function(moreConfig){
			var widget = testUtils.getNexusWidget();
			for(var prop in moreConfig){
				widget.config[prop] = moreConfig[prop];
			}
			$scope.config = widget.config;

			controller = $controller('nexusPolicyController', {
				'$scope': $scope,
				'widget': widget,
				Restangular: Restangular
			});
			  $scope.config = widget.config;
		}
	}));

	it('Nexus Policy widget is in the dashboard', function(){
		this.init();
		var nexusWidget = dashboardProvider.widgets['nexus-policy-violations'];
		expect(nexusWidget).toBeDefined();
		expect(nexusWidget.templateUrl).toBe("partials/widgets/nexusPolicy.html");
		expect(nexusWidget.title).toBe("Nexus Policy Violations");
	});

	it('Nexus Policy widget is configured in the dashboard', function(){
		this.init();
		$scope.showWidgetConfigModal();
		httpBackend.flush();
		var policies = $scope.nexusPolicy;
		expect(policies[0].id).toBe("cb24df6360cb4593a00cc7aa7aa12a25");
		expect(policies[0].name).toBe("Architecture-Cleanup");
		expect(policies[0].selected).toBe(false);
		expect(policies[0].stages.length).toBe(4);
	});

	it('Nexus Policy Test Save Config and only Selected Config is Saved', function(){
		this.init();
		$scope.config = {};
		$scope.saveNexusConfig(saveConfig);
		var configToSave =  {"config":{"policies":[{"id":"cb24df6360cb4593a00cc7aa7aa12a25","selected":true,"stages":[{"name":"BUILD","selected":true},{"name":"STAGE_RELEASE","selected":true},{"name":"RELEASE","selected":true},{"name":"OPERATE","selected":true}]},{"id":"35cd7d06745843d885be43fc8d9f916d","selected":true,"stages":[{"name":"RELEASE","selected":true},{"name":"OPERATE","selected":true}]},{"id":"18bc9416ffd3487c85fd0d6719f13375","selected":true,"stages":[{"name":"BUILD","selected":true},{"name":"STAGE_RELEASE","selected":true},{"name":"RELEASE","selected":true},{"name":"OPERATE","selected":true}]},{"id":"5af8a7ac026f4b418121b87ef69414c7","selected":true,"stages":[]}]},"title":"My Test Nexus widget","autoRefresh":"0","bgColor":"#374049","txtColor":"#FFFFFF"};
		httpBackend.expectPUT(baseUrl + "/rest-with-cookies/api/v1/dashboard/widget/1", configToSave)
			.respond(200, configToSave);
		$scope.$digest();
		httpBackend.flush();

		expect(	$scope.config.policies.length).toBe(4);
	});

	it('Nexus Policy Test Save Config calls the update Method', function(){
		this.init();
		$scope.config = {};
		$scope.ready = false;
		$scope.saveNexusConfig(saveConfig);
		var configToSave =  {"config":{"policies":[{"id":"cb24df6360cb4593a00cc7aa7aa12a25","selected":true,"stages":[{"name":"BUILD","selected":true},{"name":"STAGE_RELEASE","selected":true},{"name":"RELEASE","selected":true},{"name":"OPERATE","selected":true}]},{"id":"35cd7d06745843d885be43fc8d9f916d","selected":true,"stages":[{"name":"RELEASE","selected":true},{"name":"OPERATE","selected":true}]},{"id":"18bc9416ffd3487c85fd0d6719f13375","selected":true,"stages":[{"name":"BUILD","selected":true},{"name":"STAGE_RELEASE","selected":true},{"name":"RELEASE","selected":true},{"name":"OPERATE","selected":true}]},{"id":"5af8a7ac026f4b418121b87ef69414c7","selected":true,"stages":[]}]},"title":"My Test Nexus widget","autoRefresh":"0","bgColor":"#374049","txtColor":"#FFFFFF"};
		httpBackend.expectPUT(baseUrl + "/rest-with-cookies/api/v1/dashboard/widget/1", configToSave)
			.respond(200, configToSave);
		$scope.$digest();
		httpBackend.flush();
		expect(	$scope.config.policies.length).toBe(4);
		expect($scope.ready).toBe(true);
	});

	it('Nexus Policy calls Update Function', function(){
		this.init();
		$scope.config = {};
		$scope.update();
		$scope.$digest();
		httpBackend.flush();
		expect($scope.nexusPolicyData.length).toBe(3);
		expect($scope.nexusPolicyData[0].name).toBe("Architecture-Cleanup");
		expect($scope.nexusPolicyData[0].id).toBe("cb24df6360cb4593a00cc7aa7aa12a25");
		expect($scope.nexusPolicyData[0].highestThreatLevel).toBe(1);
		expect($scope.nexusPolicyData[0].stages.length).toBe(4);
		expect($scope.ready).toBe(true);
	});

});

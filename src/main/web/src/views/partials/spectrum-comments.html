<div id="comments-modal-{{widget.wid}}" class="modal fade comment-modal" role="dialog">
	<div class="modal-dialog">

		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title"><em>Comments</em></h4>
				<h4><strong>{{comments.issueKey}}</strong>&nbsp;{{comments.issueTitle}}</h4>
			</div>
			<div class="modal-body comment-modal-body" id="spec-all-comments-{{widget.wid}}">
				<spectrum-widget-loading config="widget.config" ready="comments.ready"></spectrum-widget-loading>
				<div ng-if="comments.ready" ng-repeat="comment in comments.allComments" class="comment-item">
					<span class="list-group-item-heading comment-user" style="background-image: url({{comment.creator.avatar}});">{{comment.creator.name}}</span>
					<span> - {{comment.created}}</span>
					<div ng-bind-html="comment.body" class="comment-body"></div>
				</div>
				<div ng-if="comments.ready && comments.allComments.length == 0">There are no comments yet on this issue.</div>
			</div>

			<div class="modal-footer" ng-if="comments.haveAddPermission">
				<div ng-if="comments.error" class="alert alert-danger" role="alert">
					<strong>Error!</strong> {{comments.error}}
				</div>
				<textarea id="text-new-comment-{{widget.wid}}" class="form-control comment-textarea" rows="3" ng-model="comments.newComment" ng-keydown="processKeypress($event)"
                          ng-keyup="checkMentions($event)" ng-blur="onBlur($event)" ng-focus="onFocus($event)" ng-click="checkMentions($event)"></textarea>
				<div ng-if="comments.mentionControl && !comments.mentionControl.cancelled" class="list-group comment-user-search">
					<div ng-repeat="user in comments.foundUsers">
						<a ng-mousedown="selectUser(user)" class="list-group-item comment-user-search-item" ng-class="{active:comments.selectedUser.key==user.key}"
						   style="background-image: url({{user.avatarUrls.24x24}});" ng-bind-html="user.renderedBody">
						</a>
					</div>
					<div ng-if="comments.foundUsers == undefined" class="list-group-item">
						<span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span>&nbsp;Loading users
					</div>
					<div ng-if="comments.foundUsers.length == 0" class="list-group-item">Found no matching users for <strong>{{comments.mentionControl.controlString}}</strong>.</div>
				</div>
				</br>
				<button id="spec-btn-add-comment-{{widget.wid}}"
						type="button"
				        class="btn btn-primary"
				        ng-class="{disabled: comments.submitting || !comments.newComment}"
				        ng-click="addNewComment(comments)"
						ng-if="comments.haveAddPermission">
					Add
				</button>
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			</div>

		</div>

	</div>
</div>

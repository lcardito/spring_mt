/*spectrum-front-end-build V0.0.2 made on 2016-08-10*/"use strict";function showMask(a,b){void 0===a&&(a=!0),void 0!==b&&null!==b||("string"==typeof a?(b=a,a=!0):a&&(b="Just handling your request now. . .")),_mask.showMask(a),$("#spinner-message").text(b)}function deCamelCase(a){return a.substring(0,1).toUpperCase().concat(a.substring(1).replace(/([A-Z])/g," ".concat("$1")))}function getStandardWidgetData(a,b,c){return{showRefreshOptions:!0,appUrl:"",windowTitle:a.widget.title,autoRefresh:a.widget.hasOwnProperty("autoRefresh")?a.widget.autoRefresh:"0",titleBgColor:a.widget.hasOwnProperty("bgColor")?a.widget.bgColor:c.bgColor,titleTxtColor:a.widget.hasOwnProperty("txtColor")?a.widget.txtColor:c.txtColor,minicolorsSettings:b}}function setupDefaultRestangularUrlModifications(a){a.setBaseUrl(baseUrl+"/rest-with-cookies/api/v1").setDefaultHeaders({"Content-Type":"application/json"})}function setupWidgetTweaks(a){a.module("adf").run(["$templateCache",function(a){$.get("partials/widgets/widget.html",function(b){a.put("../src/templates/widget.html",b)}),$.get("partials/widgets/dashboardEdit.html",function(b){a.put("../src/templates/dashboard-edit.html",b)})}])}function spectrumRestangularErrorHandler(a){return function(b){a.nameError=null,a.error=null,a.ready=!0,showMask(!1),delete a.error,400!==b.status&&500!==b.status&&403!==b.status||(b.data.message?(a.error=b.data.message,window.scrollTo(0,0)):a.err=b.data)}}function onWidgetOptionsCollapsed(a){a.data.$scope.$apply(function(){delete a.data.$scope.widgetOptionsActive})}function showWidgetOptions(a){a.widgetOptionsActive=!0,a.oldData=$.extend({},a.data),$("#widget-configuration-"+a.widget.wid).collapse("show")}function hideWidgetOptions(a){$("#widget-configuration-"+a.widget.wid).collapse("hide"),$("#widget-modal-"+a.widget.id).modal("hide"),a.showConfigModal=!1}function setupWidgetOptionFunctions(a){$("#personalised-dashboard").off("hidden.bs.collapse","#widget-configuration-"+a.widget.wid,onWidgetOptionsCollapsed).on("hidden.bs.collapse","#widget-configuration-"+a.widget.wid,{$scope:a},onWidgetOptionsCollapsed),a.cancelOptions=function(){cancelOptions(a)},a.showWidgetOptions=function(){showWidgetOptions(a)},a.hideWidgetOptions=function(){hideWidgetOptions(a)}}function standardSaveOptions(a,b,c,d){c?(a.ready=!1,void 0!==a.data.windowTitle&&null!==a.data.windowTitle&&(a.widget.title=a.data.windowTitle),void 0!==a.data.autoRefresh&&null!==a.data.autoRefresh&&(a.widget.autoRefresh=a.data.autoRefresh,setupIndividualRefreshTimer(a.widget)),void 0!==a.data.titleBgColor&&null!==a.data.titleBgColor&&(a.widget.bgColor=a.data.titleBgColor),void 0!==a.data.titleTxtColor&&null!==a.data.titleTxtColor&&(a.widget.txtColor=a.data.titleTxtColor),void 0!==a.update?a.update(!1):a.ready=!0,a.widget.config=a.config,b(a,d),a.hideWidgetOptions(a)):a.ready=!0,showMask(!1)}function cancelOptions(a){a.ready=!1,a.data=a.oldData,a.update(!1),hideWidgetOptions(a)}function setupIndividualRefreshTimer(a){if(a&&a.wid&&a.autoRefresh){individualRefreshTimers.hasOwnProperty(a.wid)&&clearTimeout(individualRefreshTimers[a.wid]);var b=parseInt(a.autoRefresh,10);0!=b&&(individualRefreshTimers[a.wid]=setTimeout(function(){$("#widget-configuration-"+a.wid).is(":visible")||(console.log("Actually refreshing widget: "+a.wid),angular.element("#widget-"+a.wid).scope().reload()),setupIndividualRefreshTimer(a)},6e4*b))}}function toggleWidgetResize(a){var b=a.wid;angular.element(".dashboard").scope().$watch("editMode",function(c,d){$("#widget-content-"+b).resizable({disabled:!c,handles:"s",stop:function(b,c){a.height=c.size.height}})}),isNaN(a.height)&&(a.height=200),$("#widget-content-"+b).height(a.height+"px")}function parseXml(a){a=a.replace(/\s*(<|>)\s*/g,"$1");var b;if(window.DOMParser){var c=new DOMParser;b=c.parseFromString(a,"text/xml")}else b=new ActiveXObject("Microsoft.XMLDOM"),b.loadXML(a);return b}function simpleXmlContent(a){for(var b=0;b<a.childNodes.length;b++)if(a.childNodes[b].nodeType!==Node.TEXT_NODE)return!1;return!0}function inXmlArray(a){for(var b=a.nextSibling;null!==b;){if(b.nodeName!==a.nodeName)return!1;b=b.nextSibling}for(b=a.previousSibling;null!==b;){if(b.nodeName!==a.nodeName)return!1;b=b.previousSibling}return!0}!function(){var a=angular.module("applicationTableModule",["spectrumLoginModule","spectrumTableModule","spectrumArrayTableModelModule","spectrumUtilitiesModule","restangular"]);a.config(["RestangularProvider",function(a){setupDefaultRestangularUrlModifications(a)}]).createErrorHandler=spectrumRestangularErrorHandler,a.directive("applicationTable",["Restangular","authStateService","arrayTableModelService",function(b,c,d){showMask(!0,"Loading application details");var e=function(e){var f={RUNNING:"ok",STOPPED:"remove",NOT_CONFIGURED:"ban-circle",INVALID_SERVER:"exclamation-sign"},g=function(){var g={},k=!1,l="true"===e.readOnly;c.authStatePromise.then(function(a){return(k=a.isAdmin)&&!l&&(e.addActions={name:"Add application",icon:"plus",run:"applications.html#/applications/create"}),b.all("application/supported-application").getList()},a.createErrorHandler(e)).then(function(a){return angular.forEach(a,function(a){g[a.id]=a.name}),b.all("application/installed-application").getList()},a.createErrorHandler(e)).then(function(a){e.appRowModel=d.createArrayTableModel(a,function(a){var b=[];if(k&&(b.push({name:"Edit",icon:"pencil",class:"default",run:"applications.html#/applications/"+a.id}),a.linkConfigurable&&(a.linkConfigured?b.push({name:"Re-configure link",icon:"link",class:"default",run:"applications.html#/applications/"+a.id+"/link"}):b.push({name:"Link",icon:"link",class:"default",run:"applications.html#/applications/"+a.id+"/link"})),b.push({name:"Delete",icon:"trash",class:"danger",run:function(a){i(a.id)}}),a.linkConfigured)){switch(a.supportedAppName){case"JIRA":case"Confluence":case"Bitbucket Server":b.push({name:"Install Spectrum Plugins",icon:"circle-arrow-up",class:"default",run:function(a){j(e,a)}})}h(e,a)}return a.type=g[a.supportedAppId],"Nexus-IQ"==a.type&&(a.type="nexus"),void 0!==a.type?a.pictureType=a.type.toLowerCase():a.pictureType="",a.oauthLinkConfigured=a.linkConfigured?"Yes":"No",a.statusIcon=f[a.status],{data:a,actions:b,url:a.url,defaultAction:[],external:!0}},!0,["name"])},a.createErrorHandler(e))},h=function(a,c){b.one("application/installed-application/"+c.id+"/plugin-status").get().then(function(b){if(void 0!=a.appRowModel){var d=_.find(a.appRowModel.rows,function(a){return a.data.id==c.id});_.find(d.actions,function(a){"Install Spectrum Plugins"==a.name&&"ENABLED"==b.pluginStatus&&(a.name="Re-Install Spectrum Plugins")})}})},i=function(c){delete e.error,bootbox.confirm("Are you sure you want to delete this application?",function(d){d&&(showMask(!0,"Deleting application"),b.one("application/installed-application",c).remove().then(function(){g(),showMask(!1)},a.createErrorHandler(e)))})},j=function(a,c){bootbox.confirm('Do you want to install all Spectrum plugins in "'+c.name+'"?',function(d){d&&(showMask(!0,"Installing Spectrum plugins in "+c.name),b.one("application/installed-application/"+c.id+"/install-plugins").customPOST().then(function(){showMask(!1),bootbox.dialog({message:"Spectrum plugins have been successfully installed",buttons:{success:{label:"OK",className:"btn-primary",callback:function(){h(a,c)}}}})},function(a){showMask(!1);var b="Error occurred when installing Spectrum plugins";a&&a.data&&a.data.message&&(b=a.data.message),bootbox.alert(b)}))})};g()};return{restrict:"E",templateUrl:"partials/application-table.html",scope:{gridMode:"@",gridModeSelectable:"@",readOnly:"@"},link:e}}])}(),function(){var a=angular.module("applicationsModule",["ui.router","angularUtils.directives.uiBreadcrumbs","spectrumLoginModule","spectrumHeaderModule","spectrumMenuModule","spectrumHeadingModule","spectrumFooterModule","spectrumTableModule","applicationTableModule","minicolors"]);a.constant("MINICOLORS_SETTINGS",{theme:"bootstrap",position:"bottom right",letterCase:"uppercase"}).config(["$urlRouterProvider","$stateProvider","RestangularProvider",function(a,b,c){setupDefaultRestangularUrlModifications(c),a.otherwise("/applications"),b.state("applications",{abstract:!0,url:"/applications",template:"<ui-view/>",data:{breadcrumbProxy:"applications.list"}}).state("applications.list",{url:"?linkcreated",params:{linkcreated:void 0},templateUrl:"partials/application-list.html",controller:"ListAppController",data:{displayName:"Applications"}}).state("applications.create",{url:"/create",templateUrl:"partials/application-create.html",controller:"CreateController",data:{displayName:"Create Application"}}).state("applications.edit",{abstract:!0,url:"/:appId",template:"<ui-view/>",data:{breadcrumbProxy:"applications.edit.detail"}}).state("applications.edit.detail",{url:"",templateUrl:"partials/application-edit.html",controller:"EditController",data:{displayName:"Edit Application"}}).state("applications.edit.link",{url:"/link",templateUrl:"partials/application-link.html",controller:"LinkAppController",data:{displayName:"Link Application"}})}]).createErrorHandler=spectrumRestangularErrorHandler,a.controller("CreateController",["$scope","Restangular","authStateService","MINICOLORS_SETTINGS",function(b,c,d,e){showMask(!0),b.hexColour="#A0A0A0",b.minicolorsSettings=e;var f=function(){c.all("application/supported-application").getList().then(function(a){showMask(!1),b.supportedApps=a},a.createErrorHandler(b))}();b.create=function(){showMask(!0,"Attempting to add application");var d=b.hexColour.substr(1);c.all("application/installed-application").post({name:b.name,url:b.url,hexColour:d,supportedAppId:b.supportedApp.id}).then(function(){showMask(!1),window.location="applications.html"},a.createErrorHandler(b))},b.$on("auth-state-changed",function(){d.authStatePromise.then(function(a){a.isAdmin?f():showMask(!1)})})}]).controller("EditController",["$scope","$stateParams","Restangular","MINICOLORS_SETTINGS",function(b,c,d,e){b.minicolorsSettings=e,d.one("application/installed-application",c.appId).get().then(function(a){return b.app=a,b.title=a.name,d.one("application/supported-application",a.supportedAppId).get()},a.createErrorHandler(b)).then(function(a){b.appType=a.name},a.createErrorHandler(b)),b.editApp=function(c){showMask(!0,"Editing application");var e={name:b.app.name,url:b.app.url,hexColour:b.app.hexColour.substr(1)};d.one("application/installed-application",c).customPUT(e).then(function(){showMask(!1),window.location="applications.html"},a.createErrorHandler(b))}}]),a.controller("ListAppController",["$scope","$stateParams",function(a,b){showMask(!0,"Loading application details"),b.linkcreated&&(a.showLinkSuccessAlert=!0)}]),a.controller("LinkAppController",["$scope","$stateParams","Restangular",function(b,c,d){showMask(!0),b.authoriseApplication=function(){showMask(!0,"Connecting to application for authorisation"),d.one("application",c.appId).post("request-token").then(function(a){window.location=a.authoriseUrl},a.createErrorHandler(b))},d.all("application/supported-application").getList().then(function(e){d.one("application/installed-application",c.appId).get().then(function(a){b.app=a;var c=_.find(e,function(b){return b.id==a.supportedAppId}).name;b.app.appType=c,b.app.isBbServer="Bitbucket Server"==c,b.app.isConfluence="Confluence"==c,b.app.isJira="Jira"==c,showMask(!1)},a.createErrorHandler(b))},a.createErrorHandler(b)),d.one("host-key/public-key").get().then(function(a){b.consumerKey="clearvision",b.publicKey=a.publicKey},a.createErrorHandler(b)),$("#accordion a").click(function(a){a.preventDefault()})}])}(),function(){var a=angular.module("mainLoginModule",["ui.router","angularUtils.directives.uiBreadcrumbs","spectrumLoginModule","spectrumHeaderModule","spectrumMenuModule","spectrumHeadingModule","spectrumFooterModule","spectrumUtilitiesModule"]);a.config(["$urlRouterProvider","$stateProvider",function(a,b){a.otherwise("/login"),b.state("login",{url:"/login",templateUrl:"partials/login.html",controller:"DashboardController",data:{displayName:"Dashboard"}})}]).createErrorHandler=spectrumRestangularErrorHandler,a.controller("DashboardController",["$scope","authStateService","$window",function(a,b,c){a.submit=function(){a.loginError=!1,b.login(a.userName,a.password).success(function(){c.location.href=baseUrl+"/personalised-dashboard.html"}).error(function(){a.loginError=!0})}}])}(),function(){var a=angular.module("spectrumWidgetCommonOptionsModule",[]);a.directive("spectrumWidgetCommonOptions",function(){return{restrict:"E",templateUrl:"partials/widgets/widget-common-options.html",scope:{data:"=",widget:"=",form:"="}}})}(),function(){var a=angular.module("spectrumWidgetLoadingModule",[]);a.directive("spectrumWidgetLoading",function(){return{restrict:"E",templateUrl:"partials/widgets/widget-loading.html",scope:{ready:"=",widget:"="}}})}(),function(){var a=angular.module("accountModule",["ui.router","angularUtils.directives.uiBreadcrumbs","spectrumLoginModule","spectrumHeaderModule","spectrumMenuModule","spectrumHeadingModule","spectrumFooterModule","spectrumTableModule","restangular"]);a.config(["$urlRouterProvider","$stateProvider","RestangularProvider",function(a,b,c){setupDefaultRestangularUrlModifications(c),a.otherwise("/account"),b.state("account",{url:"/account",templateUrl:"partials/account.html",controller:"AccountController",data:{displayName:"Account Details"}})}]).createErrorHandler=spectrumRestangularErrorHandler,a.controller("AccountController",["$scope","Restangular","authStateService",function(b,c,d){var e=function(){b.editMode=!1,b.oldPassword="",b.password="",b.confirmPassword="",b.nexusUserName="",b.nexusUserPassword="","null"!==b.userId&&(c.all("application/installed-application?appType=nexusiq").getList().then(function(a){b.nexusIQApps=a}),c.one("users",b.userId).get().then(function(a){return b.user=a,c.all("users/"+b.userId+"/groups").getList()},a.createErrorHandler(b)).then(function(a){b.groups=_.map(a,function(a){var b="spec-data-group-";return b+=a.external?"external-":"internal-",b+=a.active?"active":"inactive",a.iconClass=b,{data:a,actions:[],defaultAction:void 0}})},a.createErrorHandler(b)))};b.saveUserCreds=function(){b.errors=[],b.successMsg=null,c.all("application/installed-application/"+b.nexusIQApps.chosenApp.id+"/saveCredentials").post({userName:b.nexusUserName,password:b.nexusUserPassword}).then(function(){b.editMode=!1,b.successMsg="User Information updated",showMask(!1)},function(a){b.errors.push("There was an error saving your credentials. Please try again or contact an Administrator."),showMask(!1)})},b.update=function(){if(b.errors=[],b.successMsg=null,b.password!==b.confirmPassword)return void b.errors.push("New password and confirm password do not match!");""===b.oldPassword&&""===b.password&&""===b.confirmPassword&&(b.oldPassword=b.user.password,b.password=b.user.password);var d=b.user;d.oldPassword=b.oldPassword,d.password=b.password,showMask(!0,"Updating account information"),c.one("account",b.userId).customPUT(d).then(function(){b.editMode=!1,b.successMsg="User Information updated",showMask(!1)},a.createErrorHandler(b))},b.switchMode=function(){b.editMode=!b.editMode},b.$on("auth-state-changed",function(){d.authStatePromise.then(function(a){b.userId=a.currentUserId,e()})}),d.authStatePromise.then(function(a){b.userId=null!==a.currentUserId?a.currentUserId:"null",e()})}])}(),"127.0.0.1"!=document.domain&&(!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-507656-3","auto"),ga("send","pageview")),function(){var a=angular.module("spectrumArrayTableModelModule",[]),b=50,c=400;a.factory("arrayTableModelService",["$timeout",function(a){var d={createArrayTableModel:function(d,e,f,g,h,i){var j={updateInProgress:!1};void 0==f&&(f=!0),void 0==g&&(g=[]),void 0==h&&(h=b);var k=function(c){j.updateInProgress=!0,c=c?c.toLowerCase():null,a(function(){var a=null;if(a=c&&""!==c?_.filter(j.undecoratedRows,function(a){var b=!1;for(var d in g){var e=g[d];if(a.hasOwnProperty(e))try{if(a[e].toLowerCase().indexOf(c)!==-1){b=!0;break}}catch(a){}}return b}):j.undecoratedRows,null!=a)if(h<1)j.rows=_.map(a,e);else{var k=a.slice(0,b);j.rows=_.map(k,e)}else j.rows=[];j.rows.totalLength=void 0===d?0:d.length,f&&showMask(!1),void 0!==i&&i(),j.updateInProgress=!1})};return j.addRow=function(a){j.undecoratedRows.push(a),j.rows.push(e(a)),j.sortRows()},j.sortRows=function(){j.rows.sort(function(a,b){var c=a.data.name.toLowerCase,d=b.data.name.toLowerCase;return c<d?-1:c>d?1:0})},j.removeRow=function(a){var b=_.filter(j.rows,function(b){return b.data.id===a});b.length>0&&(_.remove(j.rows,b[0]),_.remove(j.undecoratedRows,j.getUndecoratedRow(a))),j.sortRows()},j.getUndecoratedRow=function(a){return j.undecoratedRows,_.filter(j.undecoratedRows,function(b){return b.id===a})[0]},j.undecoratedRows=d,j.filterApplied=_.debounce(k,c),k(),j}};return d}])}(),function(){var a=angular.module("spectrumCommentsModule",["widgetRestCommentModelModule"]);a.directive("spectrumComments",["widgetCommentService","$timeout",function(a,b){var c=function(c,d,e){c.addNewComment=function(b){delete b.error,!_.isEmpty(b.newComment)&&c.comments.haveAddPermission&&(b.submitting=!0,a.postComment(b.appId,b.ItemKey,b.newComment,b.appType).then(function(d){b.submitting=!1,delete b.newComment;var e=JSON.parse(d.payload);b.allComments.push(a.decorateComment(b.appUrl,e)),a.showModal(b,c.widget);var f=a.getCommentsModel(b.appId,b.ItemKey,b.appType,b.appUrl);b.ready=!0,f.promise.then(function(){b.allComments=f.allComments,a.scrollComments(c.widget)})},function(){b.submitting=!1,b.error="Comment could not be added."}))};var f=function(a,b){var c=function(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},d=function(a){var d=new RegExp("(^|[\\s|@|\\.])("+c(_.escape(b))+")","ig");return _.escape(a).replace(d,"$1<strong>$2</strong>")};return a.renderedBody=d(a.displayName)+" - "+d(a.emailAddress)+" ("+d(a.name)+")",a},g=_.debounce(function(){if(c.comments.mentionControl&&!_.isEmpty(c.comments.mentionControl.controlString)){var b=c.comments.mentionControl.controlString;a.getUsers(c.comments.appId,c.comments.ItemKey,b).then(function(a){if(c.comments.mentionControl&&b==c.comments.mentionControl.controlString&&(c.comments.foundUsers=JSON.parse(a.payload),!_.isEmpty(c.comments.foundUsers))){var d=0;c.comments.selectedUser&&(d=_.findIndex(c.comments.foundUsers,function(a){return c.comments.selectedUser.key==a.key}),d<0&&(d=0)),c.comments.selectedUser=c.comments.foundUsers[d],_.forEach(c.comments.foundUsers,function(a){f(a,c.comments.mentionControl.controlString)})}},function(){c.comments.error="Users could not be loaded.",k()})}},250),h=function(a,b){if(!angular.isUndefined(a)){var c,d=i(b);angular.isUndefined(d)||(c=a.substring(0,d));var e=/(\[~|@)([^(?:\[~)@\r\n]*)$/g.exec(c);return e?{type:e[1],index:e.index,controlString:e[2].trim(),caretPosition:d}:void 0}},i=function(a){var b=0;if(document.selection){a.focus(),a.focus();var c=document.selection.createRange();c.moveStart("character",-a.value.length),b=c.text.length}else(a.selectionStart||"0"==a.selectionStart)&&(b=a.selectionStart);return b},j=function(a,b){if(a.createTextRange){var c=a.createTextRange();c.move("character",b),c.select()}else a.setSelectionRange?(a.focus(),a.setSelectionRange(b,b)):a.focus()},k=function(){delete c.comments.foundUsers,delete c.comments.mentionControl,delete c.comments.selectedUser};c.checkMentions=function(a){if(delete c.comments.error,void 0!==c.comments.newComment&&null!==c.comments.newComment&&c.comments.haveBrowseUserPermission){var b=c.comments.newComment,d=h(b,a.target),e=c.comments.mentionControl;if(d){if(e&&d.type==e.type&&d.index==e.index&&d.caretPosition==e.caretPosition&&d.controlString==e.controlString)return;if("[~"==d.type&&d.controlString.indexOf("]")>-1)return void k();if(c.comments.mentionControl=d,(d.controlString.length>20||d.controlString.split(/\s+/,4).length>3)&&(c.comments.mentionControl.cancelled=!0),e){var f=e.firstNoResultsControlString;if(!f&&c.comments.foundUsers&&0==c.comments.foundUsers.length&&(f=e.controlString),f){if(d.controlString.startsWith(f))return c.comments.mentionControl.firstNoResultsControlString=f,void(d.controlString===f?c.comments.foundUsers=[]:c.comments.mentionControl.cancelled=!0);delete c.comments.foundUsers}}}else delete c.comments.mentionControl;!c.comments.mentionControl||_.isEmpty(c.comments.mentionControl.controlString)?k():g()}},c.onFocus=function(a){delete c.comments.error,b(function(){c.checkMentions(a)})};var l=function(a,d){var e=c.comments.mentionControl;if(e){c.comments.newComment=c.comments.newComment.substring(0,e.index)+"[~"+d.name+"]"+c.comments.newComment.substring(e.caretPosition);var f=e.index+d.name.length+3;b(function(){j(a,f)}),k()}};c.onBlur=function(a){delete c.comments.error,c.comments.mentionControl&&(c.comments.mentionControl.cancelled=!0)},c.selectUser=function(a){var b=d.find("textarea");l(b,a)},c.processKeypress=function(a){if(13==a.keyCode&&!angular.isUndefined(c.comments.foundUsers)&&c.comments.foundUsers.length>0){var b=c.comments.selectedUser||c.comments.foundUsers[0];l(a.target,b),a.preventDefault()}else if(38==a.keyCode){var d=c.comments.foundUsers;if(d){if(c.comments.selectedUser){var e=_.findIndex(d,function(a){return c.comments.selectedUser.key==a.key});e-=1,e<0&&(e=d.length-1),c.comments.selectedUser=d[e]}else c.comments.selectedUser=d[d.length-1];a.preventDefault()}}else if(40==a.keyCode){var d=c.comments.foundUsers;if(d){if(c.comments.selectedUser){var e=_.findIndex(d,function(a){return c.comments.selectedUser.key==a.key});e+=1,e>=d.length&&(e=0),c.comments.selectedUser=d[e]}else c.comments.selectedUser=d[0];a.preventDefault()}}else 27==a.keyCode&&c.comments.foundUsers&&(delete c.comments.foundUsers,delete c.comments.selectedUser,c.comments.mentionControl&&(c.comments.mentionControl.cancelled=!0),a.stopPropagation(),a.preventDefault())}};return{restrict:"E",templateUrl:"partials/spectrum-comments.html",scope:{id:"@",comments:"=",widget:"="},link:c}}])}(),function(){var a=angular.module("spectrumDiffModule",["diffParserModule"]);a.directive("spectrumDiff",["diffParserService",function(a){var b=String.fromCharCode(160),c=b+b+b+b,d=function(d){d.$watch("diff",function(e){if(null!==e&&void 0!==e){var f=a.parseDiff(e),g=_.flatten(_.pluck(f,"hunks"));g.forEach(function(a){a.text=a.text.replace(/ /g,b).replace(/\t/g,c)});var h=_.pluck(g,"oldLineNumber").concat(_.pluck(g,"newLineNumber")),i=_.reduce(h,function(a,b){return b>a?b:a},0),j=i.toString().length;d.formatLineNumber=function(a){for(var c=a?a.toString():"",d=c.length,e=0;e<j-d;e++)c=b+c;return c},d.diffs=f}})};return{restrict:"E",templateUrl:"partials/diff.html",scope:{diff:"="},link:d}}])}(),function(){var a=angular.module("spectrumFooterModule",["restangular"]);a.config(["RestangularProvider",function(a){a.setBaseUrl(baseUrl+"/rest-with-cookies/api/v1")}]),a.directive("spectrumFooter",["Restangular",function(a){var b=function(b){a.one("version").get().then(function(a){b.version=a})};return{restrict:"E",templateUrl:"partials/footer.html",link:b}}])}(),function(){var a=angular.module("groupsModule",["ui.router","angularUtils.directives.uiBreadcrumbs","spectrumLoginModule","spectrumHeaderModule","spectrumMenuModule","spectrumHeadingModule","spectrumFooterModule","spectrumTableModule","spectrumSelectorModule","spectrumRestTableModelModule","spectrumArrayTableModelModule"]);a.config(["$urlRouterProvider","$stateProvider","RestangularProvider",function(a,b,c){setupDefaultRestangularUrlModifications(c),a.otherwise("/groups"),b.state("groups",{abstract:!0,url:"/groups",template:"<ui-view/>",data:{breadcrumbProxy:"groups.list"}}).state("groups.list",{url:"",templateUrl:"partials/all_group.html",controller:"ListController",data:{displayName:"Groups"}}).state("groups.create",{url:"/create",templateUrl:"partials/add_group.html",controller:"CreateController",data:{displayName:"Create Group"}}).state("groups.edit",{url:"/:groupId",templateUrl:"partials/edit_group.html",controller:"EditController",data:{displayName:"Edit Group"}})}]).createErrorHandler=spectrumRestangularErrorHandler,a.controller("ListController",["$scope","Restangular","restTableModelService",function(a,b,c){showMask(!0,"Loading group list"),a.addActions={name:"Add a new group",icon:"plus",run:"group.html#/groups/create"},a.groupRowModel=c.createRestTableModel("groups",function(a){var b={run:"group.html#/groups/"+a.id},c="spec-data-group-";return c+=a.external?"external-":"internal-",c+=a.active?"active":"inactive",a.iconClass=c,a.active=a.active?"yes":"no",{data:a,actions:[],defaultAction:b}})}]).controller("CreateController",["$scope","Restangular",function(b,c){b.active=!0,b.createGroup=function(){var d=b.groupName.trim(),e={name:d,role:b.role,active:b.active};showMask(!0,"Creating group"),c.one("").post("groups",e).then(function(){showMask(!1),window.location="group.html#/groups"},a.createErrorHandler(b))}}]).controller("EditController",["$scope","$stateParams","Restangular","arrayTableModelService",function(b,c,d,e){showMask(!0,"Loading group information"),d.one("groups",c.groupId).get().then(function(a){return b.group=a,b.title=a.name,d.all("users").getList()},a.createErrorHandler(b)).then(function(a){return b.users=a,d.all("users/group/"+b.group.id).getList()},a.createErrorHandler(b)).then(function(a){b.selectedUsers=e.createArrayTableModel(a,function(a){return{data:a,actions:[]}},!0,["name"]);var c=_.pluck(a,"id");b.availableUsers=e.createArrayTableModel(_.filter(b.users,function(a){return c.indexOf(a.id)<0}),function(a){return{data:a,actions:[]}},!0,["name"])},a.createErrorHandler(b)),b.deleteGroup=function(c){b.error=null,bootbox.confirm("Are you sure?<br/>(Note: existing users will be removed from this group)",function(e){e&&(showMask(!0,"Deleting group"),d.all("users/group/"+c).getList().then(function(e){angular.forEach(e,function(a){d.one("users",a.id).one("groups",c).customDELETE()}),d.one("groups",c).remove().then(function(){showMask(!1),window.location="group.html#/groups"},a.createErrorHandler(b))},a.createErrorHandler(b)))})},b.editGroup=function(c){showMask(!0,"Updating group"),b.error=null;var e={id:c,name:b.group.name,role:b.group.role,active:b.group.active,syncCycle:b.group.syncCycle,external:b.group.external,deleted:b.group.deleted};d.one("groups",c).customPUT(e).then(function(){showMask(!1),window.location="group.html#/groups"},a.createErrorHandler(b))},b.changeGroupUsers=function(c){delete b.error;var e=_.pluck(b.availableUsers.undecoratedRows,"id"),f=_.pluck(b.selectedUsers.undecoratedRows,"id");angular.forEach(f,function(e,g){d.one("users",e).one("groups",c).customPUT().then(function(){showMask(!1),g===f.length-1&&(b.successMsg="Group users updated!",$("html, body").animate({scrollTop:0},"fast"))},a.createErrorHandler(b))}),angular.forEach(e,function(e){d.one("users",e).one("groups",c).customDELETE().then(function(){showMask(!1),b.successMsg="Group users updated!",$("html, body").animate({scrollTop:0},"fast")},a.createErrorHandler(b))})}}])}(),function(){var a=angular.module("spectrumHeaderModule",[]);a.directive("spectrumHeader",function(){return{restrict:"E",templateUrl:"partials/header.html"}}),a.controller("HeaderController",["$scope","authStateService",function(a,b){b.authStatePromise.then(function(b){b.isLoggedIn?a.logoUrl="personalised-dashboard.html":a.logoUrl=baseUrl})}])}(),function(){var a=angular.module("spectrumHeadingModule",[]);a.directive("spectrumHeading",function(){return{restrict:"E",templateUrl:"partials/heading.html",scope:{title:"@",subtitle:"@"}}})}(),function(){var a=angular.module("spectrumLoginModule",["spectrumTransformModule","restangular"]);a.config(["RestangularProvider",function(a){a.setBaseUrl(baseUrl+"/rest-with-cookies/api/v1")}]).run(["$rootScope","$http","$q","$templateCache","$compile","$parse","Restangular","authStateService",function(b,c,d,e,f,g,h,i){a.restBaseUrl=baseUrl+"/rest-with-cookies/api/v1";var j=null,k=null;a.setupLogin=function(a){return null!=j&&null!=k?(k.modal("show"),j.promise):(j=d.defer(),c.get("partials/login_modal.html",{cache:e}).success(function(c){var d=b.$new(!0);k=f(c)(d),d.userName=null,d.password=null,d.loginError=!1;var e={backdrop:!a,keyboard:!a};$.fx.off||k.addClass("fade"),k.on("shown.bs.modal",function(){document.getElementById("txt-spec-login-userName").focus(),showMask(!1)}).modal(e),d.submit=function(){i.login(d.userName,d.password).success(function(){a?(k.modal("hide"),j.resolve(!0)):window.location.reload(!0)}).error(function(){d.loginError=!0})}}),j.promise)},a.shouldResponseBeIntercepted=function(a){return 401===a.status&&"NOT_AUTHENTICATED"===a.data.error&&"SPECTRUM"===a.data.systemType&&"SPECTRUM"===a.data.systemName},a.responseQueue=[],h.setErrorInterceptor(function(b,d){return!a.shouldResponseBeIntercepted(b)||(a.inProgress?a.responseQueue.push({response:b,deferred:d}):(a.inProgress=!0,a.setupLogin(!0).then(function(){c(b.config).then(function(b){d.resolve(b.data),i.refreshAuthState();for(var e=0;e<a.responseQueue.length;e++){var f=a.responseQueue[e];c(f.response.config).then(function(a){f.deferred.resolve(a.data)},f.deferred.reject)}a.responseQueue=[],a.inProgress=!1},d.reject)})),!1)})}]),a.factory("authStateService",["$rootScope","$http","Restangular",function(b,c,d){d.setBaseUrl(baseUrl+"/rest-with-cookies/api/v1");var e={refreshAuthState:function(){e.authStatePromise=d.one("users/user-auth-state").get(),e.authStatePromise.then(function(){b.$broadcast("auth-state-changed")})},login:function(b,d){return showMask(!0,"Logging in"),c({method:"POST",url:a.restBaseUrl+"/_login",data:$.param({userName:b,password:d}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(){showMask(!1)}).error(function(){showMask(!1)})},logout:function(){return showMask(!0,"Logging out"),c({method:"POST",url:a.restBaseUrl+"/_logout"}).success(function(){showMask(!1)})}};return e.refreshAuthState(),e}]),a.directive("spectrumLoginButton",["$http","$q","$templateCache","$compile","$parse","authStateService","$location",function(b,c,d,e,f,g,h){var i=function(b){g.authStatePromise.then(function(a){b.auth=a}).then(function(){b.$watch("auth",function(){if(void 0!==b.auth){var a=b.auth.currentUserName,c="anonymousUser"===a;a.length>35&&(a=a.substr(0,35)+"..."),b.message=c?"Log In":"Log Out ("+a+")"}}),b.clicked=function(){b.auth.isLoggedIn?g.logout().success(function(){window.location=baseUrl}):a.setupLogin(!1)},b.isShown=function(){return"/login"!==h.path()||b.auth.isLoggedIn}}),b.$on("auth-state-changed",function(){g.authStatePromise.then(function(a){b.auth=a})})};return{restrict:"E",templateUrl:"partials/menu_item_login.html",replace:!0,link:i}}])}(),function(){var a=angular.module("spectrumMenuModule",["spectrumLoginModule","restangular"]);a.config(["RestangularProvider",function(a){a.setBaseUrl(baseUrl+"/rest-with-cookies/api/v1")}]).shouldShowMenuItem=function(a,b){return!("true"===b.loggedinuseronly&&!a.isLoggedIn)&&!("true"===b.administratoronly&&!a.isAdmin)},a.controller("MenuController",["$scope","$filter","Restangular","authStateService",function(a,b,c,d){a.dashboardLinks=[],d.authStatePromise.then(function(d){d.isLoggedIn&&a.dashboardLinks.push({id:"menu-item-spec-personalised-dashboard",name:"Personalised Dashboard",url:"personalised-dashboard.html#/personalised-dashboard"}),c.all("application/installed-application").getList().then(function(c){if(c.length>0){_.isEmpty(a.dashboardLinks)||a.dashboardLinks.push({});var d=_.map(c,function(a){return{id:"applink-"+a.id,name:a.name,url:a.url,external:!0}});d=b("orderBy")(d,"name",!1),a.dashboardLinks=a.dashboardLinks.concat(d)}},function(){a.dashboardLinks.splice(1,1),a.dashboardLinks.push({id:"dashboards-error",name:"Can't retrieve apps",url:"#"})})}),a.applicationLinks=[{id:"application",name:"Applications Manager",url:"applications.html"
}],a.userLinks=[{id:"user-manage",name:"User Management",url:"user.html"},{id:"group-manage",name:"Group Management",url:"group.html"},{id:"userdirectory-manage",name:"User Directories",url:"userdirectories.html"}],a.processesLinks=[{id:"processes",name:"Processes",url:"process.html"},{id:"process-report-generator",name:"Process Report Generator",url:"process.html#/processes/report-generator"}],a.documentationLinks=[{id:"docs-error",name:"Can't retrieve documentation",url:"#"}],c.all("docs").getList().then(function(b){for(var c=0;c<b.length;c++){var d=b[c];d.id="docs-"+d.name,d.name=d.prettyName,d.external=!0,delete d.prettyName}a.documentationLinks=b})}]),a.directive("spectrumMenu",function(){return{restrict:"E",templateUrl:"partials/menu.html",replace:!0}}).directive("spectrumUserMenu",function(){return{restrict:"E",templateUrl:"partials/user_menu.html",replace:!0}}).directive("spectrumMenuItem",["$rootScope","Restangular","authStateService",function(b,c,d){var e=function(b,c,e){d.authStatePromise.then(function(c){b.show=a.shouldShowMenuItem(c,e)}),b.$on("auth-state-changed",function(){d.authStatePromise.then(function(c){b.show=a.shouldShowMenuItem(c,e)})}),window.location.href.indexOf(baseUrl+"/"+e.page)>-1&&(b.class="active")};return{restrict:"E",templateUrl:"partials/menu_item.html",replace:!0,scope:{title:"@",page:"@",view:"@",administratoronly:"@",loggedinuseronly:"@"},link:e}}]).directive("spectrumMenuDropDown",["authStateService",function(b){var c=function(c,d,e){b.authStatePromise.then(function(b){c.show=a.shouldShowMenuItem(b,e)}),c.$on("auth-state-changed",function(){b.authStatePromise.then(function(b){c.show=a.shouldShowMenuItem(b,e)})})};return{restrict:"E",templateUrl:"partials/menu_drop_down.html",replace:!0,scope:{title:"@",page:"@",actions:"=",view:"@",administratoronly:"@",loggedinuseronly:"@"},link:c}}])}(),function(){var a=angular.module("SpectrumOAuthLoginModule",[]);a.config(["$locationProvider",function(a){a.html5Mode({enabled:!0,requireBase:!1})}]).controller("LoginController",["$scope","$location",function(a,b){a.userName=null,a.password=null,a.loginError=b.search().authentication_error}])}();var blankImage="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";!function(){function a(b){null!=q&&clearTimeout(q),null!==b&&b.hasOwnProperty("refreshInterval")&&b.refreshInterval&&(q=setTimeout(function(){angular.element(".dashboard").scope().editMode?a(b):window.location.reload()},6e4*b.refreshInterval,b))}function b(a,c){_.forEach(a.rows,function(a){_.forEach(a.columns,function(a){c.push({widgets:_.map(a.widgets,d)}),b(a,c)})})}function c(a){var c={};return a.hasOwnProperty("refreshInterval")&&(c.refreshInterval=a.refreshInterval),c.structure=a.structure,c.title=a.title,c.columns=[],b(a,c.columns),c}function d(a){return{id:a.id}}function e(a){var b=[];for(var c in a.rows){var d=a.rows[c];for(var f in d.columns)if(d.columns.hasOwnProperty(f)){var g=d.columns[f];g.hasOwnProperty("rows")&&(b=b.concat(e(g)));for(var h in g.widgets)if(g.widgets.hasOwnProperty(h)){var i=g.widgets[h];b.push(i)}}}return b}function f(a,b,c){a.$on("listApplicationLinksChanged",function(){a.data.applicationLinks=b(a.appType,a.data.chosenApp.id),void 0!==c&&c()})}function g(a,b,c){return b(a.appType).then(function(b){return a.data.availableApps=b,a.data.availableApps.length>0?void h(a):(a.ready=!0,c.reject())})}function h(a){void 0!==a.widget.config.chosenApp?a.data.chosenApp=_.find(a.data.availableApps,{id:a.widget.config.chosenApp}):a.data.chosenApp=a.data.availableApps[0]}function i(a){return a.project="UNKNOWN",a.name="Unknown",a.description="Unknown",a.status="Unknown",a.statusCategory="Unknown",a.icon={src:blankImage,alt:"Unknown"},a.priorityIcon={src:blankImage,alt:"Unknown"},a.assignedImage={src:blankImage,alt:"Unassigned"},a.statusIcon={src:blankImage,alt:"Unknown"},a.fields.hasOwnProperty("project")&&null!==a.fields.project&&(a.project=a.fields.project.name,a.projectIcon={src:a.fields.project.avatarUrls["24x24"],alt:a.fields.project.name}),a.fields.hasOwnProperty("summary")&&null!==a.fields.summary&&(a.name=a.fields.summary),a.fields.hasOwnProperty("description")&&(a.description=a.fields.description),a.fields.hasOwnProperty("issuetype")&&null!==a.fields.issuetype&&(a.icon={src:a.fields.issuetype.iconUrl,alt:a.fields.issuetype.name}),a.fields.hasOwnProperty("priority")&&null!==a.fields.priority&&(a.priorityIcon={src:a.fields.priority.iconUrl,alt:a.fields.priority.name}),a.fields.hasOwnProperty("status")&&null!==a.fields.status&&(a.status=a.fields.status.name,a.statusIcon={src:a.fields.status.iconUrl,alt:a.fields.status.name}),a.fields.status.hasOwnProperty("statusCategory")&&(a.statusCategory=a.fields.status.statusCategory.name),null!=a.fields.assignee&&null!==a.fields.assignee&&(a.assignedImage={src:a.fields.assignee.avatarUrls["24x24"],alt:a.fields.assignee.displayName}),a}function j(a,b,c,d,e){var f={type:b.appType.toLowerCase(),method:c,payload:d};void 0!==b.data.chosenApp&&(f.appId=b.data.chosenApp.id),null!=d&&(f.payload=d),a.all("message").post(f).then(e,p.createErrorHandler(b))}function k(a,b,c,d,e,f,g){var h=JSON.parse(a.payload);void 0!==f&&null!==f&&(h=h[f]),void 0!==g&&null!==g&&(h=h[g]);var i=null;if(h.length>0){var j="id";if(h[0].hasOwnProperty("id")||(j="name"),void 0!==c&&null!==c){var k={};k[j]=c,i=_.find(h,k),void 0==i&&h.length>0&&(i=h[0])}else i=h[0]}b.data[d]=h||[],b.data[e]=i}function l(a,b){var c=a;if(void 0!==a.start.dateTime){var d=moment(a.start.dateTime),e=moment(a.end.dateTime),f=_.result(_.find(b,function(a){return"format24HourTime"===a.id}),"value"),g="hh:mm a";"true"===f&&(g="HH:mm"),c.date=d.format("DD-MM-YYYY"),c.displayTime=d.format(g)+"-"+e.format(g)}else c.displayTime="All Day",c.date=moment(a.start.date).format("DD-MM-YYYY");return c}function m(a,b,c,d,e){var f;return _.forEach(a.data.installedApps,function(a){if(a.atlassianAppLinkId==d)return f=a,!1}),f||(void 0===a.data.applicationLinks&&(a.data.applicationLinks=b(a.appType,a.data.chosenApp.id)),_.forEach(a.data.applicationLinks,function(b){if(b.application.id==d)return _.forEach(a.data.installedApps,function(a){if(b.application.rpcUrl==a.url)return a.atlassianAppLinkId=b.application.id,c.one("application/installed-application",a.id).one("atlassian-app-link-id","").customPUT(b.application.id).then(),f=a,!1}),e&&!f&&(f={url:b.application.url}),!1})),f}function n(a){var b=a.target,c="";c="input"===b.tagName.toLowerCase()?b.value:angular.element("#widget-filter-"+this.wid).val();var d=angular.element("#widget-result-table-"+this.wid).scope();void 0!==d&&d.$parent.resultTable.filterApplied(c)}function o(a,b,c){showMask(!0,"Loading Config"),b.one("nexus/widget/"+a.widget.id+"/config").get().then(function(b){a.errorStatus=null,a.nexusApps=JSON.parse(JSON.parse(b.config).applications),showMask(!1),c(b),$("#widget-modal-"+a.widget.id).modal("show")},function(b){a.errorStatus=b.status,showMask(!1)})}var p=angular.module("personalisedDashboardModule",["ui.router","angularUtils.directives.uiBreadcrumbs","spectrumLoginModule","spectrumHeaderModule","spectrumMenuModule","spectrumHeadingModule","spectrumFooterModule","adf","spectrumTableModule","widgetRestTableModelModule","spectrumArrayTableModelModule","applicationTableModule","minicolors","spectrumWidgetCommonOptionsModule","spectrumWidgetLoadingModule","widgetRestCommentModelModule","spectrumCommentsModule","spectrumTaskTimerModule","spectrumUtilitiesModule","adf.widget.bookmark","adf.widget.nexusPolicy","ui.select"]);setupWidgetTweaks(angular),p.constant("MINICOLORS_SETTINGS",{theme:"bootstrap",position:"bottom right",letterCase:"uppercase"}).constant("TITLE_BAR_COLORS",{txtColor:"#FFFFFF",bgColor:"#374049"}).config(["$urlRouterProvider","$stateProvider","RestangularProvider","dashboardProvider","$provide","$sceDelegateProvider",function(a,b,c,d,e,f){setupDefaultRestangularUrlModifications(c),a.otherwise("/personalised-dashboard"),b.state("personalised-dashboard",{url:"/personalised-dashboard",templateUrl:"partials/personalised-dashboard.html",controller:"personalisedDashboardController",data:{displayName:"Personalised Dashboard"}}),d.widget("confluence-notifications",{title:"Notifications",description:"Up to date list of all your notifications directly from Confluence",templateUrl:"partials/widgets/confluence.html",controller:"confluenceNotificationController"}),d.widget("confluence-tasks",{title:"Tasks",description:"Up to date list of all your tasks in from Confluence",templateUrl:"partials/widgets/confluence.html",controller:"confluenceTaskController"}),d.widget("jira",{title:"Filter Results",description:"Results of a favourite filter from JIRA",templateUrl:"partials/widgets/jira.html",controller:"jiraController"}),d.widget("jira-agile",{title:"Agile Boards",description:"Results of an Agile Board from JIRA",templateUrl:"partials/widgets/jira_agile.html",controller:"jiraAgileController"}),d.widget("jira-sprint-monitor",{title:"Sprint Monitor",description:"Monitoring the progress of a JIRA sprint",templateUrl:"partials/widgets/jira_sprint_monitor.html",controller:"jiraSprintMonitorController"}),d.widget("google-calendar",{title:"Calendar\t",class:"",colour:"",description:"Get updates from your google calendar",templateUrl:"partials/widgets/google_calendar.html",controller:"googleCalendarController"}),d.widget("application-list",{title:"Application List",class:"",colour:"",description:"All applications added to Spectrum",templateUrl:"partials/widgets/application_link.html",controller:"applicationListController"}),d.widget("nexus-evaluation-reports",{title:"Nexus Evaluation Reports",class:"",colour:"",description:"Latest Evaluation Reports from Nexus",templateUrl:"partials/widgets/nexusReport.html",controller:"nexusReportController"}),d.structure("(1) Header with two columns",{iconUrl:"images/dashboard_layouts/Header_with_two_columns.png",rows:[{columns:[{styleClass:"col-md-12"}]},{columns:[{styleClass:"col-md-6"},{styleClass:"col-md-6"}]}]}),d.structure("(2) Thin and thick columns",{iconUrl:"images/dashboard_layouts/Thin_and_thick_columns.png",rows:[{columns:[{styleClass:"col-md-3"},{styleClass:"col-md-9"}]}]}),d.structure("(3) Full page",{iconUrl:"images/dashboard_layouts/Full_page.png",rows:[{columns:[{styleClass:"col-md-12"}]}]}),d.structure("(4) Two columns",{iconUrl:"images/dashboard_layouts/Two_columns.png",rows:[{columns:[{styleClass:"col-md-6"},{styleClass:"col-md-6"}]}]}),f.resourceUrlWhitelist(["self","https://*.google.com/**"])}]).createErrorHandler=spectrumRestangularErrorHandler,p.factory("getAppsOfType",["$rootScope","Restangular",function(a,b){var c=b.all("application/installed-application").getList().then(function(a){return b.all("application/supported-application").getList().then(function(b){var c={};return angular.forEach(a,function(a){var d=_.result(_.find(b,{id:a.supportedAppId}),"name");a.type=d,a.linkConfigured&&(c[a.id]=a)}),c})});return function(a){return c.then(function(b){return null===a||void 0===a?b:_.filter(b,{type:a})})}}]),p.filter("propsFilter",function(){return function(a,b){var c=[];if(angular.isArray(a)){var d=Object.keys(b);a.forEach(function(a){for(var e=!1,f=0;f<d.length;f++){var g=d[f],h=b[g].toLowerCase();if(a[g].toString().toLowerCase().indexOf(h)!==-1){e=!0;break}}e&&c.push(a)})}else c=a;return c}}),p.factory("listApplicationLinks",["$rootScope","Restangular",function(a,b){var c;return function(d,e){return void 0===c&&d&&e&&(c=[],b.all("message").post({type:d,method:"listApplicationLinks",appId:e}).then(function(b){var d=JSON.parse(b.payload);d&&(c=d.list),a.$broadcast("listApplicationLinksChanged")})),c}}]),p.factory("saveWidgetConfig",["Restangular",function(a){return function(b,c){function d(a){a?$(".adf_save").fadeIn("slow",function(){$(".adf_spinner").css({color:"#E25C46"})}):($(".adf_save").fadeOut("slow"),function(){$(".adf_spinner").css({color:"#66BE61"})})}b.widget.id?(d(!0),a.one("dashboard",b.widget.dashboardId).one("widget",b.widget.id).customPUT({config:b.widget.config,title:b.widget.title,autoRefresh:b.widget.autoRefresh,bgColor:b.widget.bgColor,txtColor:b.widget.txtColor,type:b.widget.type}).then(function(a){d(!1),showMask(!1),void 0!==c&&c()},function(){showMask(!1)})):showMask(!1)}}]),p.controller("confluenceNotificationController",["$scope","$q","widget","Restangular","getAppsOfType","listApplicationLinks","arrayTableModelService","saveWidgetConfig","MINICOLORS_SETTINGS","TITLE_BAR_COLORS",function(a,b,c,d,e,h,i,j,k,l){a.appType="Confluence",a.ready=!1,a.resultTable={},a.widget=c,toggleWidgetResize(a.widget),a.widget.searchBox=n,a.data=_.extend({method:"notifications",enableDone:a.widget.config.enableDone},getStandardWidgetData(a,k,l)),a.$watch("resultTable.updateInProgress",function(b,c){c&&!b&&(a.ready=!0)}),a.$watch("data.titleBgColor",function(b,c){a.widget.bgColor=b}),a.$watch("data.titleTxtColor",function(b,c){a.widget.txtColor=b}),a.update=function(b){return void 0===a.data.chosenApp||null===a.data.chosenApp?void(a.ready=!0):(a.ready=!1,a.widget.config.enableDone=a.data.enableDone,void 0!==b&&b&&(a.widget.config.chosenApp=a.data.chosenApp.id,j(a)),a.data.appUrl=a.data.chosenApp.url,a.resultTable={},void d.all("message").post({type:a.appType.toLowerCase(),method:"notifications",appId:a.data.chosenApp.id}).then(function(b){var c;try{c=JSON.parse(b.payload)}catch(a){c=[],console.error(a)}a.resultTable=i.createArrayTableModel(c,function(b){b.prettyDetails=b.title,b.page=b.item.title,b.time=jQuery.timeago(b.created);var c,e=a.data.chosenApp.id;if(b.applicationLinkId){var f=m(a,h,d,b.applicationLinkId,!0);c=f&&f.url?f.url+b.item.url:"#",e=f&&f.id}else c=a.data.appUrl+b.item.url;if(e){var g;if("task.assign"==b.action){var i=/contentId=([^&]*)&/gi.exec(b.globalId);i&&(g=i[1])}else g=b.metadata.pageId;g&&(b.preview={title:"Confluence Page Preview",content:function(){return d.one("application/"+e+"/confluence/page/"+g+"/preview").get()}})}return{data:b,actions:[],url:c,defaultAction:[],external:!0}},!0,["time","page","prettyDetails"])},p.createErrorHandler(a)))},a.saveOptions=function(b){a.config.chosenApp=a.data.chosenApp.id,standardSaveOptions(a,j,b.$valid)},setupWidgetOptionFunctions(a),f(a,h,a.update);var o=function(){return e().then(function(b){a.data.installedApps=b})};g(a,e,b).then(o).then(a.update),a.data.boardList=[{name:"Card board",self:"http://localhost:9876/jira/rest/agile/1.0/board/1",id:1,type:"scrum"},{name:"Black board",self:"http://localhost:9876/jira/rest/agile/1.0/board/2",id:2,type:"kanban"},{name:"Snow board",self:"http://localhost:9876/jira/rest/agile/1.0/board/3",id:3,type:"scrum"}]}]),p.controller("confluenceTaskController",["$scope","$q","widget","Restangular","getAppsOfType","listApplicationLinks","arrayTableModelService","saveWidgetConfig","MINICOLORS_SETTINGS","TITLE_BAR_COLORS",function(a,b,c,d,e,h,i,j,k,l){a.appType="Confluence",a.ready=!1,a.resultTable={},a.widget=c,toggleWidgetResize(a.widget),a.data=_.extend({method:"tasks",enableDone:a.widget.config.enableDone},getStandardWidgetData(a,k,l)),a.$watch("resultTable.updateInProgress",function(b,c){c&&!b&&(a.ready=!0)}),a.$watch("data.titleBgColor",function(b,c){a.widget.bgColor=b}),a.$watch("data.titleTxtColor",function(b,c){a.widget.txtColor=b}),a.update=function(b){void 0!==a.data.chosenApp&&null!==a.data.chosenApp?(a.ready=!1,a.widget.config.enableDone=a.data.enableDone,void 0!==b&&b&&(a.widget.config.chosenApp=a.data.chosenApp.id,j(a)),a.data.appUrl=a.data.chosenApp.url,a.resultTable={},d.all("task/confluence/"+a.data.chosenApp.id).getList({showDone:a.widget.config.enableDone}).then(function(b){a.resultTable=i.createArrayTableModel(b,function(b){return b.prettyDetails=b.description,b.prettyTitle=b.pageTitle,b.remoteId.contentId&&(b.preview={title:"Confluence Page Preview",content:function(){return d.one("application/"+a.data.chosenApp.id+"/confluence/page/"+b.remoteId.contentId+"/preview").get()}}),{data:b,actions:[],url:a.data.appUrl+b.url,defaultAction:[],external:!0,checked:"DONE"===b.status,updateTaskCallback:n}},!0,["prettyTitle","prettyDetails"])},p.createErrorHandler(a))):a.ready=!0},a.saveOptions=function(b){a.config.chosenApp=a.data.chosenApp.id,standardSaveOptions(a,j,b.$valid)},setupWidgetOptionFunctions(a),f(a,h,a.update);var m=function(){return e().then(function(b){a.data.installedApps=b})},n=function(b){var c=d.one("task/confluence/"+a.data.chosenApp.id+"/"+b.remoteId.taskId);c.status="DONE"===b.status?"TODO":"DONE",c.remoteId=b.remoteId,c.put().then(function(){},function(b){bootbox.alert("Sorry, an error occurred while updating task"),a.update()})};g(a,e,b).then(m).then(a.update)}]),p.controller("jiraAgileController",["$scope","$q","widget","Restangular","getAppsOfType","arrayTableModelService","saveWidgetConfig","taskTimer","MINICOLORS_SETTINGS","TITLE_BAR_COLORS","widgetCommentService",function(a,b,c,d,e,f,h,l,m,o,q){a.appType="JIRA",a.ready=!1,a.resultTable={};var r=[{name:"Comments",icon:"comment",class:"default",run:function(a){s(a)}},{name:"Record time",icon:"adjust",class:"default",run:function(b){l.start(a.data.chosenApp,b.key)}}],s=function(b){a.comments=q.getCommentsModel(a.data.chosenApp.id,b.key,a.appType),a.comments.issueTitle=b.name,a.comments.issueKey=b.key,q.showModal(a.comments,a.widget)};a.widget=c,toggleWidgetResize(a.widget),a.widget.searchBox=n,a.data=getStandardWidgetData(a,m,o),a.$watch("resultTable.updateInProgress",function(b,c){c&&!b&&(a.ready=!0)}),a.$watch("data.titleBgColor",function(b,c){a.widget.bgColor=b}),a.$watch("data.titleTxtColor",function(b,c){a.widget.txtColor=b}),a.update=function(b){if(void 0!==a.data.chosenApp&&null!==a.data.chosenApp){a.ready=!1,a.widget.config.chosenApp=a.data.chosenApp.id,void 0!==a.data.chosenBoard&&null!==a.data.chosenBoard&&(a.widget.config.boardId=a.data.chosenBoard.id,a.widget.config.boardType=a.data.chosenBoard.type),void 0!==a.data.chosenColumn&&null!==a.data.chosenColumn&&(a.widget.config.filterOn=a.data.chosenColumn.name),void 0!==b&&b&&h(a),a.data.appUrl=a.data.chosenApp.url;var c={boardId:a.widget.config.boardId,boardType:a.widget.config.boardType};void 0!==a.data.chosenColumn&&null!==a.data.chosenColumn&&void 0===a.data.chosenColumn.isAllColumns&&(c.boardColumn=a.data.chosenColumn.name),d.all("message").post({type:a.appType.toLowerCase(),method:"getIssuesForAgileBoard",appId:a.widget.config.chosenApp,payload:c}).then(function(b){var c=JSON.parse(b.payload),d=[];void 0!==c.issues&&(d=c.issues),a.resultTable=f.createArrayTableModel(d,function(b){return{data:i(b),actions:r,url:a.data.appUrl+"/browse/"+b.key,defaultAction:[],external:!0}},!1,["key","name","status","project"])},p.createErrorHandler(a))}else a.ready=!0},a.getBoardList=function(b){a.ready=!1,a.data.boardList=[],a.data.boardColumns=[],a.resultTable.rows=[],j(d,a,"getAgileBoardList",null,function(c){k(c,a,a.widget.config.boardId,"boardList","chosenBoard","values"),a.getColumnList(b)},function(){a.getColumnList(b)})},a.getColumnList=function(b){a.ready=!1,a.data.boardColumns=[],a.resultTable.rows=[],void 0!==a.data.chosenBoard&&null!==a.data.chosenBoard?j(d,a,"getAgileBoardColumns",{boardId:a.data.chosenBoard.id},function(c){k(c,a,a.widget.config.chosenColumn,"boardColumns","chosenColumn","columnConfig","columns"),a.data.boardColumns.splice(0,0,{name:"-- All columns --",isAllColumns:!0}),null!==a.data.chosenColumn&&"-- All columns --"!==a.widget.config.chosenColumn||(a.data.chosenColumn=a.data.boardColumns[0]),a.update(b)}):a.update(b)},a.saveOptions=function(b){a.config.chosenApp=a.data.chosenApp.id,a.config.chosenBoard=a.data.chosenBoard.id,a.config.chosenColumn=a.data.chosenColumn.name,standardSaveOptions(a,h,b.$valid)},setupWidgetOptionFunctions(a),g(a,e,b).then(a.getBoardList)}]),p.controller("jiraSprintMonitorController",["$scope","$q","widget","Restangular","getAppsOfType","arrayTableModelService","saveWidgetConfig","taskTimer","MINICOLORS_SETTINGS","TITLE_BAR_COLORS",function(a,b,c,d,e,f,h,i,j,k){function l(a){for(var b="",c=0;c<a.length;c++)b=Object.keys(a[c].icon)[0],a[c].icon={alt:b,src:a[c].icon[b]};return a}function m(a){return a>=0?"5cb85c":"d9534f"}a.appType="JIRA",a.ready=!1,a.resultTable={},a.widget=c,toggleWidgetResize(a.widget),a.data=_.extend({sprintList:[]},getStandardWidgetData(a,j,k)),a.sprintData={excludeInProgress:!1},a.$watch("resultTable.updateInProgress",function(b,c){c&&!b&&(a.ready=!0)}),a.$watch("data.titleBgColor",function(b,c){a.widget.bgColor=b}),a.$watch("data.titleTxtColor",function(b,c){a.widget.txtColor=b}),a.update=function(b){void 0!==a.data.chosenApp&&null!==a.data.chosenApp&&void 0!==a.data.chosenSprint&&null!==a.data.chosenSprint?(a.ready=!1,a.widget.config.chosenApp=a.data.chosenApp.id,void 0!==a.data.chosenSprint&&null!==a.data.chosenSprint&&(a.widget.config.sprintId=a.data.chosenSprint.id,a.widget.config.boardName=a.data.chosenSprint.boardName,a.widget.config.appId=a.data.chosenApp.id),void 0!==b&&b&&h(a),a.data.appUrl=a.data.chosenApp.url,d.one("application",a.data.chosenApp.id).one("jira").one("sprint",a.data.chosenSprint.id).get({boardName:a.data.chosenSprint.boardName}).then(function(b){a.generateSprintData(b),a.ready=!0},function(){a.ready=!0})):a.ready=!0},a.getBoardSprintList=function(b){a.ready=!1,a.data.sprintData={},a.data.sprintList=[],a.resultTable.rows=[],d.one("application",a.data.chosenApp.id).one("jira").getList("sprint").then(function(c){for(var d=0;d<c.length;d++)a.data.sprintList.push({id:c[d].id,sprintName:c[d].name,boardId:c[d].boardId,boardName:c[d].boardName,name:c[d].boardName+" - "+c[d].name});void 0!==a.config.sprintId&&(a.data.chosenSprint=_.find(a.data.sprintList,{id:a.widget.config.sprintId,boardName:a.widget.config.boardName})),void 0===a.data.chosenSprint&&a.data.sprintList.length>0&&(a.data.chosenSprint=a.data.sprintList[0]),a.update(b),a.ready=!0},function(){a.ready=!0})},a.getSprintData=function(b){void 0!==a.data.chosenSprint&&null!==a.data.chosenSprint?(a.ready=!1,b&&(a.widget.config.sprintId=a.data.chosenSprint.id,a.widget.config.boardName=a.data.chosenSprint.boardName),d.one("application",a.data.chosenApp.id).one("jira").one("sprint",a.data.chosenSprint.id).get({boardName:a.data.chosenSprint.boardName}).then(function(b){a.generateSprintData(b),a.ready=!0},function(){a.ready=!0})):a.update(b)},a.onHoverSprintSection=function(b){function c(){try{a.$apply()}catch(a){}a.tableIssues=$("#issues-"+a.widget.wid).html();var c=$("#bar-"+b+"-"+a.widget.wid).attr("data-content",a.tableIssues).data("bs.popover");c.setContent(),c.$tip.addClass(c.options.placement)}d.one("application",a.data.chosenApp.id).one("jira").one("sprint",a.data.chosenSprint.id).one("issue").get({status:b}).then(function(b){a.issuePopupTable=f.createArrayTableModel(l(b),function(b){return{data:b,url:a.data.appUrl+"/browse/"+b.key,defaultAction:[],external:!0}},!1,void 0,void 0,c)})},a.generateSprintData=function(b){if(b){a.sprintData.remainingDays=b.remainingDays,a.sprintData.totalDays=b.totalDays,a.sprintData.currentDay=b.totalDays-b.remainingDays,a.sprintData.inProgressEstimate=b.inProgressEstimate,a.sprintData.percentComplete=(b.totalDays-b.remainingDays)/b.totalDays*100,a.sprintData.excludeInProgress&&(b.todoEstimate+=b.inProgressEstimate,b.inProgressEstimate=0),a.sprintData.totalEstimate=b.todoEstimate+b.inProgressEstimate+b.doneEstimate,a.sprintData.todoPercent=b.todoEstimate/a.sprintData.totalEstimate*100,a.sprintData.inProgressPercent=b.inProgressEstimate/a.sprintData.totalEstimate*100,isNaN(a.sprintData.todoPercent)&&isNaN(a.sprintData.inProgressPercent)?(a.sprintData.todoPercent=0,a.sprintData.inProgressPercent=0,a.sprintData.donePercent=100):a.sprintData.donePercent=b.doneEstimate/a.sprintData.totalEstimate*100,a.sprintData.sprintVariance=0,a.sprintData.percentComplete>0&&(a.sprintData.sprintVariance=100*(a.sprintData.donePercent/a.sprintData.percentComplete-1)),a.sprintData.varianceColour=m(a.sprintData.sprintVariance),a.tableIssues=$("#issues-"+a.widget.wid).html();for(var c=["done","inprogress","notstarted"],d=0;d<c.length;d++)$("#bar-"+c[d]+"-"+a.widget.wid).popover("destroy"),$("#bar-"+c[d]+"-"+a.widget.wid).popover({trigger:"manual",html:!0,container:"body",content:function(){return a.tableIssues}}).on("mouseenter",function(){var a=this;$(this).popover("show"),$(".popover").on("mouseleave",function(){$(a).popover("hide")})}).on("mouseleave",function(){var a=this;setTimeout(function(){$(".popover:hover").length||$(a).popover("hide")},100)})}},a.saveOptions=function(b){b.$valid&&(a.config.chosenApp=a.data.chosenApp.id,a.config.chosenSprint=a.data.chosenSprint.id),standardSaveOptions(a,h,b.$valid)},setupWidgetOptionFunctions(a),g(a,e,b).then(a.getBoardSprintList)}]),p.controller("jiraController",["$scope","$q","widget","Restangular","getAppsOfType","jiraRestTableModelService","saveWidgetConfig","MINICOLORS_SETTINGS","TITLE_BAR_COLORS","widgetCommentService","taskTimer",function(a,b,c,d,e,f,h,i,l,m,o){a.appType="JIRA";var p=[{name:"Comments",icon:"comment",class:"default",run:function(a){q(a)}},{name:"Record time",icon:"adjust",class:"default",run:function(b){o.start(a.data.chosenApp,b.key)}}],q=function(b){a.comments=m.getCommentsModel(a.data.chosenApp.id,b.key,a.appType,a.data.appUrl),a.comments.issueTitle=b.name,a.comments.issueKey=b.key,m.showModal(a.comments,a.widget)};a.ready=!1,a.resultTable={},a.widget=c,toggleWidgetResize(a.widget),a.widget.searchBox=n,a.data=getStandardWidgetData(a,i,l),a.$watch("resultTable.updateInProgress",function(b,c){c&&!b&&(a.ready=!0)}),a.$watch("data.titleBgColor",function(b,c){a.widget.bgColor=b}),a.$watch("data.titleTxtColor",function(b,c){a.widget.txtColor=b}),a.update=function(b){void 0!==a.data.chosenApp&&null!==a.data.chosenApp&&(a.ready=!1,a.widget.config.chosenApp=a.data.chosenApp.id,void 0!==a.data.chosenFilter&&null!==a.data.chosenFilter&&(a.widget.config.filterId=a.data.chosenFilter.id),void 0!==b&&b&&h(a),a.data.appUrl=a.data.chosenApp.url,a.widget.config.filterId?a.resultTable=f.createRestTableModel({type:a.appType.toLowerCase(),id:a.data.chosenApp.id,url:a.data.appUrl},a.widget,!1,p):a.ready=!0,_.isEmpty(a.resultTable)?$("#widget-filter-"+a.widget.wid).popover("destroy"):$("#widget-filter-"+a.widget.wid).popover({container:"body",content:"Search on <b>name</b> or <b>description</b>",placement:"top",trigger:"focus",html:!0}))},a.getFilterList=function(b){a.ready=!1,a.data.favouriteFilters=[],a.data.chosenFilter=null,a.resultTable.rows=[],j(d,a,"getFilters",null,function(c){k(c,a,a.widget.config.filterId,"favouriteFilters","chosenFilter"),0===a.data.favouriteFilters.length&&delete a.widget.config.filterId,a.update(b)})},a.saveOptions=function(b){a.ready=!1,a.config.chosenApp=a.data.chosenApp.id,a.config.chosenFilter=a.data.chosenFilter.id,standardSaveOptions(a,h,b.$valid)},setupWidgetOptionFunctions(a),g(a,e,b).then(a.getFilterList)}]),p.controller("googleCalendarController",["$scope","widget","Restangular","getAppsOfType","arrayTableModelService","saveWidgetConfig","MINICOLORS_SETTINGS","TITLE_BAR_COLORS",function(a,b,c,d,e,f,g,h){a.ready=!1,a.resultTable={},a.widget=b,toggleWidgetResize(a.widget),a.data=_.extend({authorized:!1,googleAuthorisationUrl:"",showCalender:!1,iframesrc:"",availableTypes:[{name:"Table",value:"table"},{name:"Grid",value:"grid"}]},getStandardWidgetData(a,g,h)),a.$watch("resultTable.updateInProgress",function(b,c){c&&!b&&(a.ready=!0)}),a.$watch("data.titleBgColor",function(b,c){a.widget.bgColor=b}),a.$watch("data.titleTxtColor",function(b,c){a.widget.txtColor=b}),a.authorize=function(){angular.element(".dashboard").scope().toggleEditMode(),window.location.href=a.data.googleAuthorisationUrl},a.deauthorize=function(){a.ready=!1,c.all("message").post({type:"google-calendar",method:"deauthorize",appId:null}).then(function(){a.widget.title="Calendar\t",a.data.windowTitle="Calendar\t",standardSaveOptions(a,f,!0),a.data.authorized=!1,a.update(!0)},function(){a.ready=!0})},a.getFilterList=function(b){a.ready=!1,a.data.timeFilters=[],a.data.chosenTimeFilter={},a.resultTable.rows=[],a.appType="google-calendar",j(c,a,"eventOptions",null,function(c){k(c,a,a.widget.config.timeFilterId,"timeFilters","chosenTimeFilter"),a.data.chosenTimeFilter=_.find(a.data.timeFilter,{value:a.widget.config.timeFilterId}),a.data.chosenType=_.find(a.data.availableTypes,{value:a.widget.config.chosenType}),void 0===a.data.chosenType&&(a.data.chosenType=a.data.availableTypes[0]),a.update(b)})},a.update=function(b){a.ready=!1,void 0!==a.data.chosenTimeFilter&&null!==a.data.chosenTimeFilter&&(a.widget.config.timeFilterId=a.data.chosenTimeFilter.value),a.data.showCalender=!1,void 0!==a.data.chosenType&&null!==a.data.chosenType&&(a.widget.config.chosenType=a.data.chosenType.value,"grid"==a.widget.config.chosenType&&(a.data.showCalender=!0)),void 0!==b&&b&&f(a),c.all("message").post({type:"google-calendar",method:"getData",appId:null,payload:a.widget.config}).then(function(b){var d=JSON.parse(b.payload);if(a.data.chosenTimeFilter=_.find(a.data.timeFilters,{value:a.widget.config.timeFilterId}),!a.widget.config.timeFilterId&&a.data.timeFilters.length>0&&(a.data.chosenTimeFilter=a.data.timeFilters[0]),a.data.authorized=d.hasOwnProperty("credential")?d.credential:d.hasOwnProperty("eventList"),a.data.authorized){"Calendar\t"===a.$parent.$parent.definition.title&&(a.widget.title=a.data.windowTitle=("Calendar - "+d.eventList.summary).substring(0,60));var f=_.find(d.calendarList.items,{primary:!0});void 0===f&&(f=d.calendarList.items[0]),a.data.iframesrc="https://calendar.google.com/calendar/embed?bgcolor=%23F5F5F5&src="+f.id,"30_days"!==a.widget.config.timeFilterId&&(a.data.iframesrc+="&mode=WEEK"),a.resultTable=e.createArrayTableModel(d.eventList.items,function(a){function b(a){return a.length>0&&(a=a[0].toUpperCase()+a.substring(1)),"NeedsAction"==a&&(a="Awaiting Response"),a}void 0===a.location&&(a.location="Undefined"),a=l(a,d.settings),a.event=void 0!=a.summary?a.summary:"Untitled event",a.details=a.description;var c;c=void 0!==a.start.dateTime?moment(a.start.dateTime).valueOf():moment(a.start.date).valueOf(),a.time=c;var e="N/A";if(void 0!==a.organizer.self&&a.organizer.self===!0)e="Organizer";else{var f,g,h=a.attendees;for(f=0,g=h.length;f<g;++f)void 0!==h[f].self&&(e=b(h[f].responseStatus))}return a.attending=e,{data:a,actions:[],url:a.htmlLink,defaultAction:[],external:!0}},!1,["date","time","event","details","location","attending"])}else c.one("google/authorisation-url").get().then(function(b){a.widget.title="Calendar\t",a.data.googleAuthorisationUrl=b,a.ready=!0},function(){a.ready=!0})},p.createErrorHandler(a))},a.getFilterList(!1),a.saveOptions=function(b){b.$valid&&(a.config.timeFilterId=a.data.chosenTimeFilter.value,a.widget.title=a.data.windowTitle),standardSaveOptions(a,f,b.$valid)},setupWidgetOptionFunctions(a)}]),p.controller("applicationListController",["$scope","widget","Restangular","getAppsOfType","arrayTableModelService","saveWidgetConfig","MINICOLORS_SETTINGS","TITLE_BAR_COLORS",function(a,b,c,d,e,f,g,h){a.ready=!1,a.resultTable={};var i={RUNNING:"ok",STOPPED:"remove",NOT_CONFIGURED:"ban-circle",INVALID_SERVER:"exclamation-sign"};a.widget=b,toggleWidgetResize(a.widget),a.widget.searchBox=n,a.data=_.extend({gridMode:void 0===a.widget.config.gridLayout||a.widget.config.gridLayout},getStandardWidgetData(a,g,h)),a.$watch("resultTable.updateInProgress",function(b,c){c&&!b&&(a.ready=!0)}),a.$watch("data.titleBgColor",function(b,c){a.widget.bgColor=b}),a.$watch("data.titleTxtColor",function(b,c){a.widget.txtColor=b}),a.update=function(b){a.ready=!1,c.all("message").post({type:"application-list",method:"getData",appId:null}).then(function(b){var c=JSON.parse(b.payload);a.resultTable=e.createArrayTableModel(c,function(a){return a.statusIcon=i[a.status],a.oauthLinkConfigured=a.linkConfigured?"Yes":"No",a.pictureType=a.type.toLowerCase(),{data:a,url:a.url,defaultAction:[],external:!0}},!1,["name","type"]),a.ready=!1},function(){a.ready=!0})},a.update(!1),a.$watch("data.gridMode",function(b){"string"==typeof b&&(b="true"===b),a.widget.config.gridLayout!==b&&(a.widget.config.gridLayout=b,
f(a))}),a.saveOptions=function(b){standardSaveOptions(a,f,b.$valid)},setupWidgetOptionFunctions(a)}]),p.controller("nexusReportController",["$q","$scope","widget","Restangular","getAppsOfType","arrayTableModelService","saveWidgetConfig","MINICOLORS_SETTINGS","TITLE_BAR_COLORS",function(a,b,c,d,e,f,g,h,i){b.showConfigModal=!1,b.ready=!0,b.hasResults=!1,b.nexusApps=[],b.errorStatus=null,b.widget=c,toggleWidgetResize(b.widget),b.data=getStandardWidgetData(b,h,i),setupWidgetOptionFunctions(b),$("#widget-modal-"+c.id).on("shown.bs.modal",function(){b.showConfigModal=!0}),b.showWidgetConfigModal=function(){b.ready=!0,o(b,d,function(a){angular.forEach(b.nexusApps,function(a){var b=a.reports.filter(function(a){return a.selected});angular.forEach(b,function(b){a.selectedStages||(a.selectedStages=[]),a.selectedStages.push(b.stage)})})})},b.saveNexusConfig=function(a){var c=[];angular.forEach(a,function(a){var b=a.selected;if(b){var d={};d.name=a.name,d.showLicenseData=a.showLicenseData,d.showSecurityData=a.showSecurityData,d.selected=a.selected,d.internalId=a.internalId;var e=[];angular.forEach(a.reports,function(b){var c={};a.selectedStages&&a.selectedStages.indexOf(b.stage)>=0&&(c.selected=!0,c.stage=b.stage,c.reportDataUrl=b.reportDataUrl,c.reportLinkUrl=b.reportLinkUrl,e.push(c))}),d.reports=e,c.push(d)}}),b.config.applications=c,standardSaveOptions(b,g,!0)},b.update=function(){b.ready=!1,d.all("nexus/widget/"+c.id+"/report").getList().then(function(a){b.errorStatus=null,b.hasResults=!1,b.nexusApps=a,b.nexusApps&&b.nexusApps.forEach(function(a){var c=a.selected&&a.hasOwnProperty("reports")&&a.reports.length>0&&(a.showSecurityData||a.showLicenseData);if(a.reports){var d=!1;a.reports.forEach(function(a){d=d||a.selected}),c=c&&d}a.hasResults=c,b.hasResults=b.hasResults||c}),b.ready=!0},function(a){b.errorStatus=a.status,b.ready=!0})},void 0!==c.id&&b.update()}]),p.controller("personalisedDashboardController",["$q","$scope","Restangular","authStateService","$timeout","getAppsOfType","taskTimer","dashboard",function(b,d,f,g,h,i,j,k){showMask(!0,"Loading Dashboard"),d.data={prettyTimeSpentOnTask:0},d.availableApps={},i().then(function(a){d.availableApps=a,q()});var l="partials/widgets/widgetTitleTemplate.html";d.model={structure:"(1) Header with two columns",rows:[]},d.activeTaskTimers=[],d.resetDashboard=function(){d.model={structure:"(1) Header with two columns",rows:[{columns:[{styleClass:"col-md-12",widgets:[{type:"jira",config:{}}]}]},{columns:[{styleClass:"col-md-6",widgets:[{type:"confluence-tasks",config:{}}]},{styleClass:"col-md-6",widgets:[{type:"confluence-notifications",config:{}}]}]}]},d.model.title="Dashboard",d.model.titleTemplateUrl="partials/widgets/dashboardTitleTemplate.html",d.model.editTemplateUrl="partials/widgets/dashboardEdit.html";var a=e(d.model);for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];c.titleTemplateUrl=l,c.autoRefresh="0"}$("#reset-dashboard-modal").modal("hide")};var m=function(a){var b=a.structure,c=k.structures[b];c||(b=_.first(Object.keys(k.structures)),c=k.structures[b],console.warn("Dashboard layout structure with name '"+a.structure+"' could not be found. Using '"+b+"' instead"));for(var d={id:a.id,title:a.title,structure:b,rows:_.cloneDeep(c.rows),refreshInterval:a.refreshInterval},e=_.clone(a.columns);!_.isEmpty(e);)n(d,e);return d},n=function(a,b){_.forEach(a.rows,function(a){return!_.isEmpty(b)&&void _.forEach(a.columns,function(a){return!_.isEmpty(b)&&void(_.isUndefined(a.row)?o(b.shift(),a):n(a,b))})})},o=function(a,b){b.widgets||(b.widgets=[]),a&&a.widgets&&_.forEach(a.widgets,function(a){a.config||(a.config={}),b.widgets.push(a)})};f.all("dashboard").getList().then(function(a){return _.isEmpty(a)?b.reject():f.one("dashboard",a[0].id).get()}).then(function(b){d.model=m(b),d.model.titleTemplateUrl="partials/widgets/dashboardTitleTemplate.html",d.model.editTemplateUrl="partials/widgets/dashboardEdit.html",a(d.model),d.model.hasOwnProperty("refreshInterval")&&($('input[name="refreshIntervalRadio"]').prop("checked",!1),$("#refresh-timer-"+d.model.refreshInterval).prop("checked",!0));var c=e(d.model);for(var f in c)if(c.hasOwnProperty(f)){var g=c[f];g.titleTemplateUrl=l,setupIndividualRefreshTimer(g)}showMask(!1)},p.createErrorHandler(d)),d.$on("adfDashboardChanged",function(a,g,h){var i=function(a){var c=e(a),d=[];return _.forEach(c,function(b){b.id?d.push(f.one("dashboard",a.id).one("widget",b.id).customPUT({config:b.config,title:b.title,autoRefresh:b.autoRefresh,bgColor:b.bgColor,txtColor:b.txtColor,type:b.type,height:b.height}).then(function(a){})):d.push(f.one("dashboard",a.id).one("widget","").customPOST({config:b.config,title:b.title,autoRefresh:b.autoRefresh,bgColor:b.bgColor,txtColor:b.txtColor,type:b.type,height:b.height}).then(function(a){b.id=a.id,b.dashboardId=a.dashboardId,toggleWidgetResize(b)}))}),b.all(d)};i(d.model).then(function(){return f.one("dashboard",d.model.id).customPUT(c(d.model))}).catch(p.createErrorHandler(d))},p.createErrorHandler(d)),d.cancelResetDashboard=function(){$("#reset-dashboard-modal").modal("hide")},d.$on("resetDashboardTriggered",function(){$("#reset-dashboard-modal").modal("show")}),d.$on("adfWidgetAdded",function(a,b,c,d){d.titleTemplateUrl=l,toggleWidgetResize(d)}),d.$on("adfAutoRefreshButtonClicked",function(){$("#dashboard-refresh-timer-modal").modal("show")}),d.setupRefreshTimer=function(){d.model.refreshInterval=parseInt($('input[name="refreshIntervalRadio"]:checked').val(),10),$("#dashboard-refresh-timer-modal").modal("hide"),a(d.model),d.$broadcast("adfDashboardChanged")},d.cancelDashboardRefreshModal=function(){$("#dashboard-refresh-timer-modal").modal("hide")},d.stopTaskTimer=function(){j.stop(d.availableApps[d.activeTaskTimers[0].appId],d.activeTaskTimers[0].id)};var q=function(){if(d.activeTaskTimers&&d.activeTaskTimers.length&&d.availableApps&&d.availableApps[d.activeTaskTimers[0].appId]){var a=d.activeTaskTimers[0],b=a.summary;$(".activeTaskTimerName").popover("destroy"),$(".activeTaskTimerName").popover({content:"<em>"+_.escape(d.availableApps[a.appId].name)+"</em>: "+_.escape(a.remoteId)+(b?" / "+_.escape(b):""),html:!0,placement:"auto top"})}};d.getActiveTaskTimers=function(){f.all("task-timer").getList().then(function(a){d.activeTaskTimers=a,d.updateTimerDuration(),a&&a.length&&f.one("application/"+a[0].appId+"/jira/issue/"+a[0].remoteId).get({fields:"summary"}).then(function(a){d.activeTaskTimers[0].summary=a.summary,q()})})},d.getActiveTaskTimers(),d.$on("taskTimersUpdated",function(a,b,c){d.getActiveTaskTimers()}),d.showTaskPopoverIfNeeded=function(a){var b=a.target.closest(".activeTaskTimerName");b&&b.offsetWidth<b.scrollWidth&&$(b).popover("show")},d.hideTaskPopover=function(a){$(a.target).closest(".activeTaskTimerName").popover("hide")};var r=null;d.updateTimerDuration=function(){if(null!=d.activeTaskTimers&&d.activeTaskTimers.length>0){var a=moment.utc(d.activeTaskTimers[0].startTime);d.data.prettyTimeSpentOnTask=a.fromNow()}else d.data.prettyTimeSpentOnTask=0;null!=r&&clearTimeout(r),r=h(d.updateTimerDuration,1e3)}}]);var q=null}(),function(){var a=angular.module("spectrumPopoverModule",[]);a.directive("spectrumPopover",function(){var a=function(a,b,c){$(b).popover({trigger:"hover",html:!0,content:c.popoverText,placement:c.popoverPlacement})};return{restrict:"A",link:a}})}(),function(){var a=angular.module("projectsModule",["ui.router","angularUtils.directives.uiBreadcrumbs","ngAnimate","angularBootstrapNavTree","spectrumLoginModule","spectrumHeaderModule","spectrumMenuModule","spectrumHeadingModule","spectrumFooterModule","spectrumTableModule","spectrumSelectorModule","spectrumRestTableModelModule","spectrumArrayTableModelModule","spectrumTransformModule"]);a.constant("DATE_FORMAT","MMM Do, YYYY h:mm:ss A").config(["$urlRouterProvider","$stateProvider","RestangularProvider",function(a,b,c){setupDefaultRestangularUrlModifications(c),a.otherwise("/projects"),b.state("projects",{abstract:!0,url:"/projects",template:"<ui-view/>",data:{breadcrumbProxy:"projects.list"}}).state("projects.list",{url:"",templateUrl:"partials/project-list.html",controller:"ListController",data:{displayName:"Projects"}}).state("projects.create",{url:"/create",templateUrl:"partials/project-create.html",controller:"CreateController",data:{displayName:"Create Project"}})}]).createErrorHandler=function(a){return function(b){spectrumRestangularErrorHandler(a),document.getElementById("btn-spec-project-save").disabled=!1}},a.controller("ListController",["$scope","Restangular","restTableModelService","DATE_FORMAT",function(b,c,d,e){showMask(!0,"Loading project information"),b.addActions={name:"Create a new project",icon:"plus",run:"project.html#/projects/create"};var f=[];c.all("application/installed-application").getList().then(function(g){var h={};angular.forEach(g,function(a){h[a.id]=a}),c.all("application/supported-application").getList().then(function(a){f=a,b.projectRowModel=d.createRestTableModel("projects",function(a){var b=[],c=({run:"project.html#/projects/"+a.id},[]);return a.appNames="",angular.forEach(a.applicationIds,function(d){var e=h[d];c.push(e),a.appNames=a.appNames.concat(e.name,":  ");var g=_.result(_.find(f,{id:e.supportedAppId}),"name");switch(a[g.toLowerCase().replace(" ","")+"App"]="blank glyphicon glyphicon-ok",g.toLowerCase()){case"jira":b.push({name:"JIRA Homepage",icon:"share",class:"default",url:e.url+"/browse/"+a.key,external:!0});break;case"confluence":var i=_.find(a.projectApplicationDetails,{id:d}),j=a.key,k="";"false"==i.projectParameters.createSpace&&(j=i.projectParameters.spaceKey,k="/"+encodeURIComponent(a.name));var l=e.url+"/display/"+j+k;b.push({name:"Confluence Homepage",icon:"share",class:"default",url:l,external:!0});break;case"bitbucket server":b.push({name:"Bitbucket Server Homepage",icon:"share",class:"default",url:e.url+"/projects/"+a.key,external:!0})}}),a.apps=c,a.createdDate=moment(new Date(a.createdDate)).format(e),{data:a,actions:b,defaultAction:void 0}})},a.createErrorHandler(b))})}]).controller("CreateController",["$scope","$q","Restangular","authStateService","restTableModelService","arrayTableModelService","$timeout","$window",function(b,c,d,e,f,g,h,i){function j(a){return g.createArrayTableModel(a,function(a){return{data:a}},!1,["name"])}function k(a){var c=[];return angular.forEach(b.apps,function(b){if(b.selected){var d={};switch(d.id=b.id,b.type.toLowerCase()){case"jira":if(a)break;var e={projectTemplateModuleKey:b.jiraTemplateModuleKey,projectTemplateWebItemKey:_.result(_.find(b.jiraTemplates,{projectTemplateModuleKey:b.jiraTemplateModuleKey}),"projectTemplateWebItemKey")};d.jiraDetail=e;case"confluence":var f={spaceKey:b.confluenceSpaceKey,createSpace:b.createSpace,parentPageId:b.confluencePageId};d.confluenceDetail=f}c.push(d)}}),c}showMask(!0,"Loading project information");var l=[],m=[];b.appSubmitted=!1,$("#panel-spec-projects-apps").collapse("show"),d.all("application/supported-application").getList().then(function(c){m=c,d.all("groups").getList().then(function(a){l=_(a).filter({external:!0,active:!0,deleted:!1}).map(function(a){return{id:a.id,name:a.name,role:a.role}}).value(),b.adminGroupOptions=b.userGroupOptions=l.slice(),b.adminGroupId="",b.userGroupId=""},a.createErrorHandler(b));var e=[];d.all("application/installed-application").getList().then(function(c){var f=c.length;0==f&&showMask(!1),d.all("projects/supported-application").getList().then(function(a){b.projectWizardSupportedApps=a.slice(),angular.forEach(c,function(a){var c,d="";a.linkConfigured?"RUNNING"==a.status?(d="Configured",c=!1):(d="Stopped",c=!0):(c=!0,d=_.find(b.projectWizardSupportedApps,function(b){return b.id==a.supportedAppId})?"Not-Authenticated":"Not-Supported");var g=_.find(m,function(b){return b.id==a.supportedAppId}).name,h={id:a.id,name:a.name,type:_.find(m,function(b){return b.id==a.supportedAppId}).name,status:d,selected:!c,isDisabled:c,jiraTemplates:null,createSpace:!0,spaceData:[{label:"Loading...",children:["Please wait."]}]};"crowd"!=g.toLowerCase()&&e.push(h),f-=1,0==f&&showMask(!1)},function(){f-=1,0==f&&showMask(!1)})},a.createErrorHandler(b)),b.apps=e},a.createErrorHandler(b)),b.availableUsers=j([]),b.availableAdminUsers=j([]),b.selectedUsers=j([]),b.selectedAdminUsers=j([]),d.all("users").getList().then(function(a){b.allUsers=a;var c=[];angular.forEach(a,function(a){a.external&&c.push(a)}),b.availableUsers=j(c.slice()),b.availableAdminUsers=j(c.slice())},a.createErrorHandler(b))},a.createErrorHandler(b)),b.getGroupMembers=function(c,e){return null===c||void 0===c||""===c?void(e?b.adminUsersInGroup=[]:b.usersInGroup=[]):void d.all("users/group/"+c).getList().then(function(a){e?b.adminUsersInGroup=a:b.usersInGroup=a},a.createErrorHandler(b))},b.keyValid=!1;var n="ThIsKeYwAsNeVeRtEsTeD";b.checkKeyAvailable=function(f,g){function i(a){return a.detailsSubmitted=!1,a.privilegesSubmitted=!1,$("#panel-spec-projects-users").collapse("hide"),!1}if(!g&&b.key==n){h(function(){n="ThIsKeYwAsNeVeRtEsTeD"},300),i(b);var j=c.defer();return j.resolve(!1),j.promise}void 0!=f&&f&&showMask(!0,"Checking key available");var l=e.authStatePromise.then(function(c){var e=document.getElementById("project-key-validated");return e.className="glyphicon glyphicon-refresh glyphicon-refresh-animate",e.style.color="black",h(function(){if(void 0===b.key||""===b.key)return showMask(!1),e.className="glyphicon glyphicon-remove-sign",e.style.color="red",b.keyValid=!1,i(b);n=b.key;var c=k(!1);return d.all("projects/validate-key").post({key:b.key,projectApplicationDetailsList:c,projectName:b.name}).then(function(a){return showMask(!1),b.keyValid=a.keyValid,a.keyValid?(e.className="glyphicon glyphicon-ok-sign",e.style.color="green",delete b.error,!0):(e.className="glyphicon glyphicon-remove-sign",e.style.color="red",i(b))},function(c){return showMask(!1),b.keyValid=!1,e.className="glyphicon glyphicon-remove-sign",e.style.color="red",a.createErrorHandler(b)(c),i(b)})})});return l},b.projectKeyKeyUp=_.debounce(b.checkKeyAvailable,10),b.$watch("key",function(){void 0!==b.key&&(b.key=b.key.toLocaleUpperCase().replace(/\W/g,"").replace("_",""),b.key=b.key.substring(0,Math.min(b.key.length,10)))}),b.$watch("name",function(){if(void 0!==b.name){b.key="";var a=b.name.replace("_",""),c=a.split(" ");if(1===c.length)b.key=a.replace(/\W/g,"").substring(0,Math.min(a.length,Math.max(4,Math.floor(a.length/2)))).toUpperCase();else for(var d=0;d<c.length;d++){var e=c[d][0];void 0!==e&&(e=e.replace(/\W/g,""),""!==e&&(b.key+=c[d][0].toUpperCase()))}b.key=b.key.substring(0,Math.min(b.key.length,10))}}),b.projectUsernames=[],b.projectAdminUsernames=[],b.$watch("adminGroupId",function(){void 0!==b.adminGroupId&&b.getGroupMembers(b.adminGroupId,!0)}),b.$watch("userGroupId",function(){void 0!==b.createNewUserGroup&&b.getGroupMembers(b.userGroupId,!1)});var o=function(a){var b="panel-spec-projects-"+a+"-header-icon",c=document.getElementById(b);void 0!==c&&null!==c&&(c.className="pull-right glyphicon glyphicon-plus")};b.changeIcon=function(a){var b=document.getElementById(a).className;b=b.indexOf("plus")>-1?b.replace("plus","minus"):b.replace("minus","plus"),document.getElementById(a).className=b},b.getChildPages=function(c){e.authStatePromise.then(function(e){var f="?";if(""!=c.data&&void 0!=c.data&&null!=c.data){var g=_(b.apps).filter({id:c.appId}).value()[0];g.selectedSpaceData=g.spaceData,""!=c.data.key&&void 0!=c.data.key&&null!=c.data.key&&(f+="spaceKey="+c.data.key,_.merge(g,{confluenceSpaceKey:c.data.key})),""!=c.data.pageId&&void 0!=c.data.pageId&&null!=c.data.pageId&&(f+="&pageId="+c.data.pageId,_.merge(g,{confluencePageId:c.data.pageId})),d.all("application/"+c.appId+"/confluence/child-page"+f).getList().then(function(a){var b=[];angular.forEach(a,function(a){var d={label:a.name,data:{pageId:a.id},appId:c.appId,children:{}};b.push(d)}),c.children=b},a.createErrorHandler(b))}})},b.submitDetails=function(a,c){return delete b.error,b.checkKeyAvailable(c,!0).then(function(a){return a?(delete b.error,b.detailsSubmitted=!0,o("details"),$("#panel-spec-projects-details").collapse("hide"),$("#panel-spec-projects-users").collapse("show")):(b.error="Please fill in all details correctly before continuing",$("#panel-spec-projects-details").collapse("show"),b.detailsSubmitted=!1),a})},b.createNewAdminGroup=!1,b.newAdminGroupNeeded=function(){b.createNewAdminGroup=!0,b.adminGroupId=""},b.createNewUserGroup=!1,b.newUserGroupNeeded=function(){b.createNewUserGroup=!0,b.userGroupId=""},b.submitNewAdminGroup=function(){b.newAdminGroupCreated=!0,b.submittedAdminUsers=b.selectedAdminUsers.slice()},b.submitNewUserGroup=function(){b.newUserGroupCreated=!0,b.submittedNormalUsers=b.selectedNormalUsers.slice()},b.changeApp=function(a,c){c||(b.appSubmitted=!1,$("#panel-spec-projects-apps").collapse("show"),b.appSettingsSubmitted=!1,$("#panel-spec-projects-app-settings").collapse("hide"),b.detailsSubmitted=!1,$("#panel-spec-projects-details").collapse("hide"),b.privilegesSubmitted=!1,$("#panel-spec-projects-users").collapse("hide"));var d=_(b.apps).filter({selected:!0}).value();return 0!=d.length||(c&&(b.error="Please select an application before continuing "),b.appSubmitted=!1,$("#panel-spec-projects-apps").collapse("show"),b.appSettingsSubmitted=!1,$("#panel-spec-projects-app-settings").collapse("hide"),b.detailsSubmitted=!1,$("#panel-spec-projects-details").collapse("hide"),b.privilegesSubmitted=!1,$("#panel-spec-projects-users").collapse("hide"),!1)},b.checkApps=function(c){e.authStatePromise.then(function(c){delete b.error;var e=_(b.apps).filter({selected:!0}).value();if(0==e.length)return void(b.error="Please select an application before continuing");var f=[];angular.forEach(b.apps,function(a){a.selected&&f.push(a.id)}),b.selectedAppsIds=f,b.appSubmitted=!0;var g=_(e).filter({type:"JIRA"}).value(),h=_(e).filter({type:"Confluence"}).value();if($("#panel-spec-projects-apps").collapse("hide"),0==g.length&&0==h.length)b.appSettingsSubmitted=!0,$("#panel-spec-projects-app-settings").collapse("hide"),$("#panel-spec-projects-details").collapse("show");else{var i=e.length;showMask(!0,"Loading specific app setting options"),angular.forEach(e,function(c){switch(c.type.toLowerCase()){case"jira":d.all("application/"+c.id+"/jira/project-template").getList().then(function(a){c.jiraTemplates=a,i-=1,0==i&&showMask(!1)},a.createErrorHandler(b));break;case"confluence":c.selectedSpaceData?(c.spaceData=c.selectedSpaceData,c.createSpace=!1,showMask(!1)):d.all("application/"+c.id+"/confluence/space").getList().then(function(a){var b=[];angular.forEach(a,function(a){var d={label:a.name,data:{key:a.key},appId:c.id,children:{}};b.push(d)}),c.spaceData=[{label:"Select Parent Page",children:b}],i-=1,0==i&&showMask(!1)},a.createErrorHandler(b));break;default:i-=1,0==i&&showMask(!1)}}),$("#panel-spec-projects-app-settings").collapse("show")}})},b.changeAppSettings=function(a,c){c||(b.appSettingsSubmitted=!1,$("#panel-spec-projects-app-settings").collapse("show"),b.detailsSubmitted=!1,$("#panel-spec-projects-details").collapse("hide"),b.privilegesSubmitted=!1,$("#panel-spec-projects-users").collapse("hide"));var d=_(b.apps).filter({selected:!0}).value(),e=_(d).filter({type:"JIRA"}).value(),f=_(d).filter({type:"Confluence"}).value(),g=!0;angular.forEach(e,function(a){""!=a.jiraTemplateModuleKey&&void 0!=a.jiraTemplateModuleKey||(g=!1)}),c&&!g&&(b.error="Select Project Template for JIRA before continuing");var h=!0;return angular.forEach(f,function(a){a.createSpace?delete a.selectedSpaceData:a.selectedSpaceData=a.spaceData,a.createSpace||""!=a.confluenceSpaceKey&&void 0!=a.confluenceSpaceKey||(h=!1)}),c&&!h&&(b.error="Select space options for Confluence before continuing"),!(!g||!h)||(b.appSettingsSubmitted=!1,$("#panel-spec-projects-app-settings").collapse("show"),b.detailsSubmitted=!1,$("#panel-spec-projects-details").collapse("hide"),b.privilegesSubmitted=!1,$("#panel-spec-projects-users").collapse("hide"),!1)},b.checkAppSettings=function(a){b.detailsSubmitted=!1,$("#panel-spec-projects-details").collapse("hide"),b.privilegesSubmitted=!1,$("#panel-spec-projects-users").collapse("hide"),delete b.error;var c=_(b.apps).filter({selected:!0}).value(),d=_(c).filter({type:"JIRA"}).value(),e=_(c).filter({type:"Confluence"}).value(),f=!0;if(angular.forEach(d,function(a){if(""==a.jiraTemplateModuleKey||void 0==a.jiraTemplateModuleKey)return f=!1,!1}),!f)return void(b.error="Select Project Template for JIRA before continuing");var g=!0;return angular.forEach(e,function(a){if(!a.createSpace&&(""==a.confluenceSpaceKey||void 0==a.confluenceSpaceKey))return g=!1,!1}),g?(b.appSettingsSubmitted=!0,$("#panel-spec-projects-app-settings").collapse("hide"),void $("#panel-spec-projects-details").collapse("show")):void(b.error="Select space options for Confluence before continuing")},b.createProject=function(c){b.changeApp(c,!0)&&b.changeAppSettings(c,!0)&&b.submitDetails(c,!1).then(function(c){c&&(showMask(!0,"Creating Project"),e.authStatePromise.then(function(c){if(b.createNewAdminGroup&&(void 0===b.selectedAdminUsers||0===b.selectedAdminUsers.length)||!b.createNewAdminGroup&&(void 0===b.adminGroupId||""===b.adminGroupId||null===b.adminGroupId))return showMask(!1),void(b.error="Please choose an admin group before continuing");if(b.createNewUserGroup&&(void 0===b.selectedUsers||0===b.selectedUsers.length)||!b.createNewUserGroup&&(void 0===b.userGroupId||""===b.userGroupId||null===b.userGroupId))return showMask(!1),void(b.error="Please choose a user group before continuing");if(delete b.error,b.privilegesSubmitted=!0,b.appSubmitted&&b.appSettingsSubmitted&&b.detailsSubmitted&&b.privilegesSubmitted){o("users"),document.getElementById("btn-spec-project-save").disabled=!0,showMask(!0,"Creating project in all selected applications"),null!==b.adminGroupId&&void 0!==b.adminGroupId&&""!==b.adminGroupId?b.projectAdminUsernames=_.pluck(b.adminUsersInGroup,"name"):b.projectAdminUsernames=_.pluck(b.selectedAdminUsers.undecoratedRows,"name"),null!==b.userGroupId&&void 0!==b.userGroupId&&""!==b.userGroupId?b.projectuserUsernames=_.pluck(b.usersInGroup,"name"):b.projectuserUsernames=_.pluck(b.selectedUsers.undecoratedRows,"name");var e=k(!1);d.all("projects").post({name:b.name,key:b.key,description:"Spectrum Project",projectApplicationDetails:e,userGroup:b.projectuserUsernames,adminGroup:b.projectAdminUsernames}).then(function(){document.getElementById("btn-spec-project-save").disabled=!1,showMask(!1),i.location="project.html#/projects?created=true"},a.createErrorHandler(b))}}))})}}])}(),function(){var a=angular.module("spectrumRestTableModelModule",[]),b=50,c=400;a.config(["RestangularProvider",function(a){a.setBaseUrl(baseUrl+"/rest-with-cookies/api/v1"),a.addResponseInterceptor(function(a,b,c,d,e,f){return"getList"!==b||!a.hasOwnProperty("error")&&"string"!=typeof a?a:[]})}]),a.factory("restTableModelService",["Restangular",function(a){var d={createRestTableModel:function(d,e,f,g){void 0==g&&(g=!0),g&&showMask(!0);var h={updateInProgress:!1},i=!1,j="",k=function(){};k=function(){if(i===!h.updateInProgress){h.updateInProgress=!0,g&&showMask(!0);var c={limit:b};null!==j&&""!==j&&(c.filter=j),f&&_.defaults(c,f),a.all(d).getList(c).then(function(a){h.rows=_.map(a,e),h.rows.totalLength=a.totalLength,h.updateInProgress=!1,k(),g&&showMask(!1)},function(){h.updateInProgress=!1,g&&showMask(!1)}),i=!1}else g&&showMask(!1)};var l=function(a){i=!0,j=a,k()};return h.filterApplied=_.debounce(l,c),l(),h}};return d}])}(),function(){var a=angular.module("spectrumSelectorModule",[]);a.directive("spectrumSelector",function(){var a=function(a){a.addDisabled=!0,a.removeDisabled=!0,a.displayFields=function(){var b=[];if(a.displayOptions){var c=Object.keys(a.displayOptions);b=_.map(c,function(a){var b={};return b[a]=a,b})}else{var d={};d.name="name",b.push(d)}return b}(),a.updateButtonState=function(){a.addDisabled=!_.some(a.unselectedItems.rows,"isSelected"),a.removeDisabled=!_.some(a.selectedItems.rows,"isSelected")},a.getIconName=function(a){var b=a.type?a.type.toLowerCase():"user",c="spec-data-"+b;return c+=a.external?"-external":"-internal",c+=a.active?"-active":"-inactive"},a.itemClicked=function(b){b.isSelected=!b.isSelected,a.updateButtonState()},a.add=function(b){var c=b;void 0===c&&(c=_.filter(a.unselectedItems.rows,"isSelected")),c.forEach(function(b){var c=a.unselectedItems.getUndecoratedRow(b.data.id);a.selectedItems.addRow(c),a.unselectedItems.removeRow(c.id)}),a.updateButtonState()},a.remove=function(b){var c=b;void 0===c&&(c=_.filter(a.selectedItems.rows,"isSelected")),c.forEach(function(b){var c=a.selectedItems.getUndecoratedRow(b.data.id);a.unselectedItems.addRow(c),a.selectedItems.removeRow(c.id)}),a.updateButtonState()},a.changeAllItemSelection=function(b,c){b&&(b.forEach(function(a){a=_.assign(a,{isSelected:c})}),a.updateButtonState())}};return{restrict:"E",templateUrl:"partials/selector.html",scope:{id:"@",unselectedHeading:"@",selectedHeading:"@",buttonHelp:"@",unselectedItems:"=",selectedItems:"=",visibleHeadings:"=",displayOptions:"="},link:a}})}(),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.indexOf(a,this.length-a.length)!==-1}),function(){var a=angular.module("spectrumTableModule",["ngSanitize","spectrumPopoverModule"]);a.directive("spectrumTable",["$q",function(a){var b=function(b,c,d){var e=function(a){return a?a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"):null};b.orderBy=d.orderByInitial?d.orderByInitial:void 0,b.shouldReverse=d.orderReverseInitial&&"true"===d.orderReverseInitial;var f=50;b.pagination={currentPage:1,maxPaginationSize:5,itemsPerPage:f,setToPageNumber:function(a){b.pagination.currentPage=a}},b.isSelectorTable?b.idSuffix=b.id.replace("tb-spec-",""):b.idSuffix=d.id.substr(d.id.lastIndexOf("-")+1),b.filter={text:null},b.itemClicked=function(a){b.isSelectorTable&&(a.isSelected=!a.isSelected,b.updateActionButtons())},b.itemDoubleClicked=function(a){if(b.isSelectorTable&&b.doubleClickFunction){var c=[];b.rows.forEach(function(a){a.isSelected&&c.push(a.data.id),a=_.assign(a,{isSelected:!1})}),a.isSelected=!0,b.doubleClickFunction(),b.rows.forEach(function(a){c.indexOf(a.data.id)!==-1&&(a=_.assign(a,{isSelected:!0}))}),b.updateActionButtons()}},b.gridItemClicked=function(a,c,d){for(var e=a.target;e.parentNode;){if(_.contains(e.className.split(" "),"dropdown"))return;e=e.parentNode}b.actionClicked(c,d)},b.itemEntered=function(c,d){if(d.data.preview){var e=d.data.preview,f=$(c.target).closest("tr");if(!f.data("bs.popover")){var g='<div class="spectrum-table-row-preview" for="'+b.id+'"><div class="overlay"></div></div>';f.popover({content:g,trigger:"hover",title:e.title,html:!0,placement:"auto top",container:"body",delay:{show:500,hide:0},template:'<div class="popover spectrum-table-row-preview-popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),f.on("shown.bs.popover",function(){var b=f.data("bs.popover");if(b.options.content==g){var c=$("div.spectrum-table-row-preview",b.$tip);c.spin({length:5,width:2,radius:5});var d,h=function(a){var d=document.createElement("iframe");d.setAttribute("src","about:blank"),d.setAttribute("scrolling","no"),c.prepend(d);var e=d.contentDocument||d.contentWindow&&d.contentWindow.document;e&&(e.open(),e.write(a),e.close(),d.onload=function(){c.spin(!1)}),b.options.previewContent=a};if(b.options.previewContent)return void h(b.options.previewContent);d="function"==typeof e.content?e.content():e.content,"string"==typeof d?(c.html(d),b.options.content=c[0].outerHTML):a.when(d).then(function(a){h(a)},function(a){c.html('<div class="alert alert-danger"><strong>Error!</strong> The page preview could not be loaded.</div>')})}}),f.popover("toggle")}}},b.getCellData=function(a,c){function d(a){return b.filterableColumns&&_.contains(b.filterableColumns,c.propertyName)&&b.filter.text?a.replace(f,"<span class='spectrum-filter-match'>$&</span>"):a}var f=new RegExp(e(_.escape(b.filter.text)),"gi"),g=c.propertyName;void 0!==c.displayValue&&(g=c.displayValue);var h={baseText:a.data[g]};if(!h.baseText)return h;if(b.popoverRules){var i=b.popoverRules[c.propertyName];i&&h.baseText.length>i.cutoff&&(void 0===i.suffix&&(i.suffix="..."),h.extendedText=h.baseText,h.baseText=h.baseText.substring(0,i.cutoff)+i.suffix,h.extendedText=_.escape(h.extendedText),h.extendedText=d(h.extendedText),h.extendedPlacement=i.placement)}return h.baseText=_.escape(h.baseText),h.baseText=d(h.baseText),h},b.changeTableOrder=function(a){var c=b.rows.totalLength;void 0===b.orderableColumns||b.orderableColumns.indexOf(a)<0||(b.orderBy===a?b.shouldReverse=!b.shouldReverse:b.shouldReverse=!1,void 0!==b.sortItems?b.sortItems(a,b.shouldReverse?"DESC":"ASC"):(b.rows=_.sortBy(b.rows,function(b){return b.data[a]}),b.shouldReverse&&b.rows.reverse()),b.pagination.currentPage=1,b.orderBy=a,b.rows.totalLength=c)},b.getSortValue=function(){if(void 0!==b.orderBy&&void 0===b.sortItems)return"data."+b.orderBy},b.actionClicked=function(a,b){"string"==typeof a.run?""!==a&&(window.location=a.run):"function"==typeof a.run&&(void 0===b?a.run():a.run(b.data))},b.isPictureColumn=function(a){return!!b.isImageColumn(a)||null!==b.pictureColumns&&void 0!==b.pictureColumns&&b.pictureColumns.indexOf(a.propertyName)!==-1},b.isImageColumn=function(a){return null!==b.imageColumns&&void 0!==b.imageColumns&&b.imageColumns.indexOf(a.propertyName)!==-1},b.$watch("headings",function(a){b.headingMap=_.map(a,function(a){return{displayValue:a.displayValue,propertyName:_.keys(a)[0],displayName:_.values(a)[0]}})}),b.$watch("rows",function(a){$(".spectrum-table-row-preview[for="+b.id+"]").closest(".popover").remove();var c,d=_(a).pluck("actions").without(void 0);c=d.size()>0?d.pluck("length").max().value():0,b.hasActions=c>0,b.collapseActions=c>1,b.extraTableClasses="";var e=_(a).pluck("defaultAction").without(void 0);e.size()>0&&(b.extraTableClasses+="table-hover")}),b.switchGridMode=function(){void 0===b.$parent.data&&(b.$parent.data={}),b.$parent.data.gridMode=!b.gridMode},b.$watch("gridModeString",function(a){b.gridMode="true"===b.gridModeString})};return{restrict:"E",templateUrl:"partials/spectrum-table.html",scope:{id:"@",addActions:"=",addActionsTitle:"@",headings:"=",rows:"=",emptyMessage:"@",popoverRules:"=",orderableColumns:"@",orderReverseInitial:"@",orderByInitial:"@",gridModeString:"@gridMode",gridModeSelectable:"@",gridStyle:"@",gridColourColumn:"@",gridPictureColumn:"@",gridStatusIconColumn:"@",gridTextColumn:"@",filterable:"@",filterableColumns:"=",filterPrompt:"@",filterApplied:"=",updateInProgress:"=",rowDescriptionPlural:"@",isSelectorTable:"@",doubleClickFunction:"=",updateActionButtons:"=",pictureColumns:"=",checkableColumns:"=",imageColumns:"=",elementsTotalLength:"=",sortItems:"=",pageChanged:"="},link:b}}])}(),function(){var a=angular.module("spectrumTransformModule",["restangular"]);a.config(["$httpProvider","RestangularProvider",function(a,b){a.interceptors.push("requestTransformInterceptor"),b.addResponseInterceptor(function(a,b){return"getList"===b&&void 0!=a.totalLength&&void 0!=a.elements?(a.elements.totalLength=a.totalLength,a.elements):a})}]),a.factory("requestTransformInterceptor",function(){function a(a){return"GET"===a.method&&"undefined"!==a.url&&0===a.url.indexOf("partials/")&&(a.url=a.url.replace("partials/",baseUrl+"/partials/")),a}var b={request:a};return b})}(),"127.0.0.1"==document.domain&&($.fx.off=!0,$.support.transition=!1,$("head").append('<style id="addedCSS" type="text/css">* { transition: none !important; }</style>'));var _mask={options:{animationDuration:175,animationEasing:mina.easein},s:null,svgSupport:!1,maskShown:!1,maskSetupRun:!1,currentColour:0,currentAnimatedElement:0,backToOriginal:!1,colours:["#F7A84A","#E25D46","#DAA3CA","#B0A3D0","#5DAEDD","#6CC6D8","#6AB862","#FFD633"],initial_ani_setup:function(){this.svgSupport=!!window.SVGSVGElement,this.svgSupport?($("#spinner-fallback-image").remove(),this.s=Snap("#animated_spectrum_spinner")):($("#spinner-fallback-image").show(),
$("#animated_spectrum_spinner").remove())},animateMask:function(a){if(a.maskShown&&a.svgSupport&&null!=a.s){var b=(a.currentAnimatedElement+a.currentColour)%a.colours.length,c=a.backToOriginal?a.colours[b]:a.colours[a.currentColour],d=a.s.select("#path"+b);d.animate({fill:c},a.options.animationDuration,a.options.animationEasing,function(){a.animateMask(a)}),a.currentAnimatedElement=(a.currentAnimatedElement+1)%a.colours.length,0==a.currentAnimatedElement&&(a.backToOriginal=!a.backToOriginal,a.backToOriginal&&(a.currentColour=(a.currentColour+1)%a.colours.length))}},showMask:function(a){this.maskSetupRun||this.initial_ani_setup();var b=$("#spinner-container");a?b.is(":visible")||b.fadeIn():b.is(":visible")&&b.fadeOut(),this.maskShown||(this.maskShown=a,this.animateMask(this)),this.maskShown=a}};!function(){var a=angular.module("spectrumTaskTimerModule",["restangular"]);a.config(["RestangularProvider",function(a){a.setBaseUrl(baseUrl+"/rest-with-cookies/api/v1")}]),a.factory("taskTimer",["$q","$rootScope","Restangular",function(a,b,c){function d(a,b){var c=Math.ceil(b.elapsedTime/60);return"Something went wrong whilst logging time against issue <strong><a target='_blank' href='"+a.url+"/browse/"+b.remoteId+"'>"+b.remoteId+"</a></strong>. Check that the remote server is available and that you have the correct permissions to log time against this task. Please go to the remote server and manually update it if you wish to record this work log.<br><br>Issue: <strong><a target='_blank' href='"+a.url+"/browse/"+b.remoteId+"'>"+b.remoteId+"</a></strong><br>Time spent: "+c+" minute"+(1==c?"":"s")}return{start:function(e,f){c.one("task-timer/start").customPOST({appId:e.id,remoteId:f}).then(function(c){return b.$broadcast("taskTimersUpdated"),c.successCompletedTaskTimer?c:a.reject(d(e,c.completedTaskTimer))},function(b){return a.reject("There was an issue performing this action. Please refresh the page and try again.")}).catch(function(a){bootbox.alert(a)})},stop:function(e,f){bootbox.confirm("This log your time against the remote system, do you wish to proceed?",function(g){g&&c.one("task-timer/"+f+"/stop").customPOST().then(function(c){return b.$broadcast("taskTimersUpdated"),c.successCompletedTaskTimer?c:a.reject(d(e,c.completedTaskTimer))},function(){return a.reject("There was an issue performing this action. Please refresh the page and try again.")}).catch(function(a){bootbox.alert(a)})})}}}])}(),function(){var a=angular.module("userDirectoryModule",["ui.router","angularUtils.directives.uiBreadcrumbs","spectrumLoginModule","spectrumHeaderModule","spectrumMenuModule","spectrumHeadingModule","spectrumFooterModule","restangular"]);a.config(["$urlRouterProvider","$stateProvider","RestangularProvider",function(a,b,c){setupDefaultRestangularUrlModifications(c),a.otherwise("/userdirectory"),b.state("userdirectory",{url:"/userdirectory",templateUrl:"partials/userdirectory-list.html",controller:"ListController",data:{displayName:"User Directory"}})}]).createErrorHandler=spectrumRestangularErrorHandler,a.controller("ListController",["$scope","Restangular",function(b,c){c.one("userdirectory").get().then(function(a){b.userDirectory=a},a.createErrorHandler(b)),b.save=function(){c.one("userdirectory").customPUT(b.userDirectory).then(function(){b.successMsg="User directory information updated!"},a.createErrorHandler(b))}}])}(),function(){var a=angular.module("usersModule",["ui.router","angularUtils.directives.uiBreadcrumbs","spectrumLoginModule","spectrumHeaderModule","spectrumMenuModule","spectrumHeadingModule","spectrumFooterModule","spectrumTableModule","spectrumSelectorModule","spectrumRestTableModelModule","spectrumArrayTableModelModule"]);a.config(["$urlRouterProvider","$stateProvider","RestangularProvider",function(a,b,c){setupDefaultRestangularUrlModifications(c),a.otherwise("/users"),b.state("users",{abstract:!0,url:"/users",template:"<ui-view/>",data:{breadcrumbProxy:"users.list"}}).state("users.list",{url:"",templateUrl:"partials/all_user.html",controller:"ListController",data:{displayName:"Users"}}).state("users.create",{url:"/create",templateUrl:"partials/add_user.html",controller:"CreateController",data:{displayName:"Create User"}}).state("users.edit",{url:"/:userId",templateUrl:"partials/edit_user.html",controller:"EditController",data:{displayName:"Edit User"}})}]).createErrorHandler=spectrumRestangularErrorHandler,a.controller("ListController",["$scope","Restangular","restTableModelService",function(a,b,c){a.addActions={name:"Add a new user",icon:"plus",run:"user.html#/users/create"},a.userRowModel=c.createRestTableModel("users",function(a){var b={run:"user.html#/users/"+a.id},c="spec-data-user-";return c+=a.external?"external-":"internal-",c+=a.active?"active":"inactive",a.iconClass=c,a.fullName=_.compact([a.firstName,a.lastName]).join(" "),a.active=a.active?"yes":"no",{data:a,actions:[],defaultAction:b}})}]).controller("CreateController",["$scope","Restangular",function(b,c){b.active=!0,b.createUser=function(){b.errors=[],void 0===b.email&&(b.email=null),b.password!==b.confirmPassword&&b.errors.push("Password and confirm password do not match!"),showMask(!0,"Creating user");var d={name:b.userName,password:b.password,email:b.email,role:b.role,syncCycle:0,active:b.active,external:!1,deleted:!1,firstName:b.firstName,lastName:b.lastName};c.one("").post("users",d).then(function(){showMask(!1),window.location="user.html#/users"},a.createErrorHandler(b))}}]).controller("EditController",["$scope","$stateParams","Restangular","arrayTableModelService",function(b,c,d,e){showMask(!0,"Loading user information"),d.one("users",c.userId).get().then(function(a){return b.user=a,b.defaultFirstName=a.firstName,b.defaultLastName=a.lastName,d.all("groups").getList()},a.createErrorHandler(b)).then(function(a){return b.groups=a,d.all("users/"+b.user.id+"/groups").getList()},a.createErrorHandler(b)).then(function(a){b.selectedGroups=e.createArrayTableModel(a,function(a){return{data:a,actions:[]}},!0,["name"]);var c=_.pluck(a,"id");b.availableGroups=e.createArrayTableModel(_.filter(b.groups,function(a){return c.indexOf(a.id)<0}),function(a){return{data:a,actions:[]}},!0,["name"])},a.createErrorHandler(b)),b.deleteUser=function(c){b.error=null,bootbox.confirm("Are you sure?<br/>(Note: if logged in, his/her session will be expired)",function(e){e&&(showMask(!0,"Deleting user"),d.all("users/"+c+"/groups").getList().then(function(e){angular.forEach(e,function(a){d.one("users",c).one("groups",a.id).customDELETE()}),d.one("users",c).remove().then(function(){showMask(!1),window.location="user.html#/users"},a.createErrorHandler(b))},a.createErrorHandler(b)))})},b.editUser=function(c){if(b.errors=[],b.password!==b.confirmPassword)return void b.errors.push("New password and confirm password do not match!");""===b.password&&""===b.confirmPassword&&(b.password=b.user.password),showMask(!0,"Saving user");var e={name:b.user.name,password:b.password,email:b.user.email,role:b.user.role,syncCycle:b.user.syncCycle,active:b.user.active,external:b.user.external,deleted:b.user.deleted,firstName:b.user.firstName,lastName:b.user.lastName};d.one("users",c).customPUT(e).then(function(){showMask(!1),window.location="user.html#/users"},a.createErrorHandler(b))},b.changeUserGroups=function(c){delete b.error;var e=_.pluck(b.availableGroups.undecoratedRows,"id"),f=_.pluck(b.selectedGroups.undecoratedRows,"id");angular.forEach(f,function(e,g){d.one("users",c).one("groups",e).customPUT().then(function(){g===f.length-1&&(b.successMsg="User groups updated!",$("html, body").animate({scrollTop:0},"fast"))},a.createErrorHandler(b))}),angular.forEach(e,function(e){d.one("users",c).one("groups",e).customDELETE().then(function(){b.successMsg="User groups updated!",$("html, body").animate({scrollTop:0},"fast")},a.createErrorHandler(b))})}}])}();var spectrumUtilitiesModule=angular.module("spectrumUtilitiesModule",["restangular","minicolors","spectrumWidgetLoadingModule"]);spectrumUtilitiesModule.factory("saveWidgetConfig",["Restangular",function(a){return function(b,c){function d(a){a?$(".adf_save").fadeIn("slow",function(){$(".adf_spinner").css({color:"#E25C46"})}):($(".adf_save").fadeOut("slow"),function(){$(".adf_spinner").css({color:"#66BE61"})})}b.widget.id?(d(!0),a.one("dashboard",b.widget.dashboardId).one("widget",b.widget.id).customPUT({config:b.widget.config,title:b.widget.title,autoRefresh:b.widget.autoRefresh,bgColor:b.widget.bgColor,txtColor:b.widget.txtColor,type:b.widget.type}).then(function(a){d(!1),showMask(!1),void 0!==c&&c()},function(){showMask(!1)})):showMask(!1)}}]);var blankImage="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",individualRefreshTimers={};!function(){var a=angular.module("widgetRestCommentModelModule",["restangular"]);a.config(["RestangularProvider",function(a){setupDefaultRestangularUrlModifications(a)}]),a.factory("widgetCommentService",["$q","$timeout","Restangular","$sce",function(a,b,c,d){var e=function(a){var b=document.createElement("a");return b.href=a,b},f=/^https?:\/\/|^\/\//i,g=function(a){return!f.test(a)},h=function(a,b){var c=b.find("img");c.each(function(){var b=$(this),c=b.attr("src");!_.isUndefined(c)&&g(c)&&c.startsWith("/")&&b.attr("src",a+c)})},i=function(a,b){var c=b.find("a");c.each(function(){var b=$(this),c=b.attr("href");_.isUndefined(c)||(c.startsWith("#")?b.removeAttr("href"):(b.attr("target","_blank"),g(c)&&c.startsWith("/")&&b.attr("href",a+c)))})},j=function(a,b){try{var c=$("<div>").append($.parseHTML(b.renderedBody))}catch(a){}var f;if(_.isEmpty(c))f=b.renderedBody;else{var g=e(a),j=g.protocol+"//"+g.host;i(j,c),h(j,c),f=d.trustAsHtml(c.html()),c.remove()}return{body:f,creator:{avatar:b.author.avatarUrls["16x16"],name:b.author.displayName},created:moment(b.created).fromNow()}},k=function(a){b(function(){var b=$("#spec-all-comments-"+a.wid);b.scrollTop(b.prop("scrollHeight"))})},l={getCommentsModel:function(b,d,e,f){var g={};g.appId=b,g.appType=e,g.appUrl=f,g.ItemKey=d,g.ready=!1;var h=[],i=[];return i.push(c.all("message").post({type:e,method:"canUserAddComments",appId:b,payload:{issueKey:d}}).then(function(a){var b=JSON.parse(a.payload);b&&(g.haveAddPermission=b.addComments&&b.addComments.havePermission,g.haveBrowseUserPermission=b.browseUsers&&b.browseUsers.havePermission)})),i.push(c.all("message").post({type:e,method:"getComments",appId:b,payload:{issueKey:d}}).then(function(a){var b=JSON.parse(a.payload).comments;_.forEach(b,function(a){h.push(j(f,a))}),g.ready=!0},function(){g.ready=!0})),g.promise=a.all(i),g.allComments=h,g},decorateComment:function(a,b){return j(a,b)},postComment:function(a,b,d,e){return c.all("message").post({type:e,method:"addComment",appId:a,payload:{issueKey:b,comment:d}})},getUsers:function(a,b,d){return c.all("message").post({type:"jira",method:"findUsersWithBrowsePermissions",appId:a,payload:{username:d,issueKey:b}})},showModal:function(a,b){var c=$("#comments-modal-"+b.wid);c.hasClass("in")?a.promise.then(function(){k(b)}):(c.off("shown.bs.modal").on("shown.bs.modal",function(){a.promise.then(function(){c.off("shown.bs.modal"),k(b)})}),c.modal("show"))},scrollComments:function(a){k(a)}};return l}])}(),function(){var a=angular.module("widgetRestTableModelModule",["restangular"]),b=50,c=0,d="ASC",e=400;a.config(["RestangularProvider",function(a){setupDefaultRestangularUrlModifications(a)}]),a.factory("jiraRestTableModelService",["Restangular",function(a){var f={createRestTableModel:function(f,g,h,i){void 0==h&&(h=!0),h&&showMask(!0);var j=!1,k="";g.config.maxResults=b,g.config.startAt=c,g.config.direction=d;var l={updateInProgress:!1,sortItems:function(a,b){g.config.startAt=0,g.config.direction=b,g.config.orderBy="name"===a?"summary":a,l.updateInProgress=!0,m()},pageChanged:function(a){g.config.startAt=(a-1)*g.config.maxResults,l.updateInProgress=!0,m()}},m=function(){};m=function(){j===!l.updateInProgress?(l.updateInProgress=!0,h&&showMask(!0),null!==k&&""!==k?g.config.filter=k:delete g.config.filter,a.all("message").post({type:f.type,method:"getIssuesFromFilter",appId:f.id,payload:g.config}).then(function(a){var b=JSON.parse(a.payload);l.rows=_.map(b.issues,function(a){return{data:n(a),actions:i,url:f.url+"/browse/"+a.key,defaultAction:[],external:!0}}),l.rows.totalLength=b.total,l.updateInProgress=!1,m(),h&&showMask(!1)},function(){l.updateInProgress=!1,h&&showMask(!1)}),j=!1):h&&showMask(!1)};var n=function(a){return a.project="UNKNOWN",a.name="Unknown",a.description="Unknown",a.status="Unknown",a.statusCategory="Unknown",a.icon={src:blankImage,alt:"Unknown"},a.priorityIcon={src:blankImage,alt:"Unknown"},a.assignedImage={src:blankImage,alt:"Unassigned"},a.statusIcon={src:blankImage,alt:"Unknown"},a.fields.hasOwnProperty("project")&&null!==a.fields.project&&(a.project=a.fields.project.name,a.projectIcon={src:a.fields.project.avatarUrls["24x24"],alt:a.fields.project.name}),a.fields.hasOwnProperty("summary")&&null!==a.fields.summary&&(a.name=a.fields.summary),a.fields.hasOwnProperty("description")&&(a.description=a.fields.description),a.fields.hasOwnProperty("issuetype")&&null!==a.fields.issuetype&&(a.icon={src:a.fields.issuetype.iconUrl,alt:a.fields.issuetype.name}),a.fields.hasOwnProperty("priority")&&null!==a.fields.priority&&(a.priorityIcon={src:a.fields.priority.iconUrl,alt:a.fields.priority.name}),a.fields.hasOwnProperty("status")&&null!==a.fields.status&&(a.status=a.fields.status.name,a.statusIcon={src:a.fields.status.iconUrl,alt:a.fields.status.name}),a.fields.status.hasOwnProperty("statusCategory")&&(a.statusCategory=a.fields.status.statusCategory.name),null!=a.fields.assignee&&null!==a.fields.assignee&&(a.assignedImage={src:a.fields.assignee.avatarUrls["24x24"],alt:a.fields.assignee.displayName}),a},o=function(a){j=!0,k=a,g.config.startAt=0,m()};return l.filterApplied=_.debounce(o,e),o(),l}};return f}])}();var blankImage="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",bookmarkModule=angular.module("adf.widget.bookmark",["adf.provider","spectrumUtilitiesModule"]);setupWidgetTweaks(angular),bookmarkModule.config(["RestangularProvider","dashboardProvider",function(a,b){setupDefaultRestangularUrlModifications(a),b.widget("bookmarks",{title:"Bookmarks",class:"",colour:"",description:"Save Bookmarks/Links",templateUrl:"partials/widgets/bookmark.html",controller:"bookmarksController"})}]).createErrorHandler=spectrumRestangularErrorHandler,bookmarkModule.controller("bookmarksController",["$q","$scope","widget","Restangular","arrayTableModelService","saveWidgetConfig","MINICOLORS_SETTINGS","TITLE_BAR_COLORS",function(a,b,c,d,e,f,g,h){b.bookmarkToSave=[],b.bookmarkToDelete=[],b.ready=!1,b.widget=c,toggleWidgetResize(c),b.widget.searchBox=!1,b.data=_.extend(getStandardWidgetData(b,g,h),{showRefreshOptions:!1}),b.$watch("resultTable.updateInProgress",function(a,c){c&&!a&&(b.ready=!0)}),b.$watch("data.titleBgColor",function(a,c){b.widget.bgColor=a}),b.$watch("data.titleTxtColor",function(a,c){b.widget.txtColor=a}),b.update=function(a){b.ready=!1,delete b.resultTable,d.all("message").post({type:"bookmarks",method:"getBookmarks",appId:null}).then(function(a){var c=JSON.parse(a.payload);b.resultTable=e.createArrayTableModel(c,function(a){return{data:a,url:a.link,defaultAction:[],external:!0}},!1,["link","label"])},function(){b.ready=!0})},b.changeButtonColor=function(){document.getElementById("spec-widget-bookmark-add-"+b.widget.wid).className="btn btn-primary"},b.saveOptions=function(a){b.ready=!1,b.updateBookmarks(b.bookmarkToSave).then(function(){b.bookmarkToSave=[],b.bookmarkToDelete=[],standardSaveOptions(b,f,a.$valid)},function(){b.ready=!0})},b.updateBookmarks=function(){var c=[];return 0!==b.bookmarkToSave.length&&_.forEach(b.bookmarkToSave,function(a){c.push(d.all("message").post({type:"bookmarks",method:"addBookmark",appId:null,payload:{link:a.link,label:a.label}}))}),0!==b.bookmarkToDelete.length&&_.forEach(b.bookmarkToDelete,function(a){c.push(d.all("message").post({type:"bookmarks",method:"removeBookmark",appId:null,payload:a}))}),hideWidgetOptions(b),c.length>0?a.all(c):a.when()},b.removeBookmark=function(a){var c={id:a.data.id};b.bookmarkToDelete.push(c),_.remove(b.resultTable.rows,function(b){return b.data.label===a.data.label&&b.data.link===a.data.link}),_.remove(b.bookmarkToSave,function(b){return b.label===a.data.label&&b.link===a.data.link})},b.addBookmark=function(a){var c=b.data.bookmark;if(a.$valid&&"undefined"!=typeof c){if(b.checkBookmarkForm(a)){var c={label:c.label,link:c.link};b.bookmarkToSave.push(c),b.resultTable.rows.push({data:c,url:b.data.bookmark.link,external:!0}),document.getElementById("spec-widget-bookmark-add-"+b.widget.wid).className="btn btn-success",b.data.bookmark.label="",b.data.bookmark.link="",document.getElementById("spec-widget-bookmark-add-"+b.widget.wid).focus()}}else b.data.formErrors=!0,b.data.formErrors="Enter Valid Label or URL"},b.cancelConfigOption=function(){b.bookmarkToSave=[],b.bookmarkToDelete=[],cancelOptions(b)},b.checkBookmarkForm=function(){b.data.bookmarkLinkError=!1,b.data.formErrors=!1;var a=b.data.bookmark;if("undefined"==typeof a.label||0===a.label.trim().length)return b.data.formErrors=!0,b.data.formErrors="Enter Valid Label",!1;var c=_.findIndex(b.resultTable.rows,function(b){return b.data.label===a.label});if(c!=-1)return b.data.formErrors=!0,b.data.formErrors="Enter Unique Label",!1;var d=/(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/;return!!d.test(a.link)||(b.data.bookmarkLinkError=!0,!1)},setupWidgetOptionFunctions(b),b.update(!1)}]);var blankImage="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",nexusPolicyModule=angular.module("adf.widget.nexusPolicy",["adf.provider","spectrumUtilitiesModule"]);setupWidgetTweaks(angular),nexusPolicyModule.config(["RestangularProvider","dashboardProvider",function(a,b){setupDefaultRestangularUrlModifications(a),b.widget("nexus-policy-violations",{title:"Nexus Policy Violations",class:"",colour:"",description:"Latest Policy Violations from Nexus",templateUrl:"partials/widgets/nexusPolicy.html",controller:"nexusPolicyController"})}]).createErrorHandler=spectrumRestangularErrorHandler,nexusPolicyModule.controller("nexusPolicyController",["$q","$scope","widget","Restangular","$timeout","getAppsOfType","arrayTableModelService","saveWidgetConfig","MINICOLORS_SETTINGS","TITLE_BAR_COLORS",function(a,b,c,d,e,f,g,h,i,j){function k(a){var b=a.highestThreatLevel,c="moderate";if(b>=4&&b<=6)var c="severe";else if(b>=7&&b<=10)var c="critical";return c}b.showConfigModal=!1,b.ready=!0,b.hasResults=!1,b.nexusApps=[],b.errorStatus=null,b.widget=c,toggleWidgetResize(c),b.data=getStandardWidgetData(b,i,j),$("#widget-modal-"+c.id).on("shown.bs.modal",function(){b.showConfigModal=!0}),b.showWidgetConfigModal=function(){$("#widget-modal-"+c.id).modal("show"),b.nexusPolicy={},d.one("nexus/widget/"+b.widget.id+"/config").get().then(function(a){b.errorStatus=null,b.nexusPolicy=JSON.parse(JSON.parse(a.config).policies),angular.forEach(b.nexusPolicy,function(a){a.selectedStages=_(a.stages).filter({selected:!0}).value()}),showMask(!1),$("#widget-modal-"+b.widget.id).modal("show")},function(a){b.errorStatus=a.status,showMask(!1)})},b.saveNexusConfig=function(a){$("#widget-modal-"+c.id).modal("hide"),b.ready=!1;var d=[];angular.forEach(a,function(a){if(a.selected){var b={};b.id=a.id,b.selected=!0,b.stages=_(a.selectedStages).value().map(function(a){return{name:a.name,selected:!0}}),d.push(b)}}),b.config.policies=d,standardSaveOptions(b,h,!0),showMask(!1)},b.hideWidgetOptions=function(){$("#widget-modal-"+c.id).modal("hide"),b.update()},b.update=function(){b.ready=!1,b.errorStatus=null,b.hasResults=!1,d.all("nexus/widget/"+b.widget.id+"/policy").getList().then(function(a){b.ready=!0,b.errorStatus=null,b.hasResults=_.filter(a,function(a){return a.stages.length>0}).length>0,angular.forEach(a,function(a){a.label=k(a)}),b.nexusPolicyData=a,e(function(){$(".nexus-policy-hover-"+c.id).each(function(){var a=$(this),d=_(b.nexusPolicyData).filter({id:a.data("policyid")}).value()[0],e=_(d.stages).filter({name:a.data("stagename")}).value()[0],f="";if(0==e.violations.length)f+="<h4>No Violations</h4>";else for(var g=0;g<e.violations.length;g++){var h=e.violations[g];f+='<h2 style="margin-top: 5px"><a href="'+h.reportUrl+'" target="_blank">',f+=h.applicationName+' - <span class="applicationThreatLevel">'+h.components.length+"</span></a></h2>";for(var i=0;i<h.components.length;i++){var j=h.components[i];f+='<li><span class="glyphicon glyphicon-asterisk"></span>'+j.groupId+" : "+j.artifactId+" : "+j.version}f+="</ul>"}a.popover({trigger:"manual",animation:!1,title:a.text(),content:f,html:!0}).on("mouseenter",function(){$(".nexus-policy-hover-"+c.id).not(this).popover("hide");var a=this;$(this).popover("show"),$(".popover").on("mouseleave",function(){$(a).popover("hide")})}).on("mouseleave",function(){var a=this;setTimeout(function(){$(".popover:hover").length||$(a).popover("hide")},300)})})})},function(a){b.errorStatus=a.status,b.ready=!0,showMask(!1)})},b.update()}]);var confluenceNotifications={id:null,payload:'[{"id":2,"applicationLinkId":"","iconUrl":"/images/icons/profilepics/default.png","title":"admin commented on a page.","description":"<p><a class=\\"confluence-userlink user-mention current-user-mention\\" href=\\"http://confluence:8090/display/~admin\\">admin</a> Hi</p>","url":"/display/PX/Meeting+Notes?focusedCommentId=1867813#comment-1867813","application":"com.atlassian.mywork.providers.confluence","entity":"page","action":"comment","created":1462871202000,"updated":1462871202000,"status":"DONE","read":true,"pinned":false,"globalId":"appId=43975947-5036-37d2-9fa6-4c27eb176f02&entity=page&id=1081355","metadata":{"user":"admin","username":"admin","pageId":1081355,"itemContentId":1081355,"contentId":1867813,"watching":true,"like":false,"likeComment":false},"item":{"title":"Meeting Notes","url":"/display/PX/Meeting+Notes"}}]'},twoConfluenceNotifications={id:null,payload:'[{"id":2,"applicationLinkId":"","iconUrl":"/images/icons/profilepics/default.png","title":"admin commented on a page.","description":"<p><a class=\\"confluence-userlink user-mention current-user-mention\\" href=\\"http://confluence:8090/display/~admin\\">admin</a> Hi</p>","url":"/display/PX/Meeting+Notes?focusedCommentId=1867813#comment-1867813","application":"com.atlassian.mywork.providers.confluence","entity":"page","action":"comment","created":1462871202000,"updated":1462871202000,"status":"DONE","read":true,"pinned":false,"globalId":"appId=43975947-5036-37d2-9fa6-4c27eb176f02&entity=page&id=1081355","metadata":{"user":"admin","username":"admin","pageId":1081355,"itemContentId":1081355,"contentId":1867813,"watching":true,"like":false,"likeComment":false},"item":{"title":"Meeting Notes","url":"/display/PX/Meeting+Notes"}}, {"id":3,"applicationLinkId":"","iconUrl":"/images/icons/profilepics/default.png","title":"admin commented on a page.","description":"<p><a class=\\"confluence-userlink user-mention current-user-mention\\" href=\\"http://confluence:8090/display/~admin\\">admin</a> Hi</p>","url":"/display/PX/Meeting+Notes?focusedCommentId=1867813#comment-1867813","application":"com.atlassian.mywork.providers.confluence","entity":"page","action":"comment","created":1462871202000,"updated":1462871202000,"status":"DONE","read":true,"pinned":false,"globalId":"appId=43975947-5036-37d2-9fa6-4c27eb176f02&entity=page&id=1081355","metadata":{"user":"admin","username":"admin","pageId":1081355,"itemContentId":1081355,"contentId":1867813,"watching":true,"like":false,"likeComment":false},"item":{"title":"Meeting Notes two","url":"/display/PX/Meeting+Notes"}}]'},issueForAgileBoardJson={id:null,payload:'{"expand":"schema,names","startAt":0,"maxResults":50,"total":3,"issues":[{"expand":"operations,versionedRepresentations,editmeta,changelog,transitions,renderedFields","id":"10105","self":"http://localhost:9876/jira/rest/agile/1.0/issue/10105","key":"WID-3","fields":{"issuetype":{"self":"http://localhost:9876/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"http://localhost:9876/jira/secure/viewavatar?size=xsmall&avatarId=10310&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":10310},"components":[],"timespent":null,"timeoriginalestimate":null,"sprint":{"id":1,"self":"http://localhost:9876/jira/rest/agile/1.0/sprint/1","state":"active","name":"Sprint 1","startDate":"2015-09-11T15:49:06.653+01:00","endDate":"2015-10-09T15:49:00.000+01:00","originBoardId":1},"description":null,"project":{"self":"http://localhost:9876/jira/rest/api/2/project/10300","id":"10300","key":"WID","name":"WidgetTest","avatarUrls":{"48x48":"http://localhost:9876/jira/secure/projectavatar?pid=10300&avatarId=10011","24x24":"http://localhost:9876/jira/secure/projectavatar?size=small&pid=10300&avatarId=10011","16x16":"http://localhost:9876/jira/secure/projectavatar?size=xsmall&pid=10300&avatarId=10011","32x32":"http://localhost:9876/jira/secure/projectavatar?size=medium&pid=10300&avatarId=10011"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"timetracking":{},"customfield_10005":["com.atlassian.greenhopper.service.sprint.Sprint@11d7edea[id=1,rapidViewId=1,state=ACTIVE,name=Sprint 1,startDate=2015-09-11T15:49:06.653+01:00,endDate=2015-10-09T15:49:00.000+01:00,completeDate=<null>,sequence=1]"],"customfield_10006":"WID-5","attachment":[],"aggregatetimeestimate":null,"flagged":false,"resolutiondate":null,"workratio":-1,"summary":"Wolverine is wolverine","lastViewed":null,"watches":{"self":"http://localhost:9876/jira/rest/api/2/issue/WID-3/watchers","watchCount":1,"isWatching":true},"creator":{"self":"http://localhost:9876/jira/rest/api/2/user?username=admin","name":"admin","key":"admin","emailAddress":"admin@local","avatarUrls":{"48x48":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=48","24x24":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=24","16x16":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=16","32x32":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=32"},"displayName":"admin","active":true,"timeZone":"Europe/London"},"subtasks":[],"created":"2015-09-14T10:17:34.000+0100","reporter":{"self":"http://localhost:9876/jira/rest/api/2/user?username=admin","name":"admin","key":"admin","emailAddress":"admin@local","avatarUrls":{"48x48":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=48","24x24":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=24","16x16":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=16","32x32":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=32"},"displayName":"admin","active":true,"timeZone":"Europe/London"},"epic":{"id":10108,"key":"WID-5","self":"http://localhost:9876/jira/rest/agile/1.0/epic/10108","name":"Heroes unfolded","summary":"Heroes unfolded","color":{"key":"color_4"},"done":false},"customfield_10000":null,"aggregateprogress":{"progress":0,"total":0},"priority":{"self":"http://localhost:9876/jira/rest/api/2/priority/3","iconUrl":"http://localhost:9876/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"customfield_10001":null,"customfield_10100":"0|i00005:","labels":[],"environment":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[],"duedate":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":0,"total":0,"comments":[]},"issuelinks":[],"votes":{"self":"http://localhost:9876/jira/rest/api/2/issue/WID-3/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"assignee":{"self":"http://localhost:9876/jira/rest/api/2/user?username=admin","name":"admin","key":"admin","emailAddress":"admin@local","avatarUrls":{"48x48":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=48","24x24":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=24","16x16":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=16","32x32":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=32"},"displayName":"admin","active":true,"timeZone":"Europe/London"},"updated":"2015-09-14T11:02:43.000+0100","status":{"self":"http://localhost:9876/jira/rest/api/2/status/4","description":"This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.","iconUrl":"http://localhost:9876/jira/images/icons/statuses/reopened.png","name":"Reopened","id":"4","statusCategory":{"self":"http://localhost:9876/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}}}},{"expand":"operations,versionedRepresentations,editmeta,changelog,transitions,renderedFields","id":"10106","self":"http://localhost:9876/jira/rest/agile/1.0/issue/10106","key":"PT-4","fields":{"issuetype":{"self":"http://localhost:9876/jira/rest/api/2/issuetype/3","id":"3","description":"A task that needs to be done.","iconUrl":"http://localhost:9876/jira/secure/viewavatar?size=xsmall&avatarId=10318&avatarType=issuetype","name":"Task","subtask":false,"avatarId":10318},"components":[],"timespent":null,"timeoriginalestimate":null,"sprint":{"id":1,"self":"http://localhost:9876/jira/rest/agile/1.0/sprint/1","state":"active","name":"Sprint 1","startDate":"2015-09-11T15:49:06.653+01:00","endDate":"2015-10-09T15:49:00.000+01:00","originBoardId":1},"description":"After creating / updating stuff we need to delete them all, ALL!","project":{"self":"http://localhost:9876/jira/rest/api/2/project/10100","id":"10100","key":"PT","name":"Process Testing","avatarUrls":{"48x48":"http://localhost:9876/jira/secure/projectavatar?pid=10100&avatarId=10011","24x24":"http://localhost:9876/jira/secure/projectavatar?size=small&pid=10100&avatarId=10011","16x16":"http://localhost:9876/jira/secure/projectavatar?size=xsmall&pid=10100&avatarId=10011","32x32":"http://localhost:9876/jira/secure/projectavatar?size=medium&pid=10100&avatarId=10011"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"timetracking":{},"customfield_10005":["com.atlassian.greenhopper.service.sprint.Sprint@11d7edea[id=1,rapidViewId=1,state=ACTIVE,name=Sprint 1,startDate=2015-09-11T15:49:06.653+01:00,endDate=2015-10-09T15:49:00.000+01:00,completeDate=<null>,sequence=1]"],"customfield_10006":"WID-6","attachment":[],"aggregatetimeestimate":null,"flagged":false,"resolutiondate":null,"workratio":-1,"summary":"Delete stuff","lastViewed":null,"watches":{"self":"http://localhost:9876/jira/rest/api/2/issue/PT-4/watchers","watchCount":1,"isWatching":true},"creator":{"self":"http://localhost:9876/jira/rest/api/2/user?username=admin","name":"admin","key":"admin","emailAddress":"admin@local","avatarUrls":{"48x48":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=48","24x24":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=24","16x16":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=16","32x32":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=32"},"displayName":"admin","active":true,"timeZone":"Europe/London"},"subtasks":[],"created":"2015-09-14T10:51:29.000+0100","reporter":{"self":"http://localhost:9876/jira/rest/api/2/user?username=admin","name":"admin","key":"admin","emailAddress":"admin@local","avatarUrls":{"48x48":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=48","24x24":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=24","16x16":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=16","32x32":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=32"},"displayName":"admin","active":true,"timeZone":"Europe/London"},"epic":{"id":10109,"key":"WID-6","self":"http://localhost:9876/jira/rest/agile/1.0/epic/10109","name":"Stuff operations","summary":"Stuff operations","color":{"key":"color_6"},"done":false},"customfield_10000":null,"aggregateprogress":{"progress":0,"total":0},"priority":{"self":"http://localhost:9876/jira/rest/api/2/priority/3","iconUrl":"http://localhost:9876/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"customfield_10001":null,"customfield_10100":"0|i00013:","labels":[],"environment":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[],"duedate":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":0,"total":0,"comments":[]},"issuelinks":[],"votes":{"self":"http://localhost:9876/jira/rest/api/2/issue/PT-4/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"assignee":null,"updated":"2015-09-14T11:06:29.000+0100","status":{"self":"http://localhost:9876/jira/rest/api/2/status/10001","description":"","iconUrl":"http://localhost:9876/jira/images/icons/statuses/open.png","name":"To Do","id":"10001","statusCategory":{"self":"http://localhost:9876/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}}}},{"expand":"operations,versionedRepresentations,editmeta,changelog,transitions,renderedFields","id":"10107","self":"http://localhost:9876/jira/rest/agile/1.0/issue/10107","key":"WID-4","fields":{"issuetype":{"self":"http://localhost:9876/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"http://localhost:9876/jira/secure/viewavatar?size=xsmall&avatarId=10311&avatarType=issuetype","name":"New Feature","subtask":false,"avatarId":10311},"components":[],"timespent":null,"timeoriginalestimate":null,"sprint":{"id":1,"self":"http://localhost:9876/jira/rest/agile/1.0/sprint/1","state":"active","name":"Sprint 1","startDate":"2015-09-11T15:49:06.653+01:00","endDate":"2015-10-09T15:49:00.000+01:00","originBoardId":1},"description":null,"project":{"self":"http://localhost:9876/jira/rest/api/2/project/10300","id":"10300","key":"WID","name":"WidgetTest","avatarUrls":{"48x48":"http://localhost:9876/jira/secure/projectavatar?pid=10300&avatarId=10011","24x24":"http://localhost:9876/jira/secure/projectavatar?size=small&pid=10300&avatarId=10011","16x16":"http://localhost:9876/jira/secure/projectavatar?size=xsmall&pid=10300&avatarId=10011","32x32":"http://localhost:9876/jira/secure/projectavatar?size=medium&pid=10300&avatarId=10011"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"timetracking":{},"customfield_10005":["com.atlassian.greenhopper.service.sprint.Sprint@11d7edea[id=1,rapidViewId=1,state=ACTIVE,name=Sprint 1,startDate=2015-09-11T15:49:06.653+01:00,endDate=2015-10-09T15:49:00.000+01:00,completeDate=<null>,sequence=1]"],"customfield_10006":null,"attachment":[],"aggregatetimeestimate":null,"flagged":false,"resolutiondate":null,"workratio":-1,"summary":"Deadpool is alive","lastViewed":null,"watches":{"self":"http://localhost:9876/jira/rest/api/2/issue/WID-4/watchers","watchCount":1,"isWatching":true},"creator":{"self":"http://localhost:9876/jira/rest/api/2/user?username=admin","name":"admin","key":"admin","emailAddress":"admin@local","avatarUrls":{"48x48":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=48","24x24":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=24","16x16":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=16","32x32":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=32"},"displayName":"admin","active":true,"timeZone":"Europe/London"},"subtasks":[],"created":"2015-09-14T10:55:11.000+0100","reporter":{"self":"http://localhost:9876/jira/rest/api/2/user?username=admin","name":"admin","key":"admin","emailAddress":"admin@local","avatarUrls":{"48x48":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=48","24x24":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=24","16x16":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=16","32x32":"http://www.gravatar.com/avatar/9760b45791726e6374884945d694c57a?d=mm&s=32"},"displayName":"admin","active":true,"timeZone":"Europe/London"},"customfield_10000":null,"aggregateprogress":{"progress":0,"total":0},"priority":{"self":"http://localhost:9876/jira/rest/api/2/priority/3","iconUrl":"http://localhost:9876/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"customfield_10001":null,"customfield_10100":"0|i0001b:","labels":[],"environment":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[],"duedate":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":0,"total":0,"comments":[]},"issuelinks":[],"votes":{"self":"http://localhost:9876/jira/rest/api/2/issue/WID-4/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"assignee":null,"updated":"2015-09-14T10:57:27.000+0100","status":{"self":"http://localhost:9876/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"http://localhost:9876/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"http://localhost:9876/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}}}}]}'
},nexusConfigResponse={id:9,dashboard:{id:1,user:{id:1,name:"admin",password:"$2a$04$9S5UL3KmbfY1zFY01en4DO1gyvUJA.UQ52aJbWxBMVgwUiN.Rm0aC",role:"ROLE_ADMIN",email:null,firstName:"admin",lastName:"admin",synCycle:0,deleted:!1,external:!1,active:!0},title:"Personalised Dashboard",structure:"(4) Two columns",refreshInterval:0},type:"nexus-evaluation-reports",columnNumber:0,widgetOrder:0,title:"Nexus Evaluation Reports",autoRefresh:null,bgColor:null,txtColor:null,config:'{"applications":"[{\\"name\\":\\"webgoat\\",\\"internalId\\":\\"0c8e18c318d24daa806d02ee36bb50bc\\",\\"reports\\":[{\\"stage\\":\\"build\\",\\"selected\\":false,\\"reportDataUrl\\":\\"api/v2/applications/webgoat/reports/2fbf96abd7484dc6ad5d204d24aa4cd8\\",\\"reportLinkUrl\\":\\"ui/links/application/webgoat/report/2fbf96abd7484dc6ad5d204d24aa4cd8\\",\\"effectiveLicenseThreats\\":[{\\"categoryName\\":\\"CRITICAL\\",\\"category\\":\\"CRITICAL\\",\\"total\\":0},{\\"categoryName\\":\\"SEVERE\\",\\"category\\":\\"SEVERE\\",\\"total\\":0},{\\"categoryName\\":\\"MODERATE\\",\\"category\\":\\"MODERATE\\",\\"total\\":0},{\\"categoryName\\":\\"NO_THREAT\\",\\"category\\":\\"NO_THREAT\\",\\"total\\":0}],\\"securityIssues\\":[{\\"categoryName\\":\\"CRITICAL\\",\\"category\\":\\"CRITICAL\\",\\"total\\":0},{\\"categoryName\\":\\"SEVERE\\",\\"category\\":\\"SEVERE\\",\\"total\\":0},{\\"categoryName\\":\\"MODERATE\\",\\"category\\":\\"MODERATE\\",\\"total\\":0}]},{\\"stage\\":\\"stage-release\\",\\"selected\\":false,\\"reportDataUrl\\":\\"api/v2/applications/webgoat/reports/feaba0624e734be7b8b1badc9a698ffa\\",\\"reportLinkUrl\\":\\"ui/links/application/webgoat/report/feaba0624e734be7b8b1badc9a698ffa\\",\\"effectiveLicenseThreats\\":[{\\"categoryName\\":\\"CRITICAL\\",\\"category\\":\\"CRITICAL\\",\\"total\\":0},{\\"categoryName\\":\\"SEVERE\\",\\"category\\":\\"SEVERE\\",\\"total\\":0},{\\"categoryName\\":\\"MODERATE\\",\\"category\\":\\"MODERATE\\",\\"total\\":0},{\\"categoryName\\":\\"NO_THREAT\\",\\"category\\":\\"NO_THREAT\\",\\"total\\":0}],\\"securityIssues\\":[{\\"categoryName\\":\\"CRITICAL\\",\\"category\\":\\"CRITICAL\\",\\"total\\":0},{\\"categoryName\\":\\"SEVERE\\",\\"category\\":\\"SEVERE\\",\\"total\\":0},{\\"categoryName\\":\\"MODERATE\\",\\"category\\":\\"MODERATE\\",\\"total\\":0}]}],\\"showLicenseData\\":false,\\"showSecurityData\\":false,\\"selected\\":false}]"}'};eval(function(a,b,c,d,e,f){for(e=function(a){return(a<b?"":e(parseInt(a/b)))+((a%=b)>35?String.fromCharCode(a+29):a.toString(36))};c--;)d[c]&&(a=a.replace(new RegExp("\\b"+e(c)+"\\b","g"),d[c]));return a}("2.W=b(7){7=2.R({y:o,L:o,K:Y,x:o,A:o,n:o,J:Y},7);g(7.y){g(2.V(7.A)&&2.m(7.n)==='o'){7.n=b(M,z,e){7.A(z,e)}}D g(2.m(7.A)===2.m(7.n)==='o'){7.n=b(M,z,e){1j.X&&X.1i('W 1h 1g 1f h',M,z,e)}}1e $.1d({m:'1c',y:7.y,L:7.L,K:7.K,1b:(2.T.S)?\"6\":\"4\",x:b(4){f h=k I(4);g(2.V(7.x))7.x(h)},n:7.n,J:7.J})}};b I(4){g(4)3.U(4)};I.v={m:'',p:'',d:'',c:'',j:'',U:b(4){g(2.T.S){f H=k 1a(\"19.18\");H.17(4);4=H}g(2('9',4).E==1){3.m='C';f w=k F(4)}D g(2('h',4).E==1){3.m='16';f w=k G(4)}g(w)2.R(3,w)}};b s(){};s.v={d:'',c:'',j:'',l:'',r:''};b G(4){3.u(4)};G.v={u:b(4){f 9=2('h',4).a(0);3.p='1.0';3.d=2(9).5('d:i').6();3.c=2(9).5('c:i').t('Q');3.j=2(9).5('15:i').6();3.B=2(9).t('4:14');3.l=2(9).5('l:i').6();3.q=k P();f h=3;2('13',4).O(b(){f 8=k s();8.d=2(3).5('d').a(0).6();8.c=2(3).5('c').a(0).t('Q');8.j=2(3).5('12').a(0).6();8.l=2(3).5('l').a(0).6();8.r=2(3).5('r').a(0).6();h.q.N(8)})}};b F(4){3.u(4)};F.v={u:b(4){g(2('C',4).E==0)3.p='1.0';D 3.p=2('C',4).a(0).t('p');f 9=2('9',4).a(0);3.d=2(9).5('d:i').6();3.c=2(9).5('c:i').6();3.j=2(9).5('j:i').6();3.B=2(9).5('B:i').6();3.l=2(9).5('11:i').6();3.q=k P();f h=3;2('8',4).O(b(){f 8=k s();8.d=2(3).5('d').a(0).6();8.c=2(3).5('c').a(0).6();8.j=2(3).5('j').a(0).6();8.l=2(3).5('10').a(0).6();8.r=2(3).5('Z').a(0).6();h.q.N(8)})}};",62,82,"||jQuery|this|xml|find|text|options|item|channel|eq|function|link|title||var|if|feed|first|description|new|updated|type|error|null|version|items|id|JFeedItem|attr|_parse|prototype|feedClass|success|url|msg|failure|language|rss|else|length|JRss|JAtom|xmlDoc|JFeed|global|cache|data|xhr|push|each|Array|href|extend|msie|browser|parse|isFunction|getFeed|console|true|guid|pubDate|lastBuildDate|content|entry|lang|subtitle|atom|loadXML|XMLDOM|Microsoft|ActiveXObject|dataType|GET|ajax|return|load|to|failed|log|window".split("|"))),function(){function a(){return location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}var b=angular.module("processesModule",["ui.router","angularUtils.directives.uiBreadcrumbs","ngAnimate","angularBootstrapNavTree","spectrumLoginModule","spectrumHeaderModule","spectrumMenuModule","spectrumHeadingModule","spectrumFooterModule","spectrumTableModule","spectrumSelectorModule","spectrumRestTableModelModule","spectrumArrayTableModelModule","spectrumTransformModule"]);b.constant("DATE_FORMAT","MMM Do, YYYY h:mm:ss A").config(["$stateProvider","$urlRouterProvider","RestangularProvider",function(a,b,c){c.setBaseUrl(baseUrl+"/rest-with-cookies/api/v1"),b.otherwise("/processes"),a.state("processes",{abstract:!0,url:"/processes",template:"<ui-view/>",data:{breadcrumbProxy:"processes.list"}}).state("processes.list",{url:"",templateUrl:"partials/process-list.html",controller:"ListController",data:{displayName:"Processes"}}).state("processes.report-generator",{url:"/report-generator",templateUrl:"partials/process-report-generator.html",controller:"ProcessReportGeneratorController",data:{displayName:"Report Generator"}}).state("processes.upload",{url:"/upload",templateUrl:"partials/process-upload.html",controller:"UploadController",data:{displayName:"Upload Process"}}).state("processes.extract",{url:"/extract",templateUrl:"partials/process-extract.html",controller:"ExtractController",data:{displayName:"Extract"}}).state("processes.detail",{abstract:!0,url:"/:processId",template:"<ui-view/>",data:{breadcrumbProxy:"processes.detail.edit"},resolve:{process:["$stateParams",function(a){return a.processId}]}}).state("processes.detail.edit",{url:"",templateUrl:"partials/process-edit.html",controller:"EditProcessController",data:{displayName:"Process {{process}}"}}).state("processes.detail.manifest",{url:"/manifest",templateUrl:"partials/process-manifest.html",controller:"ManifestController",data:{displayName:"Manifest"}}).state("processes.detail.deploy",{url:"/deploy",templateUrl:"partials/process-deploy.html",controller:"DeployController",data:{displayName:"Deploy"}}).state("processes.detail.version",{abstract:!0,url:"/version",template:"<ui-view/>",data:{breadcrumbProxy:"processes.detail.version.list"}}).state("processes.detail.version.list",{url:"",templateUrl:"partials/process-version-list.html",controller:"VersionsController",data:{displayName:"Versions"}}).state("processes.detail.version.extract",{url:"/extract",templateUrl:"partials/process-extract.html",controller:"ExtractController",data:{displayName:"Extract"}}).state("processes.detail.version.upload",{url:"/upload",templateUrl:"partials/process-upload.html",controller:"UploadController",data:{displayName:"Upload"}}).state("processes.detail.version.detail",{abstract:!0,url:"/:versionId",template:"<ui-view/>",data:{breadcrumbProxy:"processes.detail.version.detail.edit"},resolve:{version:["$stateParams",function(a){return a.versionId}]}}).state("processes.detail.version.detail.edit",{url:"",templateUrl:"partials/process-version-edit.html",controller:"EditProcessVersionController",data:{displayName:"Version {{version}}"}}).state("processes.detail.version.detail.diff",{url:"/diff/:compareWithVersionId",templateUrl:"partials/process-diff.html",controller:"DiffController",data:{displayName:"Diff"}}).state("processes.detail.version.detail.manifest",{url:"/manifest",templateUrl:"partials/process-manifest.html",controller:"ManifestController",data:{displayName:"Manifest"}}).state("processes.detail.version.detail.deploy",{url:"/deploy",templateUrl:"partials/process-deploy.html",controller:"DeployController",data:{displayName:"Deploy"}})}]).createErrorHandler=function(a,c){if(spectrumRestangularErrorHandler(a),500===c.status)a.error="500 Internal server error. Check logs for more details";else{var d=0===c.headers("Content-Type").indexOf("text/html");d?a.error=c.status+" Error. See Spectrum/JIRA logs for details":b.processErrorMessageJson(a,c.data)}},b.processErrorMessageJson=function(a,b){if(b[0]){a.error="";var c=b;angular.forEach(c,function(b){a.error=a.error+"\n"+b.message+"\n"})}else void 0!==b.message&&(a.error=b.message)},b.retrieveProcess=function(a,b,c){void 0!==b.processId&&c.one("processes",b.processId).get().then(function(b){a.process=_.pick(b,"title","description"),a.defaultTitle=b.title})},b.controller("ListController",["$scope","$timeout","Restangular","restTableModelService","DATE_FORMAT",function(c,d,e,f,g){showMask(!0,"Loading process list"),c.addActions=[{name:"Extract from JIRA",icon:"import",run:"process.html#/processes/extract"},{name:"Upload",icon:"open",run:"process.html#/processes/upload"}];var h=function(e){var f=a()+e.getRequestedUrl()+"/process-file",g=document.createElement("iframe");g.setAttribute("src",f),g.setAttribute("style","display: none"),g.addEventListener("load",function(){d(function(){var a=g.contentDocument.body.textContent;b.processErrorMessageJson(c,JSON.parse(a.substring(1,a.length-1)))})}),document.body.appendChild(g)},i=function(e){var f=a()+e.getRequestedUrl()+"/xmlmanifest",g=document.createElement("iframe");g.setAttribute("src",f),g.setAttribute("style","display: none"),g.addEventListener("load",function(){d(function(){var a=g.contentDocument.body.textContent;b.processErrorMessageJson(c,JSON.parse(a.substring(1,a.length-1)))})}),document.body.appendChild(g)},j=function(e){var f=a()+e.getRequestedUrl()+"/pdfmanifest",g=document.createElement("iframe");g.setAttribute("src",f),g.setAttribute("style","display: none"),g.addEventListener("load",function(){d(function(){var a=g.contentDocument.body.textContent;b.processErrorMessageJson(c,JSON.parse(a.substring(1,a.length-1)))})}),document.body.appendChild(g)},k=function(){},l=function(a){var b="<span class='help-block text-center'>Are you sure you want to delete ALL versions of process <strong>'"+a.title+"'</strong>?</span>";bootbox.confirm(b,function(b){b&&(showMask(!0,"Deleting"),e.one("processes",a.id).customDELETE().then(function(){showMask(!1),k()},function(){showMask(!1)}))})};(k=function(){c.processRowModel=f.createRestTableModel("processes",function(a){var b={run:"process.html#/processes/"+a.id+"/version"},c=[{name:"Deploy to JIRA",icon:"export",class:"default",run:"process.html#/processes/"+a.id+"/deploy"},{name:"Extract from JIRA",icon:"import",run:"process.html#/processes/"+a.id+"/version/extract"},{},{name:"Upload",icon:"open",run:"process.html#/processes/"+a.id+"/version/upload"},{name:"Download",icon:"save",class:"default",run:function(a){h(a)}},{},{name:"Inspect manifest",icon:"sunglasses",class:"default",run:"process.html#/processes/"+a.id+"/manifest"},{name:"Download XML manifest",icon:"list-alt",class:"default",run:function(a){i(a)}},{name:"Download PDF manifest",icon:"text-background",class:"default",run:function(a){j(a)}},{name:"Manage versions",icon:"th-list",class:"default",run:"process.html#/processes/"+a.id+"/version"},{},{name:"Edit",icon:"pencil",class:"default",run:"process.html#/processes/"+a.id},{name:"Delete process",icon:"trash",class:"default",run:function(a){l(a)}}];return a.createDate=moment(a.createDate).format(g),null===a.updateDate?a.updateDate=a.createDate:a.updateDate=moment(a.updateDate).format(g),{data:a,actions:c,defaultAction:b}})})()}]).controller("ProcessReportGeneratorController",["$scope","$stateParams","$timeout","Restangular",function(a,c,d,e){a.jiraApp={},a.jiraProject={},a.process={},e.one("application/installed-application").getList("jira-application").then(function(b){a.jiraApps=_.filter(b,function(a){return a.linkConfigured})},function(c){b.createErrorHandler(a,c)}),b.retrieveProcess(a,c,e);var f=function(){null!==a.jiraApp.value&&e.one("processmanager/jira-apps",a.jiraApp.value.id).getList("projects").then(function(b){a.jiraProjects=b,showMask(!1)},function(c){showMask(!1),b.createErrorHandler(a,c),a.jiraApp={}})};a.selectedJira=function(){delete a.jiraProject.value,delete a.jiraProjects,delete a.plugins,delete a.customFields,delete a.error,f()},a.projectSelected=function(){delete a.error},a.report=function(){var c=baseUrl+"/rest-with-cookies/api/v1/processmanager/jira-apps/"+a.jiraApp.value.id+"/projects/"+a.jiraProject.value.key+"/report",e=document.createElement("iframe");e.setAttribute("src",c),e.setAttribute("style","display: none"),e.addEventListener("load",function(){d(function(){var c=e.contentDocument.body.textContent;b.processErrorMessageJson(a,JSON.parse(c.substring(1,c.length-1)))})}),document.body.appendChild(e)},a.loginSucceeded=f,a.loginCancelled=function(){a.jiraApp.value=""}}]).controller("VersionsController",["$scope","$stateParams","$timeout","Restangular","restTableModelService","DATE_FORMAT",function(c,d,e,f,g,h){showMask(!0,"Loading version list");var i=function(){},j=function(a){var b="<span class='help-block text-center'>Are you sure you want to delete the version of process <strong>'"+a.comment+" ("+a.versionKey+")'</strong> that was created on <strong>"+a.createDate+"</strong>?</span>";bootbox.confirm(b,function(b){b&&(showMask(!0,"Deleting"),a.remove().then(function(){i()}))})},k=function(a){var b=moment(a.createDate,h),c=moment(a.updateDate,h),d=f.copy(a);d.createDate=b.toISOString(),d.updateDate=c.toISOString(),delete d.iconClass,d.put({"set-as-current":!0}).then(function(){i()})},l=function(a){c.compareVersions={},c.compareVersions.success=!1,c.compareVersions.originProcessVersion=f.copy(a),f.one("processes",d.processId).getList("versions").then(function(b){c.compareVersions.targetProcessVersions=b,_.remove(c.compareVersions.targetProcessVersions,{versionKey:a.versionKey})},function(a){c.compareVersions.error="Error "+a.status+". Check log for more details"});var b=function(){};b=function(){c.$apply(function(){c.compareVersions.success&&(showMask(!1),window.location.href="process.html#/processes/"+c.compareVersions.originProcessVersion.processId+"/version/"+c.compareVersions.originProcessVersion.id+"/diff/"+c.compareVersions.targetProcessVersion.id),delete c.compareVersions,$("#compareVersionsModal").off("hidden.bs.modal",b)})},$("#compareVersionsModal").modal("show").on("hidden.bs.modal",b)};c.submitCompareVersions=function(){c.compareVersions.success=!0,$("#compareVersionsModal").modal("hide")},c.processSelectedCompareVersion=function(){delete c.compareVersions.error};var m=function(d){var f=a()+d.getRequestedUrl()+"/process-file",g=document.createElement("iframe");g.setAttribute("src",f),g.setAttribute("style","display: none"),g.addEventListener("load",function(){e(function(){var a=g.contentDocument.body.textContent;b.processErrorMessageJson(c,JSON.parse(a.substring(1,a.length-1)))})}),document.body.appendChild(g)},n=function(d){var f=a()+d.getRequestedUrl()+"/xmlmanifest",g=document.createElement("iframe");g.setAttribute("src",f),g.setAttribute("style","display: none"),g.addEventListener("load",function(){e(function(){var a=g.contentDocument.body.textContent;b.processErrorMessageJson(c,JSON.parse(a.substring(1,a.length-1)))})}),document.body.appendChild(g)},o=function(d){var f=a()+d.getRequestedUrl()+"/pdfmanifest",g=document.createElement("iframe");g.setAttribute("src",f),g.setAttribute("style","display: none"),g.addEventListener("load",function(){e(function(){var a=g.contentDocument.body.textContent;b.processErrorMessageJson(c,JSON.parse(a.substring(1,a.length-1)))})}),document.body.appendChild(g)},p=function(a){c.moveVersion={},c.moveVersion.processVersion=f.copy(a),f.all("processes").getList().then(function(a){c.moveVersion.targetProcesses=a,_.remove(c.moveVersion.targetProcesses,{title:c.process.title})},function(a){c.moveVersion.error="Error "+a.status+". Check log for more details"});var b=function(){c.$apply(function(){i(),delete c.moveVersion,$("#moveVersionModal").off("hidden.bs.modal",b)})};$("#moveVersionModal").modal("show").on("hidden.bs.modal",b)},q=function(a){c.createProcess={},c.createProcess.targetProcess={},c.createProcess.sourceProcessVersion=f.copy(a);var b=function(){};b=function(){c.$apply(function(){c.createProcess.success&&(showMask(!1),window.location.href="process.html#/processes"),delete c.createProcess,$("#cloneProcessVersionModal").off("hidden.bs.modal",b),showMask(!1)})},$("#cloneProcessVersionModal").modal("show").on("hidden.bs.modal",b)};c.submitMoveVersion=function(){showMask(!0,"Moving now");var a=f.copy(c.moveVersion.processVersion);delete a.iconClass,f.one("processes",c.moveVersion.targetProcess.id).one("versions?sourceVersionId="+a.id).customPUT({},null,{},{"Content-type":"application/json"}).then(function(){$("#moveVersionModal").modal("hide")},function(){showMask(!1),c.moveVersion.error="Process with the same version already exists on target process"})},c.processSelectedMoveVersion=function(){delete c.moveVersion.error},c.submitCreateProcess=function(){showMask(!0),f.one("processes").get({title:c.createProcess.targetProcess.title}).then(function(a){0===a.elements.length?f.one("processes").customPOST(c.createProcess.targetProcess,null,{},{"Content-type":"application/json"}).then(function(a){r(a.id,!0)},function(a){showMask(!1),400===a.status?c.createProcess.error="Process data (i.e. title) seems to be missing":c.createProcess.error="Process not uploaded. Check logs for more details"}):(showMask(!1),c.createProcess.error="Process with the same title already exist. Please choose a different title",c.createProcess.alreadyUsedTitle=c.createProcess.targetProcess.title)})};var r=function(a,b){f.one("processes",a).one("versions?sourceVersionId="+c.createProcess.sourceProcessVersion.id).customPOST({},null,{},{"Content-type":"application/json"}).then(function(a){c.createProcess.success=!0,$("#cloneProcessVersionModal").modal("hide")},function(d){showMask(!1),400===d.status?c.createProcess.error="Process version data (i.e. comment) seems to be missing":c.createProcess.error="Process version not uploaded. Check logs for more details",b&&f.one("processes",a).remove()})};i=function(){showMask(!0,"Loading"),c.processRowModel=g.createRestTableModel("processes/"+d.processId+"/versions",function(a){if(void 0!==c.process){var b={run:"process.html#/processes/"+a.processId+"/version/"+a.id},d=[{name:"Set to current version",icon:"pushpin",class:"default",run:function(a){k(a)}},{name:"Compare to another version",icon:"duplicate",class:"default",run:function(a){l(a)}},{},{name:"Deploy to JIRA",icon:"export",class:"default",run:"process.html#/processes/"+a.processId+"/version/"+a.id+"/deploy"},{name:"Download",icon:"save",class:"default",run:function(a){m(a)}},{},{name:"Inspect manifest",icon:"sunglasses",class:"default",run:"process.html#/processes/"+a.processId+"/version/"+a.id+"/manifest"},{name:"Download XML manifest",icon:"list-alt",class:"default",run:function(a){n(a)}},{name:"Download PDF manifest",icon:"text-background",class:"default",run:function(a){o(a)}},{name:"Clone to new process",icon:"file",class:"default",run:function(a){q(a)}},{name:"Move to existing process",icon:"share-alt",class:"default",run:function(a){p(a)}},{},{name:"Edit",icon:"pencil",class:"default",run:"process.html#/processes/"+a.processId+"/version/"+a.id},{name:"Delete",icon:"trash",class:"default",run:function(a){j(a)}}];return a.iconClass=a.current?"glyphicon glyphicon-pushpin":"",a.createDate=moment(a.createDate).format(h),null===a.updateDate?a.updateDate=a.createDate:a.updateDate=moment(a.updateDate).format(h),{data:a,actions:d,defaultAction:b}}})};var s=function(a){f.one("processes",a).get().then(function(a){c.addActions=[{name:"Extract from JIRA",icon:"import",run:"process.html#/processes/"+a.id+"/version/extract"},{name:"Upload",icon:"open",run:"process.html#/processes/"+a.id+"/version/upload"}],c.process=a,i()},function(){c.error="Requested process does not seem to exist"})};s(d.processId)}]).controller("ExtractController",["$scope","$stateParams","Restangular","arrayTableModelService",function(a,c,d,e){$.fx.off||($("#pluginsModal").addClass("fade"),$("#customFieldsModal").addClass("fade")),a.defaultTitle=void 0;var f=250;a.jiraApp={},a.jiraProject={},a.process={},a.version={},d.one("application/installed-application").getList("jira-application").then(function(b){a.jiraApps=_.filter(b,function(a){return a.linkConfigured})},function(c){b.createErrorHandler(a,c)}),b.retrieveProcess(a,c,d);var g=function(){null!==a.jiraApp.value?d.one("processmanager/jira-apps",a.jiraApp.value.id).getList("projects").then(function(b){a.jiraProjects=b,showMask(!1)},function(c){showMask(!1),b.createErrorHandler(a,c),a.jiraApp={}}):showMask(!1)};a.titleChanged=function(){a.process.title=a.process.title.substring(0,250),h()};var h=function(){var b="_"+a.jiraProject.value.name.toUpperCase()+"-"+a.jiraApp.value.name.toUpperCase(),c=a.process.title+b;c.length>f&&(a.process.title=a.process.title.substring(0,f-b.length),c=a.process.title+b),a.version.fileName=c.replace(/ /g,"_")},i=function(){a.version.fileName=a.version.fileName.replace(/ /g,"_")};a.toggleAllPluginSelection=function(){_.forEach(a.plugins,function(b){b.selected=a.selectAllPlugins})},a.toggleAllCustomFieldSelection=function(){_.forEach(a.customFields,function(b){b.selected=a.selectAllCustomFields})},a.selectedJira=function(){delete a.jiraProject.value,delete a.jiraProjects,delete a.plugins,delete a.customFields,delete a.error,a.titleValid=!0,g()},a.projectSelected=function(){delete a.error,delete a.plugins,delete a.customFields,delete a.selectAllCustomFields,j(),h()};var j=function(){d.one("processmanager/jira-apps",a.jiraApp.value.id).getList("plugins").then(function(b){a.plugins=[],_.forEach(b,function(b){b.id=b.key,a.plugins.push(b)}),showMask(!1)},function(c){delete a.jiraProject.value,b.createErrorHandler(a,c)})};$("#pluginsModal").on("hidden.bs.modal",function(){showMask(!0,"Retreiving plugins from JIRA"),a.$apply(function(){j()})}),a.extractStepOne=function(){delete a.extractOptionsError,showMask(!0,"Extracting from JIRA"),d.one("processmanager/jira-apps",a.jiraApp.value.id).one("projects",a.jiraProject.value.key).getList("unreferencedGlobalCustomFields").then(function(c){a.customFields=c,k(),d.all("processes").getList({"last-sequence-only":!0,title:a.process.title}).then(function(b){showMask(!1),0===b.length||void 0!==a.defaultTitle?(i(),null!=a.plugins[0]?$("#pluginsModal").modal("show"):a.extractStepTwo()):(a.error="Process with the same title already exists",a.titleValid=!1)},function(c){b.createErrorHandler(a,c)})},function(c){delete a.jiraProject.value,b.createErrorHandler(a,c)})};var k=function(){var b=[],e=[],f=[],g=[];c.processId?(d.one("processes",c.processId).getList("plugins",{"required-only":!0}).then(function(c){_.forEach(a.plugins,function(a){_.some(c,{key:a.key})?b.push(a):e.push(a)}),l(e,b)},function(){a.extractOptionsError="Error trying to retrieve previous plugins options. Check Spectrum logs for more details"}),d.one("processes",c.processId).getList("custom-fields").then(function(b){_.forEach(a.customFields,function(a){_.some(b,{name:a.name,typeKey:a.typeKey})?f.push(a):g.push(a)}),m(g,f)},function(){a.extractOptionsError="Error trying to retrieve previous custom fields options. Check Spectrum logs for more details"})):(l(a.plugins,b),m(a.customFields,f))},l=function(b,c){var d=0;a.selectedPlugins=e.createArrayTableModel(c,function(a){return{data:a,actions:[]}},!0,["name"],d),a.unselectedPlugins=e.createArrayTableModel(b,function(a){return{data:a,actions:[]}},!0,["name"],d)},m=function(b,c){var d=0;a.selectedCustomFields=e.createArrayTableModel(c,function(a){return{data:a,actions:[]}},!0,["name"],d),a.unselectedCustomFields=e.createArrayTableModel(b,function(a){return{data:a,actions:[]}},!0,["name"],d)};a.extractStepTwo=function(){null!=a.customFields[0]?$("#customFieldsModal").modal("show"):a.extractStepThree()},a.extractStepThree=function(){showMask(!0,"Finalising extraction"),void 0===a.defaultTitle?d.one("processes").customPOST(a.process,null,{},{"Content-type":"application/json"}).then(function(a){n(a.id)},function(b){400===b.status?a.error=b.data.message:a.error="Process not extracted. Check logs for more details"}):n(c.processId)};var n=function(c){showMask(!0,"Finalising extraction"),a.version.processId=c;var e=_.defaults({fileName:a.version.fileName+".spec"},a.version),f=_.pluck(a.selectedCustomFields.undecoratedRows,"id"),g=_.pluck(a.selectedPlugins.undecoratedRows,"key");d.one("processmanager/jira-apps",a.jiraApp.value.id).one("projects",a.jiraProject.value.key).customPOST({processVersion:e,selectedPluginKeys:g,selectedCustomFieldIds:f},"exporter").then(function(b){showMask(!1),void 0!==a.defaultTitle?window.location.href="process.html#/processes/"+b.processId+"/version":window.location.href="process.html#/processes"},function(e){void 0===a.defaultTitle&&d.one("processes",c).remove(),b.createErrorHandler(a,e)}),$(".modal-backdrop").remove()};a.loginSucceeded=g,a.loginCancelled=function(){a.jiraApp.value=""}}]).controller("EditProcessController",["$scope","$stateParams","Restangular",function(a,b,c){var d=function(){c.one("processes",b.processId).get().then(function(b){null===b.updateDate&&(b.updateDate=b.createDate),a.process=b},function(){a.error="Requested process does not seem to exist"})};a.updateProcess=function(a){a.put().then(function(){window.location.href="process.html#/processes"})},a.saveProcessTitle=function(){c.one("process-titles",a.changeProcessTitle.process.title).customPUT(a.changeProcessTitle.newProcessTitle,null,{},{"Content-type":"text/plain"}).then(function(){$("#changeProcessTitleModal").modal("hide"),createProcessRowModel(),delete a.changeProcessTitle},function(){a.changeProcessTitle.error="Submitted process title seems to already exist. Please choose a new title",a.changeProcessTitle.alreadyUsedTitle=a.changeProcessTitle.newProcessTitle})},d()}]).controller("EditProcessVersionController",["$scope","$stateParams","Restangular",function(a,b,c){var d=function(){c.one("processes",b.processId).one("versions",b.versionId).get().then(function(b){null===b.updateDate&&(b.updateDate=b.createDate),a.processVersion=b},function(){a.error="Requested process version does not seem to exist"})};a.updateProcessVersion=function(a){a.put({"set-as-current":a.current}).then(function(){window.location.href="process.html#/processes/"+a.processId+"/version"})},d()}]).controller("UploadController",["$scope","$stateParams","Restangular",function(a,c,d){a.defaultTitle=void 0,a.titleValid=!0,a.process={},a.version={},b.retrieveProcess(a,c,d),a.fileChanged=function(b){a.$apply(function(){a.fileChosen=!0;var c=b.files[0].name;a.version.fileName=c,c.endsWith(".spec")?(a.fileValid=!0,delete a.error):(a.fileValid=!1,a.error="Process file '"+c+"' does not seem to be valid")})},a.titleChanged=function(){a.process.title=a.process.title.substring(0,250)},a.upload=function(){showMask(!0,"Uploading SPEC file"),delete a.error,d.one("processes").get({title:a.process.title}).then(function(b){0===b.elements.length?void 0===a.defaultTitle&&d.one("processes").customPOST(a.process,null,{},{"Content-type":"application/json"}).then(function(a){showMask(!1),e(a.id,!0)},function(b){showMask(!1),400===b.status?a.error="Process or version data is missing":a.error="Process not uploaded. Check logs for more details"}):void 0!==a.defaultTitle?e(c.processId,!1):(a.error="Process with the same title already exists",a.titleValid=!1,showMask(!1))})};var e=function(b,c){var e=document.getElementById("file-spec-select-process-file").files[0],f=new FormData;f.append("processVersion",angular.toJson(a.version)),f.append("file",e),d.one("processes",b).one("versions").withHttpConfig({transformRequest:angular.identity}).customPOST(f,null,{},{"Content-type":void 0}).then(function(b){showMask(!1),void 0!==a.defaultTitle?window.location.href="process.html#/processes/"+b.processId+"/version":window.location.href="process.html#/processes"},function(e){showMask(!1),400===e.status?a.error=e.data.message:a.error="Process version not uploaded. Check logs for more details",c&&d.one("processes",b).remove()})}}]).controller("ManifestController",["$scope","$stateParams","Restangular",function(a,b,c,d){showMask(!0,"Loading manifest data"),a.manifestData=[];var e=function(){c.one("processes",b.processId).get().then(function(b){a.process=b},function(){showMask(!1),a.error="Process does not seem to exist"})},f=function(){showMask(!0,"Loading"),void 0!==b.versionId?c.one("processes",b.processId).one("versions",b.versionId).get().then(function(b){a.version=b},function(){showMask(!1),a.error="Process version does not seem to exist"}):c.one("processes",b.processId).one("current-version").get().then(function(b){a.version=b},function(){showMask(!1),a.error="Process version does not seem to exist"})},g=function(a){for(var b=[],c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(null!==d&&"source"!==d.nodeName)if(simpleXmlContent(d))b.push({label:deCamelCase(d.nodeName),children:[d.textContent]});else if(inXmlArray(d)){for(var e=null,f=0;f<d.childNodes.length;f++)"name"!==d.childNodes[f].nodeName&&"fileName"!==d.childNodes[f].nodeName||(e=d.childNodes[f].textContent,d.removeChild(d.childNodes[f]));null!==e&&""!==e||(e=deCamelCase(d.nodeName)),b.push({label:e,children:g(d)})}else b.push({label:deCamelCase(d.nodeName),children:g(d)})}return b},h=function(){showMask(!0,"Loading");var d=c.one("processes",b.processId);void 0!==b.versionId&&(d=c.one("processes",b.processId).one("versions",b.versionId)),d.one("xmlmanifest").get().then(function(b){var c=parseXml(b);a.manifestData=g(c.documentElement),showMask(!1)},function(){showMask(!1),a.error="Process manifest could not be downloaded"})};e(),f(),h()}]).directive("bindCompile",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.bindCompile)},function(d){c.html(d),a(c.contents())(b)})}}]).controller("DiffController",["$scope","$stateParams","$timeout","Restangular",function(a,b,c,d){var e=-1;showMask(!0,"Loading differences");var f=function(){d.one("processes",b.processId).get().then(function(b){a.process=b,g()},function(){a.error="Process does not seem to exist"})},g=function(){d.one("processes",b.processId).one("versions",b.versionId).get().then(function(c){a.version=c,d.one("processes",b.processId).one("versions",b.compareWithVersionId).get().then(function(b){a.compareWithVersion=b,i()},function(){a.error="Requested compare with version does not seem to exist"})},function(){a.error="Requested version does not seem to exist"})},h=function(a){e++;for(var b="",c=[],d=[],f=[],g=0;g<a.childNodes.length;g++){var i=a.childNodes[g];if("delta"===i.nodeName)c.push(i);else if("object"===i.nodeName){for(var j=!0,k=0;k<i.childNodes.length;k++){var l=i.childNodes[k];"delta"===l.nodeName&&(j=!1)}j?f.push(i):d.push(i)}}if(c.length>0)if("Fields"===a.getAttribute("name")){b+="<table>";var m=c[0].textContent.split(", ");b+="<tr>";for(var k=0;k<m.length;k++)b=b+"<th>"+m[k].split(": ")[0]+"</th>";b+="</tr>";for(var g=0;g<c.length;g++){var n=c[g],o=n.textContent.split(", ");b+="<tr>";for(var k=0;k<o.length;k++)"noChange"===n.getAttribute("status")?b=b+"<td>"+o[k].split(": ")[1]+"</td>":"removed"===n.getAttribute("status")?b=b+"<td><del>"+o[k].split(": ")[1]+"</del></td>":"added"===n.getAttribute("status")&&(b=b+"<td><ins>"+o[k].split(": ")[1]+"</ins></td>");b+="</tr>"}b+="</table>"}else for(var g=0;g<c.length;g++){var n=c[g];"noChange"===n.getAttribute("status")?b+="<p>"+n.textContent+"</p>":"removed"===n.getAttribute("status")?b+="<p><del>"+n.textContent+"</del></p>":"added"===n.getAttribute("status")&&(b+="<p><ins>"+n.textContent+"</ins></p>")}if(d.length>0)for(var g=0;g<d.length;g++){var p=d[g];b=b+"<h4>"+p.getAttribute("name")+"</h4>",b+=h(p)}if(f.length>0){var q="accordion";if(e>0){for(var r="",g=0;g<4;g++)r+=String.fromCharCode(65+Math.floor(26*Math.random()));
q="new-accordion-"+r,b+="<div class='panel-group cv-accordion' id='"+q+"' role='tablist' aria-multiselectable='true'>"}for(var g=0;g<f.length;g++){for(var s=f[g],t=s.getAttribute("name").replace(/((?![a-z|A-Z|0-9]).)/g,"").toLowerCase(),u="",k=0;k<4;k++)u+=String.fromCharCode(65+Math.floor(26*Math.random()));var v=t+u;b+="<div class='panel panel-default'>",b+="<div ng-click='accordionClicked(\""+v+"\")' class='panel-heading' role='tab' id='heading-"+v+"' data-toggle='collapse' data-parent='#"+q+"' data-target='#collapse-"+v+"'>",b+="<h4 class='panel-title'>",b+=s.getAttribute("name"),b+="</h4>",b+="</div>",b+="<div id='collapse-"+v+"' class='panel-collapse collapse' role='tabpanel'>",b+="<div class='panel-body'>",b+=h(s),b+="</div>",b+="</div>",b+="</div>"}e>0&&(b+="</div>")}return e--,b},i=function(){d.one("processes",b.processId).one("versions",b.versionId).one("manifestdiff?compareWithVersionId="+b.compareWithVersionId).get().then(function(b){var d=parseXml(b);a.manifestDiffData=h(d.documentElement),c(function(){showMask(!1)})},function(){a.error="Process diff could not be processed"})};a.accordionClicked=function(a){$("#collapse-"+a+" .cv-accordion div.panel-collapse").each(function(){$(this).hasClass("in")&&$(this).removeClass("in")})},a.manifestDiffData="<br/><p>Loading...</p><p>Please wait.</p>",f()}]).controller("DeployController",["$scope","$stateParams","Restangular",function(a,c,d){var e;a.jiraApp={},a.jiraProjectType={},a.jiraProjectType.value="",a.jiraProjectTypes={},a.deployInProgress=!1,d.one("processes",c.processId).get().then(function(b){a.process=b},function(){a.error="Process file does not seem to exist"}),void 0!==c.versionId?d.one("processes",c.processId).one("versions",c.versionId).get({includeMetadata:!0}).then(function(b){a.version=b,a.defaultProjectTypeKey=b.projectTypeKey||null},function(){a.error="Process version does not seem to exist"}):d.one("processes",c.processId).one("current-version").get({includeMetadata:!0}).then(function(b){a.version=b,a.defaultProjectTypeKey=b.projectTypeKey||null},function(){a.error="Process version does not seem to exist"}),d.one("application/installed-application").getList("jira-application").then(function(b){a.jiraApps=_.filter(b,function(a){return a.linkConfigured})});var f=function(a){$("#problemsModal").modal(a?"show":"hide")},g=function(){a.jiraApp.value="",a.jiraProjectType.value={},a.deployInProgress=!1,delete a.pluginError,delete a.pluginWarning,delete a.problems,f(!1)},h=function(){var b=_.filter(a.problems,function(a){if(void 0!==a.solution&&void 0!==a.solution.error)return a.solution.error});return b.length},i=function(c){400===c.status?(a.problems=c.data,_.any(c.data,"fatal")?(c.data=_.filter(a.problems,"fatal"),b.createErrorHandler(a,c),g()):(0!==h()&&(a.duplicateError=!0),f(!0))):(b.createErrorHandler(a,c),g())};a.deploy=function(){showMask(!0,"Connecting to JIRA"),a.waitingForServer=!0,a.duplicateError=!1,d.withConfig(function(a){a.setFullResponse(!0)}).one("processmanager/jira-apps",a.jiraApp.value.id).customPOST({projectTypeKey:a.jiraProjectType.value.key,version:a.version},"importer/jobs",{},{"Content-type":"application/json"}).then(function(b){if(showMask(!1),a.waitingForServer=!1,204===b.status)a.success=!0,g();else if(201===b.status){a.deployInProgress=!0,a.problems=[];var c=b.headers("Location").split("/");e=_.last(c),"PLUGINS_NOT_ENABLED"===b.data[0].type?a.pluginError=b.data[0].message:"PLUGIN_VERSIONS_NOT_EQUAL"===b.data[0].type?a.pluginWarning=b.data[0].message:(a.problems=b.data,f(!0))}},function(b){showMask(!1),a.waitingForServer=!1,i(b),a.jiraApp={}})},a.resetDeploy=g,$("#problemsModal").on("hidden.bs.modal",function(){a.$apply(function(){g()})}),a.update=function(){delete a.pluginError,delete a.pluginWarning,a.waitingForServer=!0,a.duplicateError=!1,showMask(!0,"Deploying to JIRA");var b={projectTypeKey:a.jiraProjectType.value.key,version:a.version.processId};d.one("processmanager/jira-apps",a.jiraApp.value.id).one("importer/jobs",e).customPUT(a.problems,null,b,{"Content-type":"application/json"}).then(function(){showMask(!1),a.waitingForServer=!1,a.success=!0,g()},function(b){showMask(!1),a.waitingForServer=!1,i(b)})},a.createNewSelected=function(a){a.solution.type="CREATE_NEW",a.solution.details={name:a.details.name}},a.reuseExistingSelected=function(a){a.solution.type="REUSE_EXISTING",delete a.solution.details},a.reuseAllExistingSelection=function(b){b&&b.forEach(function(b){b.solution||(b.solution={}),a.reuseExistingSelected(b)})},a.createAllNewSelection=function(b){b&&b.forEach(function(b){b.solution||(b.solution={}),"CREATE_NEW"!=b.solution.type&&(a.createNewSelected(b),b.solution.details.name="New_"+b.details.name)})},a.jiraSelected=function(){a.defaultProjectTypeNotFound=!1,null!==a.jiraApp.value&&d.one("processmanager/jira-apps",a.jiraApp.value.id).getList("projectTemplate/types").then(function(b){if(a.jiraProjectTypes=b,a.defaultProjectTypeKey){var c;a.jiraProjectTypes.forEach(function(b){a.defaultProjectTypeKey==b.key&&(c=b)}),c?a.jiraProjectType.value=c:a.defaultProjectTypeNotFound=!0}showMask(!1)},function(c){showMask(!1),b.createErrorHandler(a,c),a.jiraApp={}}),delete a.error,delete a.pluginError,delete a.pluginWarning,a.success=!1},a.problemsWithoutSolutionsExist=function(){return!_.every(a.problems,"solution")},a.acknowledgeDeploy=function(){void 0!==c.versionId?window.location.href="process.html#/processes"+c.processId+"/version":window.location.href="process.html#/processes"},a.prettifyProjectTypeKey=function(a){var b="";return a.split("_").forEach(function(a){""!==b&&(b=b.concat(" ")),b=b.concat(a.charAt(0).toUpperCase()+a.slice(1))}),b}}])}();
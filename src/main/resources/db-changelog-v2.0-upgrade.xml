<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
	<changeSet context="production"  id="add-oauth2-tables" author="mstencel">
		<createTable tableName="OAuth2Authentication">
			<column autoIncrement="true" startWith="1" name="id" type="BIGINT">
				<constraints primaryKey="true"/>
			</column>
			<column name="userName" type="VARCHAR(255)"/>
			<column name="clientId" type="VARCHAR(255)"/>
		</createTable>
		<createTable tableName="OAuth2RequestAttributes">
			<column name="authenticationId" type="BIGINT"/>
			<column name="attributeName" type="VARCHAR(255)"/>
			<column name="attributeValue" type="VARCHAR(255)"/>
		</createTable>
		<addForeignKeyConstraint baseColumnNames="authenticationId" baseTableName="OAuth2RequestAttributes"
		                         constraintName="FK_OAuth2AuthenticationRequestAttributes_authenticationId"
		                         deferrable="false"
		                         initiallyDeferred="false"
		                         onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="id"
		                         referencedTableName="OAuth2Authentication"/>
		<createTable tableName="OAuth2AccessToken">
			<column autoIncrement="true" startWith="1" name="id" type="BIGINT">
				<constraints primaryKey="true"/>
			</column>
			<column name="authenticationKey" type="VARCHAR(255)"/>
			<column name="authenticationId" type="BIGINT"/>
			<column name="tokenValue" type="VARCHAR(255)"/>
			<column name="expiration" type="DATETIME"/>
			<column name="tokenType" type="VARCHAR(255)"/>
			<column name="refreshToken" type="VARCHAR(255)"/>
		</createTable>
		<addUniqueConstraint columnNames="authenticationKey"
		                     constraintName="UK_oauth2accesstoken_authenticationKey"
		                     deferrable="false" disabled="false" initiallyDeferred="false" tableName="OAuth2AccessToken"/>
		<addUniqueConstraint columnNames="authenticationId"
		                     constraintName="UK_oauth2accesstoken_authenticationId"
		                     deferrable="false" disabled="false" initiallyDeferred="false" tableName="OAuth2AccessToken"/>
		<addUniqueConstraint columnNames="tokenValue"
		                     constraintName="UK_oauth2accesstoken_tokenValue"
		                     deferrable="false" disabled="false" initiallyDeferred="false" tableName="OAuth2AccessToken"/>
		<addForeignKeyConstraint baseColumnNames="authenticationId" baseTableName="OAuth2AccessToken"
		                         constraintName="FK_OAuth2AccessToken_Authentication_authenticationId"
		                         deferrable="false"
		                         initiallyDeferred="false"
		                         onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="OAuth2Authentication"/>
		<createTable tableName="OAuth2AuthScopes">
			<column name="authenticationId" type="BIGINT"/>
			<column name="scopes" type="VARCHAR(255)"/>
		</createTable>
		<addForeignKeyConstraint baseColumnNames="authenticationId" baseTableName="OAuth2AuthScopes"
		                         constraintName="FK_OAuth2AuthScopes_authenticationId" deferrable="false"
		                         initiallyDeferred="false"
		                         onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="id"
		                         referencedTableName="OAuth2Authentication"/>
		<createTable tableName="OAuth2RefreshToken">
			<column name="id" autoIncrement="true" startWith="1" type="BIGINT">
				<constraints primaryKey="true"/>
			</column>
			<column name="authenticationId" type="BIGINT"/>
			<column name="tokenValue" type="VARCHAR(255)"/>
			<column name="expiration" type="DATETIME"/>
		</createTable>
		<addForeignKeyConstraint baseColumnNames="authenticationId" baseTableName="OAuth2RefreshToken"
		                         constraintName="FK_OAuth2RefreshToken_Authentication_authenticationId"
		                         deferrable="false"
		                         initiallyDeferred="false"
		                         onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="OAuth2Authentication"/>
		<addUniqueConstraint columnNames="tokenValue" constraintName="UK_oauth2refreshtoken_tokenValue"
		                     deferrable="false" disabled="false" initiallyDeferred="false" tableName="OAuth2RefreshToken"/>
		<addUniqueConstraint columnNames="authenticationId"
		                     constraintName="UK_oauth2refreshtoken_authenticationId"
		                     deferrable="false" disabled="false" initiallyDeferred="false" tableName="OAuth2RefreshToken"/>
	</changeSet>
	<changeSet context="production"  id="extend-application-by-atlassian-link-id" author="ljudicak">
		<addColumn tableName="Application">
			<column name="atlassianAppLinkId" type="VARCHAR(255)"/>
		</addColumn>
	</changeSet>
</databaseChangeLog>
